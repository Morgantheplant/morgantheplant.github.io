!function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[o]={exports:{}};e[o][0].call(c.exports,function(t){var i=e[o][1][t];return r(i?i:t)},c,c.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){"use strict";function n(t){r.call(this,t);var e=t.getAlign();this._x.set(e[0]),this._y.set(e[1]),this._z.set(e[2])}var r=t("./Position");n.prototype.toString=function(){return"Align"},n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.update=function(){this._node.setAlign(this._x.get(),this._y.get(),this._z.get()),this._checkUpdate()},n.prototype.onUpdate=n.prototype.update,e.exports=n},{"./Position":4}],2:[function(t,e,i){"use strict";function n(t){this._node=t,this._projectionType=n.ORTHOGRAPHIC_PROJECTION,this._focalDepth=0,this._near=0,this._far=0,this._requestingUpdate=!1,this._id=t.addComponent(this),this._viewTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._viewDirty=!1,this._perspectiveDirty=!1,this.setFlat()}var r=t("../core/Commands");n.FRUSTUM_PROJECTION=0,n.PINHOLE_PROJECTION=1,n.ORTHOGRAPHIC_PROJECTION=2,n.prototype.toString=function(){return"Camera"},n.prototype.getValue=function(){return{component:this.toString(),projectionType:this._projectionType,focalDepth:this._focalDepth,near:this._near,far:this._far}},n.prototype.setValue=function(t){return this.toString()===t.component?(this.set(t.projectionType,t.focalDepth,t.near,t.far),!0):!1},n.prototype.set=function(t,e,i,n){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._projectionType=t,this._focalDepth=e,this._near=i,this._far=n},n.prototype.setDepth=function(t){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=n.PINHOLE_PROJECTION,this._focalDepth=t,this._near=0,this._far=0,this},n.prototype.setFrustum=function(t,e){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=n.FRUSTUM_PROJECTION,this._focalDepth=0,this._near=t,this._far=e,this},n.prototype.setFlat=function(){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=n.ORTHOGRAPHIC_PROJECTION,this._focalDepth=0,this._near=0,this._far=0,this},n.prototype.onUpdate=function(){this._requestingUpdate=!1;var t=this._node.getLocation();if(this._node.sendDrawCommand(r.WITH).sendDrawCommand(t),this._perspectiveDirty)switch(this._perspectiveDirty=!1,this._projectionType){case n.FRUSTUM_PROJECTION:this._node.sendDrawCommand(r.FRUSTRUM_PROJECTION),this._node.sendDrawCommand(this._near),this._node.sendDrawCommand(this._far);break;case n.PINHOLE_PROJECTION:this._node.sendDrawCommand(r.PINHOLE_PROJECTION),this._node.sendDrawCommand(this._focalDepth);break;case n.ORTHOGRAPHIC_PROJECTION:this._node.sendDrawCommand(r.ORTHOGRAPHIC_PROJECTION)}this._viewDirty&&(this._viewDirty=!1,this._node.sendDrawCommand(r.CHANGE_VIEW_TRANSFORM),this._node.sendDrawCommand(this._viewTransform[0]),this._node.sendDrawCommand(this._viewTransform[1]),this._node.sendDrawCommand(this._viewTransform[2]),this._node.sendDrawCommand(this._viewTransform[3]),this._node.sendDrawCommand(this._viewTransform[4]),this._node.sendDrawCommand(this._viewTransform[5]),this._node.sendDrawCommand(this._viewTransform[6]),this._node.sendDrawCommand(this._viewTransform[7]),this._node.sendDrawCommand(this._viewTransform[8]),this._node.sendDrawCommand(this._viewTransform[9]),this._node.sendDrawCommand(this._viewTransform[10]),this._node.sendDrawCommand(this._viewTransform[11]),this._node.sendDrawCommand(this._viewTransform[12]),this._node.sendDrawCommand(this._viewTransform[13]),this._node.sendDrawCommand(this._viewTransform[14]),this._node.sendDrawCommand(this._viewTransform[15]))},n.prototype.onTransformChange=function(t){var e=t;this._viewDirty=!0,this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],h=e[6],u=e[7],c=e[8],p=e[9],l=e[10],d=e[11],f=e[12],m=e[13],g=e[14],y=e[15],_=i*a-n*o,v=i*h-r*o,b=i*u-s*o,T=n*h-r*a,w=n*u-s*a,E=r*u-s*h,I=c*m-p*f,C=c*g-l*f,x=c*y-d*f,R=p*g-l*m,A=p*y-d*m,S=l*y-d*g,O=1/(_*S-v*A+b*R+T*x-w*C+E*I);this._viewTransform[0]=(a*S-h*A+u*R)*O,this._viewTransform[1]=(r*A-n*S-s*R)*O,this._viewTransform[2]=(m*E-g*w+y*T)*O,this._viewTransform[3]=(l*w-p*E-d*T)*O,this._viewTransform[4]=(h*x-o*S-u*C)*O,this._viewTransform[5]=(i*S-r*x+s*C)*O,this._viewTransform[6]=(g*b-f*E-y*v)*O,this._viewTransform[7]=(c*E-l*b+d*v)*O,this._viewTransform[8]=(o*A-a*x+u*I)*O,this._viewTransform[9]=(n*x-i*A-s*I)*O,this._viewTransform[10]=(f*w-m*b+y*_)*O,this._viewTransform[11]=(p*b-c*w-d*_)*O,this._viewTransform[12]=(a*C-o*R-h*I)*O,this._viewTransform[13]=(i*R-n*C+r*I)*O,this._viewTransform[14]=(m*v-f*T-g*_)*O,this._viewTransform[15]=(c*T-p*v+l*_)*O},e.exports=n},{"../core/Commands":8}],3:[function(t,e,i){"use strict";function n(t){this._node=t,this._id=t.addComponent(this),this._value=new r(1),this._requestingUpdate=!1}var r=t("../transitions/Transitionable");n.prototype.toString=function(){return"Opacity"},n.prototype.getValue=function(){return{component:this.toString(),value:this._value.get()}},n.prototype.setValue=function(t){return this.toString()===t.component?(this.set(t.value),!0):!1},n.prototype.set=function(t,e,i){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._value.set(t,e,i),this},n.prototype.get=function(){return this._value.get()},n.prototype.halt=function(){return this._value.halt(),this},n.prototype.isActive=function(){return this._value.isActive()},n.prototype.update=function(){this._node.setOpacity(this._value.get()),this._value.isActive()?this._node.requestUpdateOnNextTick(this._id):this._requestingUpdate=!1},n.prototype.onUpdate=n.prototype.update,e.exports=n},{"../transitions/Transitionable":76}],4:[function(t,e,i){"use strict";function n(t){this._node=t,this._id=t.addComponent(this),this._requestingUpdate=!1;var e=t.getPosition();this._x=new r(e[0]),this._y=new r(e[1]),this._z=new r(e[2])}var r=t("../transitions/Transitionable");n.prototype.toString=function(){return"Position"},n.prototype.getValue=function(){return{component:this.toString(),x:this._x.get(),y:this._y.get(),z:this._z.get()}},n.prototype.setValue=function(t){return this.toString()===t.component?(this.set(t.x,t.y,t.z),!0):!1},n.prototype.getX=function(){return this._x.get()},n.prototype.getY=function(){return this._y.get()},n.prototype.getZ=function(){return this._z.get()},n.prototype.isActive=function(){return this._x.isActive()||this._y.isActive()||this._z.isActive()},n.prototype._checkUpdate=function(){this.isActive()?this._node.requestUpdateOnNextTick(this._id):this._requestingUpdate=!1},n.prototype.update=function(){this._node.setPosition(this._x.get(),this._y.get(),this._z.get()),this._checkUpdate()},n.prototype.onUpdate=n.prototype.update,n.prototype.setX=function(t,e,i){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._x.set(t,e,i),this},n.prototype.setY=function(t,e,i){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._y.set(t,e,i),this},n.prototype.setZ=function(t,e,i){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._z.set(t,e,i),this},n.prototype.set=function(t,e,i,n,r){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var s,o,a;return null!=i?a=r:null!=e?o=r:null!=t&&(s=r),null!=t&&this._x.set(t,n,s),null!=e&&this._y.set(e,n,o),null!=i&&this._z.set(i,n,a),this},n.prototype.halt=function(){return this._x.halt(),this._y.halt(),this._z.halt(),this},e.exports=n},{"../transitions/Transitionable":76}],5:[function(t,e,i){"use strict";function n(t){r.call(this,t);var e=t.getRotation(),i=e[0],n=e[1],s=e[2],o=e[3],a=i*i,h=n*n,u=s*s,c=2*(i*s+n*o);c=-1>c?-1:c>1?1:c;var p=Math.atan2(2*(i*o-n*s),1-2*(a+h)),l=Math.asin(c),d=Math.atan2(2*(s*o-i*n),1-2*(h+u));this._x.set(p),this._y.set(l),this._z.set(d)}var r=t("./Position");n.prototype.toString=function(){return"Rotation"},n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.update=function(){this._node.setRotation(this._x.get(),this._y.get(),this._z.get()),this._checkUpdate()},n.prototype.onUpdate=n.prototype.update,e.exports=n},{"./Position":4}],6:[function(t,e,i){"use strict";function n(){"undefined"!=typeof self&&self.window!==self&&this._enterWorkerMode()}n.prototype._enterWorkerMode=function(){this._workerMode=!0;var t=this;self.addEventListener("message",function(e){t.onMessage(e.data)})},n.prototype.onMessage=null,n.prototype.sendMessage=function(t){this._workerMode?self.postMessage(t):this.onmessage(t)},n.prototype.onmessage=null,n.prototype.postMessage=function(t){return this.onMessage(t)},e.exports=n},{}],7:[function(t,e,i){"use strict";function n(){this._time=0,this._frame=0,this._timerQueue=[],this._updatingIndex=0,this._scale=1,this._scaledTime=this._time}n.prototype.setScale=function(t){return this._scale=t,this},n.prototype.getScale=function(){return this._scale},n.prototype.step=function(t){this._frame++,this._scaledTime=this._scaledTime+(t-this._time)*this._scale,this._time=t;for(var e=0;e<this._timerQueue.length;e++)this._timerQueue[e](this._scaledTime)&&this._timerQueue.splice(e,1);return this},n.prototype.now=function(){return this._scaledTime},n.prototype.getTime=n.prototype.now,n.prototype.getFrame=function(){return this._frame},n.prototype.setTimeout=function(t,e){var i=Array.prototype.slice.call(arguments,2),n=this._time,r=function(r){return r-n>=e?(t.apply(null,i),!0):!1};return this._timerQueue.push(r),r},n.prototype.setInterval=function(t,e){var i=Array.prototype.slice.call(arguments,2),n=this._time,r=function(r){return r-n>=e&&(t.apply(null,i),n=r),!1};return this._timerQueue.push(r),r},n.prototype.clearTimer=function(t){var e=this._timerQueue.indexOf(t);return-1!==e&&this._timerQueue.splice(e,1),this},e.exports=n},{}],8:[function(t,e,i){"use strict";var n={INIT_DOM:0,DOM_RENDER_SIZE:1,CHANGE_TRANSFORM:2,CHANGE_SIZE:3,CHANGE_PROPERTY:4,CHANGE_CONTENT:5,CHANGE_ATTRIBUTE:6,ADD_CLASS:7,REMOVE_CLASS:8,SUBSCRIBE:9,GL_SET_DRAW_OPTIONS:10,GL_AMBIENT_LIGHT:11,GL_LIGHT_POSITION:12,GL_LIGHT_COLOR:13,MATERIAL_INPUT:14,GL_SET_GEOMETRY:15,GL_UNIFORMS:16,GL_BUFFER_DATA:17,GL_CUTOUT_STATE:18,GL_MESH_VISIBILITY:19,GL_REMOVE_MESH:20,PINHOLE_PROJECTION:21,ORTHOGRAPHIC_PROJECTION:22,CHANGE_VIEW_TRANSFORM:23,WITH:24,FRAME:25,ENGINE:26,START:27,STOP:28,TIME:29,TRIGGER:30,NEED_SIZE_FOR:31,DOM:32,READY:33,ALLOW_DEFAULT:34,PREVENT_DEFAULT:35,UNSUBSCRIBE:36,prettyPrint:function(t,e,i){var n;e=e?e:0;for(var s={i:e,result:""},o=i?i+e:t.length;s.i<o;s.i++){if(n=r[t[s.i]],!n)throw new Error("PARSE ERROR: no command registered for: "+t[s.i]);n(t,s)}return s.result}},r=[];r[n.INIT_DOM]=function(t,e){e.result+=e.i+". INIT_DOM\n    tagName: "+t[++e.i]+"\n\n"},r[n.DOM_RENDER_SIZE]=function(t,e){e.result+=e.i+". DOM_RENDER_SIZE\n    selector: "+t[++e.i]+"\n\n"},r[n.CHANGE_TRANSFORM]=function(t,e){e.result+=e.i+". CHANGE_TRANSFORM\n    val: [";for(var i=0;16>i;i++)e.result+=t[++e.i]+(15>i?", ":"");e.result+="]\n\n"},r[n.CHANGE_SIZE]=function(t,e){e.result+=e.i+". CHANGE_SIZE\n    x: "+t[++e.i]+", y: "+t[++e.i]+"\n\n"},r[n.CHANGE_PROPERTY]=function(t,e){e.result+=e.i+". CHANGE_PROPERTY\n    key: "+t[++e.i]+", value: "+t[++e.i]+"\n\n"},r[n.CHANGE_CONTENT]=function(t,e){e.result+=e.i+". CHANGE_CONTENT\n    content: "+t[++e.i]+"\n\n"},r[n.CHANGE_ATTRIBUTE]=function(t,e){e.result+=e.i+". CHANGE_ATTRIBUTE\n    key: "+t[++e.i]+", value: "+t[++e.i]+"\n\n"},r[n.ADD_CLASS]=function(t,e){e.result+=e.i+". ADD_CLASS\n    className: "+t[++e.i]+"\n\n"},r[n.REMOVE_CLASS]=function(t,e){e.result+=e.i+". REMOVE_CLASS\n    className: "+t[++e.i]+"\n\n"},r[n.SUBSCRIBE]=function(t,e){e.result+=e.i+". SUBSCRIBE\n    event: "+t[++e.i]+"\n\n"},r[n.GL_SET_DRAW_OPTIONS]=function(t,e){e.result+=e.i+". GL_SET_DRAW_OPTIONS\n    options: "+t[++e.i]+"\n\n"},r[n.GL_AMBIENT_LIGHT]=function(t,e){e.result+=e.i+". GL_AMBIENT_LIGHT\n    r: "+t[++e.i]+"g: "+t[++e.i]+"b: "+t[++e.i]+"\n\n"},r[n.GL_LIGHT_POSITION]=function(t,e){e.result+=e.i+". GL_LIGHT_POSITION\n    x: "+t[++e.i]+"y: "+t[++e.i]+"z: "+t[++e.i]+"\n\n"},r[n.GL_LIGHT_COLOR]=function(t,e){e.result+=e.i+". GL_LIGHT_COLOR\n    r: "+t[++e.i]+"g: "+t[++e.i]+"b: "+t[++e.i]+"\n\n"},r[n.MATERIAL_INPUT]=function(t,e){e.result+=e.i+". MATERIAL_INPUT\n    key: "+t[++e.i]+", value: "+t[++e.i]+"\n\n"},r[n.GL_SET_GEOMETRY]=function(t,e){e.result+=e.i+". GL_SET_GEOMETRY\n   x: "+t[++e.i]+", y: "+t[++e.i]+", z: "+t[++e.i]+"\n\n"},r[n.GL_UNIFORMS]=function(t,e){e.result+=e.i+". GL_UNIFORMS\n    key: "+t[++e.i]+", value: "+t[++e.i]+"\n\n"},r[n.GL_BUFFER_DATA]=function(t,e){e.result+=e.i+". GL_BUFFER_DATA\n    data: ";for(var i=0;5>i;i++)e.result+=t[++e.i]+", ";e.result+="\n\n"},r[n.GL_CUTOUT_STATE]=function(t,e){e.result+=e.i+". GL_CUTOUT_STATE\n    state: "+t[++e.i]+"\n\n"},r[n.GL_MESH_VISIBILITY]=function(t,e){e.result+=e.i+". GL_MESH_VISIBILITY\n    visibility: "+t[++e.i]+"\n\n"},r[n.GL_REMOVE_MESH]=function(t,e){e.result+=e.i+". GL_REMOVE_MESH\n\n"},r[n.PINHOLE_PROJECTION]=function(t,e){e.result+=e.i+". PINHOLE_PROJECTION\n    depth: "+t[++e.i]+"\n\n"},r[n.ORTHOGRAPHIC_PROJECTION]=function(t,e){e.result+=e.i+". ORTHOGRAPHIC_PROJECTION\n"},r[n.CHANGE_VIEW_TRANSFORM]=function(t,e){e.result+=e.i+". CHANGE_VIEW_TRANSFORM\n   value: [";for(var i=0;16>i;i++)e.result+=t[++e.i]+(15>i?", ":"");e.result+="]\n\n"},r[n.PREVENT_DEFAULT]=function(t,e){e.result+=e.i+". PREVENT_DEFAULT\n    value: "+t[++e.i]+"\n\n"},r[n.ALLOW_DEFAULT]=function(t,e){e.result+=e.i+". ALLOW_DEFAULT\n    value: "+t[++e.i]+"\n\n"},r[n.READY]=function(t,e){e.result+=e.i+". READY\n\n"},r[n.WITH]=function(t,e){e.result+=e.i+". **WITH**\n     path: "+t[++e.i]+"\n\n"},r[n.TIME]=function(t,e){e.result+=e.i+". TIME\n     ms: "+t[++e.i]+"\n\n"},r[n.NEED_SIZE_FOR]=function(t,e){e.result+=e.i+". NEED_SIZE_FOR\n    selector: "+t[++e.i]+"\n\n"},e.exports=n},{}],9:[function(t,e,i){"use strict";function n(){this._nodes={},this._queue=[]}function r(t,e){e.length=0;var i,n=0,r=t.length;for(i=0;r>i;i++)"/"===t[i]&&(e.push(t.substring(n,i)),n=i+1);return i-n>0&&e.push(t.substring(n,i)),e}var s=t("./Event"),o=t("./Path");n.prototype._setUpdater=function(t){this._updater=t;for(var e in this._nodes)this._nodes[e]._setUpdater(t)},n.prototype.addChildrenToQueue=function(t){for(var e,i=t.getChildren(),n=0,r=i.length;r>n;n++)e=i[n],e&&this._queue.push(e)},n.prototype.next=function(){return this._queue.shift()},n.prototype.breadthFirstNext=function(){var t=this._queue.shift();return t?(this.addChildrenToQueue(t),t):void 0},n.prototype.mount=function(t,e){if(!e)throw new Error("Dispatch: no node passed to mount at: "+t);if(this._nodes[t])throw new Error("Dispatch: there is a node already registered at: "+t);e._setUpdater(this._updater),this._nodes[t]=e;var i=o.parent(t),n=i?this._nodes[i]:e;if(!n)throw new Error("Parent to path: "+t+" doesn't exist at expected path: "+i);var r,s,a=e.getChildren(),h=e.getComponents();if(n.isMounted()&&e._setMounted(!0,t),n.isShown()&&e._setShown(!0),n.isMounted()){for(e._setParent(n),e.onMount&&e.onMount(t),r=0,s=h.length;s>r;r++)h[r]&&h[r].onMount&&h[r].onMount(e,r);for(r=0,s=a.length;s>r;r++)a[r]&&a[r].mount?a[r].mount(t+"/"+r):a[r]&&this.mount(t+"/"+r,a[r])}if(n.isShown())for(e.onShow&&e.onShow(),r=0,s=h.length;s>r;r++)h[r]&&h[r].onShow&&h[r].onShow()},n.prototype.dismount=function(t){var e=this._nodes[t];if(!e)throw new Error("No node registered to path: "+t);var i,n,r=e.getChildren(),s=e.getComponents();if(e.isShown())for(e._setShown(!1),e.onHide&&e.onHide(),i=0,n=s.length;n>i;i++)s[i]&&s[i].onHide&&s[i].onHide();if(e.isMounted()){for(e.onDismount&&e.onDismount(t),i=0,n=r.length;n>i;i++)r[i]&&r[i].dismount?r[i].dismount():r[i]&&this.dismount(t+"/"+i);for(i=0,n=s.length;n>i;i++)s[i]&&s[i].onDismount&&s[i].onDismount();e._setMounted(!1),e._setParent(null)}this._nodes[t]=null},n.prototype.getNode=function(t){return this._nodes[t]},n.prototype.show=function(t){var e=this._nodes[t];if(!e)throw new Error("No node registered to path: "+t);e.onShow&&e.onShow();for(var i=e.getComponents(),n=0,r=i.length;r>n;n++)i[n]&&i[n].onShow&&i[n].onShow();this.addChildrenToQueue(e);for(var s;s=this.breadthFirstNext();)this.show(s.getLocation())},n.prototype.hide=function(t){var e=this._nodes[t];if(!e)throw new Error("No node registered to path: "+t);e.onHide&&e.onHide();for(var i=e.getComponents(),n=0,r=i.length;r>n;n++)i[n]&&i[n].onHide&&i[n].onHide();this.addChildrenToQueue(e);for(var s;s=this.breadthFirstNext();)this.hide(s.getLocation())},n.prototype.lookupNode=function(t){if(!t)throw new Error("lookupNode must be called with a path");this._queue.length=0;var e=this._queue;r(t,e);for(var i=0,n=e.length;n>i;i++)e[i]=this._nodes[e[i]];return e[e.length-1]},n.prototype.dispatch=function(t,e,i){if(!t)throw new Error("dispatch requires a path as it's first argument");if(!e)throw new Error("dispatch requires an event name as it's second argument");var n=this._nodes[t];if(n){this.addChildrenToQueue(n);for(var r;r=this.breadthFirstNext();)r&&r.onReceive&&r.onReceive(e,i)}},n.prototype.dispatchUIEvent=function(t,e,i){if(!t)throw new Error("dispatchUIEvent needs a valid path to dispatch to");if(!e)throw new Error("dispatchUIEvent needs an event name as its second argument");var n;if(s.call(i),n=this.getNode(t)){var r,o,a,h;for(i.node=n;n;){for(n.onReceive&&n.onReceive(e,i),o=n.getComponents(),a=0,h=o.length;h>a;a++)o[a]&&o[a].onReceive&&o[a].onReceive(e,i);if(i.propagationStopped)break;if(r=n.getParent(),r===n)return;n=r}}},e.exports=new n},{"./Event":10,"./Path":13}],10:[function(t,e,i){"use strict";function n(){this.propagationStopped=!1,this.stopPropagation=r}function r(){this.propagationStopped=!0}e.exports=n},{}],11:[function(t,e,i){"use strict";function n(){var t=this;a._setUpdater(this),this._updateQueue=[],this._nextUpdateQueue=[],this._scenes={},this._messages=g,this._inUpdate=!1,this._clock=new r,this._channel=new o,this._channel.onMessage=function(e){t.handleMessage(e)}}var r=t("./Clock"),s=t("./Scene"),o=t("./Channel"),a=t("./Dispatch"),h=t("../renderers/UIManager"),u=t("../renderers/Compositor"),c=t("../render-loops/RequestAnimationFrameLoop"),p=t("./TransformSystem"),l=t("./SizeSystem"),d=t("./Commands"),f=[d.ENGINE,d.START],m=[d.ENGINE,d.STOP],g=[d.TIME,null];n.prototype.init=function(t){if("undefined"==typeof window)throw new Error("FamousEngine#init needs to have access to the global window object. Instantiate Compositor and UIManager manually in the UI thread.");return this.compositor=t&&t.compositor||new u,this.renderLoop=t&&t.renderLoop||new c,this.uiManager=new h(this.getChannel(),this.compositor,this.renderLoop),this},n.prototype.setChannel=function(t){return this._channel=t,this},n.prototype.getChannel=function(){return this._channel},n.prototype._update=function(){this._inUpdate=!0;var t,e=this._clock.now(),i=this._nextUpdateQueue,n=this._updateQueue;for(this._messages[1]=e,l.update(),p.update();i.length;)n.unshift(i.pop());for(;n.length;)t=n.shift(),t&&t.update&&t.update(e),t&&t.onUpdate&&t.onUpdate(e);this._inUpdate=!1},n.prototype.requestUpdate=function(t){if(!t)throw new Error("requestUpdate must be called with a class to be updated");this._inUpdate?this.requestUpdateOnNextTick(t):this._updateQueue.push(t)},n.prototype.requestUpdateOnNextTick=function(t){this._nextUpdateQueue.push(t)},n.prototype.handleMessage=function(t){if(!t)throw new Error("onMessage must be called with an array of messages");for(var e;t.length>0;)switch(e=t.shift()){case d.WITH:this.handleWith(t);break;case d.FRAME:this.handleFrame(t);break;default:throw new Error("received unknown command: "+e)}return this},n.prototype.handleWith=function(t){var e=t.shift(),i=t.shift();switch(i){case d.TRIGGER:var n=t.shift(),r=t.shift();a.dispatchUIEvent(e,n,r);break;default:throw new Error("received unknown command: "+i)}return this},n.prototype.handleFrame=function(t){if(!t)throw new Error("handleFrame must be called with an array of messages");if(!t.length)throw new Error("FRAME must be sent with a time");return this.step(t.shift()),this},n.prototype.step=function(t){if(null==t)throw new Error("step must be called with a time");if(this._clock.step(t),this._update(),this._messages.length)for(this._channel.sendMessage(this._messages);this._messages.length>2;)this._messages.pop();return this},n.prototype.getContext=function(t){if(!t)throw new Error("getContext must be called with a selector");var e=t.indexOf("/");return t=-1===e?t:t.substring(0,e),this._scenes[t]},n.prototype.getClock=function(){return this._clock},n.prototype.message=function(t){return this._messages.push(t),this},n.prototype.createScene=function(t){return t=t||"body",this._scenes[t]&&this._scenes[t].dismount(),this._scenes[t]=new s(t,this),this._scenes[t]},n.prototype.addScene=function(t){var e=t._selector,i=this._scenes[e];return i&&i!==t&&i.dismount(),t.isMounted()||t.mount(t.getSelector()),this._scenes[e]=t,this},n.prototype.removeScene=function(t){var e=t._selector,i=this._scenes[e];return i&&i===t&&(t.isMounted()&&t.dismount(),delete this._scenes[e]),this},n.prototype.startRenderLoop=function(){return this._channel.sendMessage(f),this},n.prototype.stopRenderLoop=function(){return this._channel.sendMessage(m),this},n.prototype.startEngine=function(){return console.warn("FamousEngine.startEngine is deprecated! Use FamousEngine.startRenderLoop instead!"),this.startRenderLoop()},n.prototype.stopEngine=function(){return console.warn("FamousEngine.stopEngine is deprecated! Use FamousEngine.stopRenderLoop instead!"),this.stopRenderLoop()},e.exports=new n},{"../render-loops/RequestAnimationFrameLoop":70,"../renderers/Compositor":71,"../renderers/UIManager":73,"./Channel":6,"./Clock":7,"./Commands":8,"./Dispatch":9,"./Scene":15,"./SizeSystem":17,"./TransformSystem":19}],12:[function(t,e,i){"use strict";function n(){this._requestingUpdate=!1,this._inUpdate=!1,this._mounted=!1,this._shown=!0,this._updater=null,this._opacity=1,this._UIEvents=[],this._updateQueue=[],this._nextUpdateQueue=[],this._freedComponentIndicies=[],this._components=[],this._freedChildIndicies=[],this._children=[],this._fullChildren=[],this._parent=null,this._id=null,this._transformID=null,this._sizeID=null,this.constructor.NO_DEFAULT_COMPONENTS||this._init()}var r=t("./SizeSystem"),s=t("./Dispatch"),o=t("./TransformSystem"),a=t("./Size"),h=t("./Transform");n.RELATIVE_SIZE=0,n.ABSOLUTE_SIZE=1,n.RENDER_SIZE=2,n.DEFAULT_SIZE=0,n.NO_DEFAULT_COMPONENTS=!1,n.prototype._init=function(){this._transformID=this.addComponent(new h),this._sizeID=this.addComponent(new a)},n.prototype._setParent=function(t){this._parent&&-1!==this._parent.getChildren().indexOf(this)&&this._parent.removeChild(this),this._parent=t},n.prototype._setMounted=function(t,e){this._mounted=t,this._id=e?e:null},n.prototype._setShown=function(t){this._shown=t},n.prototype._setUpdater=function(t){this._updater=t,this._requestingUpdate&&this._updater.requestUpdate(this)},n.prototype.getLocation=function(){return this._id},n.prototype.getId=n.prototype.getLocation,n.prototype.emit=function(t,e){return s.dispatch(this.getLocation(),t,e),this},n.prototype.sendDrawCommand=function(t){return this._updater.message(t),this},n.prototype.getValue=function(){var t=this._children.length,e=this._components.length,i=0,n={location:this.getId(),spec:{location:this.getId(),showState:{mounted:this.isMounted(),shown:this.isShown(),opacity:this.getOpacity()||null},offsets:{mountPoint:[0,0,0],align:[0,0,0],origin:[0,0,0]},vectors:{position:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1]},size:{sizeMode:[0,0,0],proportional:[1,1,1],differential:[0,0,0],absolute:[0,0,0],render:[0,0,0]}},UIEvents:this._UIEvents,components:[],children:[]};if(n.location){var s=o.get(this.getId()),a=r.get(this.getId());for(i=0;3>i;i++)n.spec.offsets.mountPoint[i]=s.offsets.mountPoint[i],n.spec.offsets.align[i]=s.offsets.align[i],n.spec.offsets.origin[i]=s.offsets.origin[i],n.spec.vectors.position[i]=s.vectors.position[i],n.spec.vectors.rotation[i]=s.vectors.rotation[i],n.spec.vectors.scale[i]=s.vectors.scale[i],n.spec.size.sizeMode[i]=a.sizeMode[i],n.spec.size.proportional[i]=a.proportionalSize[i],n.spec.size.differential[i]=a.differentialSize[i],n.spec.size.absolute[i]=a.absoluteSize[i],n.spec.size.render[i]=a.renderSize[i];n.spec.vectors.rotation[3]=s.vectors.rotation[3]}for(i=0;t>i;i++)this._children[i]&&this._children[i].getValue&&n.children.push(this._children[i].getValue());for(i=0;e>i;i++)this._components[i]&&this._components[i].getValue&&n.components.push(this._components[i].getValue());return n},n.prototype.getComputedValue=function(){console.warn("Node.getComputedValue is depricated. Use Node.getValue instead");for(var t=this._children.length,e={location:this.getId(),computedValues:{transform:this.isMounted()?o.get(this.getLocation()).getLocalTransform():null,size:this.isMounted()?r.get(this.getLocation()).get():null},children:[]},i=0;t>i;i++)this._children[i]&&this._children[i].getComputedValue&&e.children.push(this._children[i].getComputedValue());return e},n.prototype.getChildren=function(){return this._fullChildren},n.prototype.getRawChildren=function(){return this._children},n.prototype.getParent=function(){return this._parent},n.prototype.requestUpdate=function(t){return this._inUpdate||!this.isMounted()?this.requestUpdateOnNextTick(t):(-1===this._updateQueue.indexOf(t)&&(this._updateQueue.push(t),this._requestingUpdate||this._requestUpdate()),this)},n.prototype.requestUpdateOnNextTick=function(t){return-1===this._nextUpdateQueue.indexOf(t)&&this._nextUpdateQueue.push(t),this},n.prototype.isMounted=function(){return this._mounted},n.prototype.isRendered=function(){return this._mounted&&this._shown},n.prototype.isShown=function(){return this._shown},n.prototype.getOpacity=function(){return this._opacity},n.prototype.getMountPoint=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return o.get(this.getLocation()).getMountPoint();throw new Error("This node does not have access to a transform component")}return this.getComponent(this._transformID).getMountPoint()},n.prototype.getAlign=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return o.get(this.getLocation()).getAlign();throw new Error("This node does not have access to a transform component")}return this.getComponent(this._transformID).getAlign()},n.prototype.getOrigin=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return o.get(this.getLocation()).getOrigin();throw new Error("This node does not have access to a transform component")}return this.getComponent(this._transformID).getOrigin()},n.prototype.getPosition=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return o.get(this.getLocation()).getPosition();throw new Error("This node does not have access to a transform component")}return this.getComponent(this._transformID).getPosition()},n.prototype.getRotation=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return o.get(this.getLocation()).getRotation();throw new Error("This node does not have access to a transform component")}return this.getComponent(this._transformID).getRotation()},n.prototype.getScale=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return o.get(this.getLocation()).getScale();throw new Error("This node does not have access to a transform component")}return this.getComponent(this._transformID).getScale()},n.prototype.getSizeMode=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return r.get(this.getLocation()).getSizeMode();throw new Error("This node does not have access to a size component")}return this.getComponent(this._sizeID).getSizeMode()},n.prototype.getProportionalSize=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return r.get(this.getLocation()).getProportional();throw new Error("This node does not have access to a size component")}return this.getComponent(this._sizeID).getProportional()},n.prototype.getDifferentialSize=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return r.get(this.getLocation()).getDifferential();throw new Error("This node does not have access to a size component")}return this.getComponent(this._sizeID).getDifferential()},n.prototype.getAbsoluteSize=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return r.get(this.getLocation()).getAbsolute();throw new Error("This node does not have access to a size component")}return this.getComponent(this._sizeID).getAbsolute()},n.prototype.getRenderSize=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return r.get(this.getLocation()).getRender();throw new Error("This node does not have access to a size component")}return this.getComponent(this._sizeID).getRender()},n.prototype.getSize=function(){if(this.constructor.NO_DEFAULT_COMPONENTS){if(this.isMounted())return r.get(this.getLocation()).get();throw new Error("This node does not have access to a size component")}return this.getComponent(this._sizeID).get()},n.prototype.getTransform=function(){return o.get(this.getLocation())},n.prototype.getUIEvents=function(){return this._UIEvents},n.prototype.addChild=function(t){var e=t?this._children.indexOf(t):-1;return t=t?t:new n,-1===e&&(e=this._freedChildIndicies.length?this._freedChildIndicies.pop():this._children.length,this._children[e]=t,this._fullChildren.push(t)),this.isMounted()&&t.mount(this.getLocation()+"/"+e),t},n.prototype.removeChild=function(t){var e=this._children.indexOf(t);if(e>-1){this._freedChildIndicies.push(e),this._children[e]=null,t.isMounted()&&t.dismount();var i=this._fullChildren.indexOf(t),n=this._fullChildren.length,r=0;for(r=i;n-1>r;r++)this._fullChildren[r]=this._fullChildren[r+1];return this._fullChildren.pop(),!0}return!1},n.prototype.addComponent=function(t){var e=this._components.indexOf(t);return-1===e&&(e=this._freedComponentIndicies.length?this._freedComponentIndicies.pop():this._components.length,this._components[e]=t,this.isMounted()&&t.onMount&&t.onMount(this,e),this.isShown()&&t.onShow&&t.onShow()),e},n.prototype.getComponent=function(t){return this._components[t]},n.prototype.removeComponent=function(t){var e=this._components.indexOf(t);return-1!==e&&(this._freedComponentIndicies.push(e),this.isShown()&&t.onHide&&t.onHide(),this.isMounted()&&t.onDismount&&t.onDismount(),this._components[e]=null),t},n.prototype.removeUIEvent=function(t){var e,i=this.getUIEvents(),n=this._components,r=i.indexOf(t);if(-1!==r){i.splice(r,1);for(var s=0,o=n.length;o>s;s++)e=n[s],e&&e.onRemoveUIEvent&&e.onRemoveUIEvent(t)}},n.prototype.addUIEvent=function(t){var e,i=this.getUIEvents(),n=this._components,r=-1!==i.indexOf(t);if(!r){i.push(t);for(var s=0,o=n.length;o>s;s++)e=n[s],e&&e.onAddUIEvent&&e.onAddUIEvent(t)}return this},n.prototype._requestUpdate=function(t){(t||!this._requestingUpdate)&&(this._updater&&this._updater.requestUpdate(this),this._requestingUpdate=!0)},n.prototype._vecOptionalSet=function(t,e,i){return null!=i&&t[e]!==i?(t[e]=i,this._requestingUpdate||this._requestUpdate(),!0):!1},n.prototype.show=function(){return s.show(this.getLocation()),this._shown=!0,this},n.prototype.hide=function(){return s.hide(this.getLocation()),this._shown=!1,this},n.prototype.setAlign=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a transform component");o.get(this.getLocation()).setAlign(t,e,i);
}else this.getComponent(this._transformID).setAlign(t,e,i);return this},n.prototype.setMountPoint=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a transform component");o.get(this.getLocation()).setMountPoint(t,e,i)}else this.getComponent(this._transformID).setMountPoint(t,e,i);return this},n.prototype.setOrigin=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a transform component");o.get(this.getLocation()).setOrigin(t,e,i)}else this.getComponent(this._transformID).setOrigin(t,e,i);return this},n.prototype.setPosition=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a transform component");o.get(this.getLocation()).setPosition(t,e,i)}else this.getComponent(this._transformID).setPosition(t,e,i);return this},n.prototype.setRotation=function(t,e,i,n){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a transform component");o.get(this.getLocation()).setRotation(t,e,i,n)}else this.getComponent(this._transformID).setRotation(t,e,i,n);return this},n.prototype.setScale=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a transform component");o.get(this.getLocation()).setScale(t,e,i)}else this.getComponent(this._transformID).setScale(t,e,i);return this},n.prototype.setOpacity=function(t){if(t!==this._opacity){this._opacity=t,this._requestingUpdate||this._requestUpdate();for(var e,i=0,n=this._components,r=n.length;r>i;i++)e=n[i],e&&e.onOpacityChange&&e.onOpacityChange(t)}return this},n.prototype.setSizeMode=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a size component");r.get(this.getLocation()).setSizeMode(t,e,i)}else this.getComponent(this._sizeID).setSizeMode(t,e,i);return this},n.prototype.setProportionalSize=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a size component");r.get(this.getLocation()).setProportional(t,e,i)}else this.getComponent(this._sizeID).setProportional(t,e,i);return this},n.prototype.setDifferentialSize=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a size component");r.get(this.getLocation()).setDifferential(t,e,i)}else this.getComponent(this._sizeID).setDifferential(t,e,i);return this},n.prototype.setAbsoluteSize=function(t,e,i){if(this.constructor.NO_DEFAULT_COMPONENTS){if(!this.isMounted())throw new Error("This node does not have access to a size component");r.get(this.getLocation()).setAbsolute(t,e,i)}else this.getComponent(this._sizeID).setAbsolute(t,e,i);return this},n.prototype.getFrame=function(){return this._updater.getFrame()},n.prototype.getComponents=function(){return this._components},n.prototype.update=function(t){this._inUpdate=!0;for(var e,i=this._nextUpdateQueue,n=this._updateQueue;i.length;)n.unshift(i.pop());for(;n.length;)e=this._components[n.shift()],e&&e.onUpdate&&e.onUpdate(t);return this._inUpdate=!1,this._requestingUpdate=!1,this.isMounted()?this._nextUpdateQueue.length&&(this._updater.requestUpdateOnNextTick(this),this._requestingUpdate=!0):(this._parent=null,this._id=null),this},n.prototype.mount=function(t){if(this.isMounted())throw new Error("Node is already mounted at: "+this.getLocation());return this.constructor.NO_DEFAULT_COMPONENTS?(o.registerTransformAtPath(t),r.registerSizeAtPath(t)):(o.registerTransformAtPath(t,this.getComponent(this._transformID)),r.registerSizeAtPath(t,this.getComponent(this._sizeID))),s.mount(t,this),this._requestingUpdate||this._requestUpdate(),this},n.prototype.dismount=function(){if(!this.isMounted())throw new Error("Node is not mounted");var t=this.getLocation();o.deregisterTransformAtPath(t),r.deregisterSizeAtPath(t),s.dismount(t),this._requestingUpdate||this._requestUpdate()},e.exports=n},{"./Dispatch":9,"./Size":16,"./SizeSystem":17,"./Transform":18,"./TransformSystem":19}],13:[function(t,e,i){"use strict";var n={hasTrailingSlash:function(t){return"/"===t[t.length-1]},depth:function(t){for(var e=0,i=t.length,n=this.hasTrailingSlash(t)?i-1:i,r=0;n>r;r++)e+="/"===t[r]?1:0;return e},index:function(t){for(var e=t.length,i=this.hasTrailingSlash(t)?e-1:e;i--&&"/"!==t[i];);var n=parseInt(t.substring(i+1));return isNaN(n)?0:n},indexAtDepth:function(t,e){for(var i=0,n=t.length,r=0;n>i;i++)if("/"===t[i]&&r++,r===e)return t=t.substring(i?i+1:i),r=t.indexOf("/"),t=-1===r?t:t.substring(0,r),r=parseInt(t),isNaN(r)?t:r},parent:function(t){return t.substring(0,t.lastIndexOf("/",t.length-2))},isChildOf:function(t,e){return this.isDescendentOf(t,e)&&this.depth(t)===this.depth(e)+1},isDescendentOf:function(t,e){return t===e?!1:(t=this.hasTrailingSlash(t)?t:t+"/",e=this.hasTrailingSlash(e)?e:e+"/",this.depth(e)<this.depth(t)&&0===t.indexOf(e))},getSelector:function(t){var e=t.indexOf("/");return-1===e?t:t.substring(0,e)}};e.exports=n},{}],14:[function(t,e,i){"use strict";function n(){this.items=[],this.paths=[],this.memo={}}var r=t("./Path");n.prototype.insert=function(t,e){var i=this.paths,n=i.indexOf(t);if(-1!==n)throw new Error("item already exists at path: "+t);for(var s=0,o=r.depth(t),a=r.index(t);i[s]&&o>=r.depth(i[s]);)s++;for(;i[s]&&o===r.depth(i[s])&&a<r.index(i[s]);)s++;i.splice(s,0,t),this.items.splice(s,0,e),this.memo[t]=s;for(var h=this.paths.length;h>s;s++)this.memo[this.paths[s]]=null},n.prototype.remove=function(t){var e=this.paths,i=this.memo[t]?this.memo[t]:e.indexOf(t);if(-1===i)throw new Error("Cannot remove. No item exists at path: "+t);e.splice(i,1),this.items.splice(i,1),this.memo[t]=null;for(var n=this.paths.length;n>i;i++)this.memo[this.paths[i]]=null},n.prototype.get=function(t){if(this.memo[t])return this.items[this.memo[t]];var e=this.paths.indexOf(t);return-1===e?void 0:(this.memo[t]=e,this.items[e])},n.prototype.getItems=function(){return this.items},n.prototype.getPaths=function(){return this.paths},e.exports=n},{"./Path":13}],15:[function(t,e,i){"use strict";function n(t,e){if(!t)throw new Error("Scene needs to be created with a DOM selector");if(!e)throw new Error("Scene needs to be created with a class like Famous");r.call(this),this._globalUpdater=e,this._selector=t,this.mount(t),this._globalUpdater.message(o.NEED_SIZE_FOR).message(t),this.show()}var r=t("./Node"),s=t("./Dispatch"),o=t("./Commands"),a=t("./TransformSystem"),h=t("./SizeSystem");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.NO_DEFAULT_COMPONENTS=!0,n.prototype.getUpdater=function(){return this._updater},n.prototype.getSelector=function(){return this._selector},n.prototype.getDispatch=function(){return console.warn("Scene#getDispatch is deprecated, require the dispatch directly"),s},n.prototype.onReceive=function(t,e){if("CONTEXT_RESIZE"===t){if(e.length<2)throw new Error("CONTEXT_RESIZE's payload needs to be at least a pair of pixel sizes");this.setSizeMode("absolute","absolute","absolute"),this.setAbsoluteSize(e[0],e[1],e[2]?e[2]:0),this._updater.message(o.WITH).message(this._selector).message(o.READY)}},n.prototype.mount=function(t){if(this.isMounted())throw new Error("Scene is already mounted at: "+this.getLocation());s.mount(t,this),this._id=t,this._mounted=!0,this._parent=this,a.registerTransformAtPath(t),h.registerSizeAtPath(t)},e.exports=n},{"./Commands":8,"./Dispatch":9,"./Node":12,"./SizeSystem":17,"./TransformSystem":19}],16:[function(t,e,i){"use strict";function n(t){this.finalSize=new Float32Array(3),this.sizeChanged=!1,this.sizeMode=new Uint8Array(3),this.sizeModeChanged=!1,this.absoluteSize=new Float32Array(3),this.absoluteSizeChanged=!1,this.proportionalSize=new Float32Array(a),this.proportionalSizeChanged=!1,this.differentialSize=new Float32Array(3),this.differentialSizeChanged=!1,this.renderSize=new Float32Array(3),this.renderSizeChanged=!1,this.parent=null!=t?t:null}function r(t,e,i){return null!=i&&t[e]!==i?(t[e]=i,!0):!1}function s(t,e,i,n){var s=!1;return s=r(t,0,e)||s,s=r(t,1,i)||s,s=r(t,2,n)||s}function o(t){if(t.constructor===String)switch(t.toLowerCase()){case"relative":case"default":return n.RELATIVE;case"absolute":return n.ABSOLUTE;case"render":return n.RENDER;default:throw new Error("unknown size mode: "+t)}else if(0>t||t>n.RENDER)throw new Error("unknown size mode: "+t);return t}var a=[1,1,1],h=[0,0,0];n.RELATIVE=0,n.ABSOLUTE=1,n.RENDER=2,n.DEFAULT=n.RELATIVE,n.prototype.setParent=function(t){return this.parent=t,this},n.prototype.getParent=function(){return this.parent},n.prototype.setSizeMode=function(t,e,i){return null!=t&&(t=o(t)),null!=e&&(e=o(e)),null!=i&&(i=o(i)),this.sizeModeChanged=s(this.sizeMode,t,e,i),this},n.prototype.getSizeMode=function(){return this.sizeMode},n.prototype.setAbsolute=function(t,e,i){return this.absoluteSizeChanged=s(this.absoluteSize,t,e,i),this},n.prototype.getAbsolute=function(){return this.absoluteSize},n.prototype.setProportional=function(t,e,i){return this.proportionalSizeChanged=s(this.proportionalSize,t,e,i),this},n.prototype.getProportional=function(){return this.proportionalSize},n.prototype.setDifferential=function(t,e,i){return this.differentialSizeChanged=s(this.differentialSize,t,e,i),this},n.prototype.getDifferential=function(){return this.differentialSize},n.prototype.get=function(){return this.finalSize},n.prototype.fromComponents=function(t){for(var e,i,r=this.sizeMode,s=this.finalSize,o=this.parent?this.parent.get():h,a=!1,u=t.length,c=0;3>c;c++){switch(e=s[c],r[c]){case n.RELATIVE:s[c]=o[c]*this.proportionalSize[c]+this.differentialSize[c];break;case n.ABSOLUTE:s[c]=this.absoluteSize[c];break;case n.RENDER:var p,l;for(i=0;u>i;i++)l=t[i],l&&l.getRenderSize&&(p=l.getRenderSize()[c],s[c]=s[c]<p||0===s[c]?p:s[c])}a=a||e!==s[c]}return this.sizeChanged=a,a},e.exports=n},{}],17:[function(t,e,i){"use strict";function n(){this.pathStore=new c}function r(t,e,i){var n=i.getSizeMode(),r=n[0],s=n[1],o=n[2];t.onSizeModeChange&&t.onSizeModeChange(r,s,o);for(var a=0,h=e.length;h>a;a++)e[a]&&e[a].onSizeModeChange&&e[a].onSizeModeChange(r,s,o);i.sizeModeChanged=!1}function s(t,e,i){var n=i.getAbsolute(),r=n[0],s=n[1],o=n[2];t.onAbsoluteSizeChange&&t.onAbsoluteSizeChange(r,s,o);for(var a=0,h=e.length;h>a;a++)e[a]&&e[a].onAbsoluteSizeChange&&e[a].onAbsoluteSizeChange(r,s,o);i.absoluteSizeChanged=!1}function o(t,e,i){var n=i.getProportional(),r=n[0],s=n[1],o=n[2];t.onProportionalSizeChange&&t.onProportionalSizeChange(r,s,o);for(var a=0,h=e.length;h>a;a++)e[a]&&e[a].onProportionalSizeChange&&e[a].onProportionalSizeChange(r,s,o);i.proportionalSizeChanged=!1}function a(t,e,i){var n=i.getDifferential(),r=n[0],s=n[1],o=n[2];t.onDifferentialSizeChange&&t.onDifferentialSizeChange(r,s,o);for(var a=0,h=e.length;h>a;a++)e[a]&&e[a].onDifferentialSizeChange&&e[a].onDifferentialSizeChange(r,s,o);i.differentialSizeChanged=!1}function h(t,e,i){var n=i.getRenderSize(),r=n[0],s=n[1],o=n[2];t.onRenderSizeChange&&t.onRenderSizeChange(r,s,o);for(var a=0,h=e.length;h>a;a++)e[a]&&e[a].onRenderSizeChange&&e[a].onRenderSizeChange(r,s,o);i.renderSizeChanged=!1}function u(t,e,i){var n=i.get(),r=n[0],s=n[1],o=n[2];t.onSizeChange&&t.onSizeChange(r,s,o);for(var a=0,h=e.length;h>a;a++)e[a]&&e[a].onSizeChange&&e[a].onSizeChange(r,s,o);i.sizeChanged=!1}var c=t("./PathStore"),p=t("./Size"),l=t("./Dispatch"),d=t("./Path");n.prototype.registerSizeAtPath=function(t,e){if(!d.depth(t))return this.pathStore.insert(t,e?e:new p);var i=this.pathStore.get(d.parent(t));if(!i)throw new Error("No parent size registered at expected path: "+d.parent(t));e&&e.setParent(i),this.pathStore.insert(t,e?e:new p(i))},n.prototype.deregisterSizeAtPath=function(t){this.pathStore.remove(t)},n.prototype.get=function(t){return this.pathStore.get(t)},n.prototype.update=function(){var t,e,i,n,c,p=this.pathStore.getItems(),d=this.pathStore.getPaths();for(i=0,n=p.length;n>i;i++)t=l.getNode(d[i]),c=t.getComponents(),t&&(e=p[i],e.sizeModeChanged&&r(t,c,e),e.absoluteSizeChanged&&s(t,c,e),e.proportionalSizeChanged&&o(t,c,e),e.differentialSizeChanged&&a(t,c,e),e.renderSizeChanged&&h(t,c,e),e.fromComponents(c)&&u(t,c,e))},e.exports=new n},{"./Dispatch":9,"./Path":13,"./PathStore":14,"./Size":16}],18:[function(t,e,i){"use strict";function n(t){this.local=new Float32Array(n.IDENT),this.global=new Float32Array(n.IDENT),this.offsets={align:new Float32Array(3),alignChanged:!1,mountPoint:new Float32Array(3),mountPointChanged:!1,origin:new Float32Array(3),originChanged:!1},this.vectors={position:new Float32Array(3),positionChanged:!1,rotation:new Float32Array(u),rotationChanged:!1,scale:new Float32Array(c),scaleChanged:!1},this._lastEulerVals=[0,0,0],this._lastEuler=!1,this.parent=t?t:null,this.breakPoint=!1,this.calculatingWorldMatrix=!1}function r(t,e,i){return null!=i&&t[e]!==i?(t[e]=i,!0):!1}function s(t,e,i,n,s){var o=!1;return o=r(t,0,e)||o,o=r(t,1,i)||o,o=r(t,2,n)||o,null!=s&&(o=r(t,3,s)||o),o}function o(t,e){var i=e.getLocalTransform(),r=t.getSize(),s=e.vectors,o=e.offsets,a=t.getParent().getSize(),h=0,u=i[0],c=i[1],p=i[2],l=i[4],d=i[5],f=i[6],m=i[8],g=i[9],y=i[10],_=i[12],v=i[13],b=i[14],T=s.position[0],w=s.position[1],E=s.position[2],I=s.rotation[0],C=s.rotation[1],x=s.rotation[2],R=s.rotation[3],A=s.scale[0],S=s.scale[1],O=s.scale[2],M=o.align[0]*a[0],N=o.align[1]*a[1],D=o.align[2]*a[2],L=o.mountPoint[0]*r[0],z=o.mountPoint[1]*r[1],P=o.mountPoint[2]*r[2],U=o.origin[0]*r[0],F=o.origin[1]*r[1],V=o.origin[2]*r[2],G=R*I,k=R*C,B=R*x,H=I*I,q=C*C,W=x*x,j=I*C,Y=I*x,K=C*x;return i[0]=(1-2*(q+W))*A,i[1]=2*(j+B)*A,i[2]=2*(Y-k)*A,i[3]=0,i[4]=2*(j-B)*S,i[5]=(1-2*(H+W))*S,i[6]=2*(K+G)*S,i[7]=0,i[8]=2*(Y+k)*O,i[9]=2*(K-G)*O,i[10]=(1-2*(H+q))*O,i[11]=0,i[12]=M+T-L+U-(i[0]*U+i[4]*F+i[8]*V),i[13]=N+w-z+F-(i[1]*U+i[5]*F+i[9]*V),i[14]=D+E-P+V-(i[2]*U+i[6]*F+i[10]*V),i[15]=1,e.calculatingWorldMatrix&&e.calculateWorldMatrix()&&(h|=n.WORLD_CHANGED),(u!==i[0]||c!==i[1]||p!==i[2]||l!==i[4]||d!==i[5]||f!==i[6]||m!==i[8]||g!==i[9]||y!==i[10]||_!==i[12]||v!==i[13]||b!==i[14])&&(h|=n.LOCAL_CHANGED),h}function a(t,e){var i=e.getLocalTransform(),r=e.parent.getLocalTransform(),s=t.getSize(),o=e.vectors,a=e.offsets,h=t.getParent().getSize(),u=!1,c=i[0],p=i[1],l=i[2],d=i[4],f=i[5],m=i[6],g=i[8],y=i[9],_=i[10],v=i[12],b=i[13],T=i[14],w=r[0],E=r[1],I=r[2],C=r[4],x=r[5],R=r[6],A=r[8],S=r[9],O=r[10],M=r[12],N=r[13],D=r[14],L=o.position[0],z=o.position[1],P=o.position[2],U=o.rotation[0],F=o.rotation[1],V=o.rotation[2],G=o.rotation[3],k=o.scale[0],B=o.scale[1],H=o.scale[2],q=a.align[0]*h[0],W=a.align[1]*h[1],j=a.align[2]*h[2],Y=a.mountPoint[0]*s[0],K=a.mountPoint[1]*s[1],Q=a.mountPoint[2]*s[2],X=a.origin[0]*s[0],Z=a.origin[1]*s[1],J=a.origin[2]*s[2],$=G*U,tt=G*F,et=G*V,it=U*U,nt=F*F,rt=V*V,st=U*F,ot=U*V,at=F*V,ht=(1-2*(nt+rt))*k,ut=2*(st+et)*k,ct=2*(ot-tt)*k,pt=2*(st-et)*B,lt=(1-2*(it+rt))*B,dt=2*(at+$)*B,ft=2*(ot+tt)*H,mt=2*(at-$)*H,gt=(1-2*(it+nt))*H,yt=q+L-Y+X-(ht*X+pt*Z+ft*J),_t=W+z-K+Z-(ut*X+lt*Z+mt*J),vt=j+P-Q+J-(ct*X+dt*Z+gt*J);return i[0]=w*ht+C*ut+A*ct,i[1]=E*ht+x*ut+S*ct,i[2]=I*ht+R*ut+O*ct,i[3]=0,i[4]=w*pt+C*lt+A*dt,i[5]=E*pt+x*lt+S*dt,i[6]=I*pt+R*lt+O*dt,i[7]=0,i[8]=w*ft+C*mt+A*gt,i[9]=E*ft+x*mt+S*gt,i[10]=I*ft+R*mt+O*gt,i[11]=0,i[12]=w*yt+C*_t+A*vt+M,i[13]=E*yt+x*_t+S*vt+N,i[14]=I*yt+R*_t+O*vt+D,i[15]=1,e.calculatingWorldMatrix&&e.calculateWorldMatrix()&&(u|=n.WORLD_CHANGED),(c!==i[0]||p!==i[1]||l!==i[2]||d!==i[4]||f!==i[5]||m!==i[6]||g!==i[8]||y!==i[9]||_!==i[10]||v!==i[12]||b!==i[13]||T!==i[14])&&(u|=n.LOCAL_CHANGED),u}function h(t,e,i){var n,r=e[0],s=e[1],o=e[2],a=e[4],h=e[5],u=e[6],c=e[8],p=e[9],l=e[10],d=e[12],f=e[13],m=e[14],g=!1,y=i[0],_=i[1],v=i[2],b=i[3];return n=y*r+_*a+v*c+b*d,g=g?g:t[0]===n,t[0]=n,n=y*s+_*h+v*p+b*f,g=g?g:t[1]===n,t[1]=n,n=y*o+_*u+v*l+b*m,g=g?g:t[2]===n,t[2]=n,t[3]=0,y=i[4],_=i[5],v=i[6],b=i[7],n=y*r+_*a+v*c+b*d,g=g?g:t[4]===n,t[4]=n,n=y*s+_*h+v*p+b*f,g=g?g:t[5]===n,t[5]=n,n=y*o+_*u+v*l+b*m,g=g?g:t[6]===n,t[6]=n,t[7]=0,y=i[8],_=i[9],v=i[10],b=i[11],n=y*r+_*a+v*c+b*d,g=g?g:t[8]===n,t[8]=n,n=y*s+_*h+v*p+b*f,g=g?g:t[9]===n,t[9]=n,n=y*o+_*u+v*l+b*m,g=g?g:t[10]===n,t[10]=n,t[11]=0,y=i[12],_=i[13],v=i[14],b=i[15],n=y*r+_*a+v*c+b*d,g=g?g:t[12]===n,t[12]=n,n=y*s+_*h+v*p+b*f,g=g?g:t[13]===n,t[13]=n,n=y*o+_*u+v*l+b*m,g=g?g:t[14]===n,t[14]=n,t[15]=1,g}var u=[0,0,0,1],c=[1,1,1];n.IDENT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n.WORLD_CHANGED=1,n.LOCAL_CHANGED=2,n.prototype.reset=function(){this.parent=null,this.breakPoint=!1,this.calculatingWorldMatrix=!1},n.prototype.setParent=function(t){this.parent=t},n.prototype.getParent=function(){return this.parent},n.prototype.setBreakPoint=function(){this.breakPoint=!0,this.calculatingWorldMatrix=!0},n.prototype.setCalculateWorldMatrix=function(){this.calculatingWorldMatrix=!0},n.prototype.isBreakPoint=function(){return this.breakPoint},n.prototype.getLocalTransform=function(){return this.local},n.prototype.getWorldTransform=function(){if(!this.isBreakPoint()&&!this.calculatingWorldMatrix)throw new Error("This transform is not calculating world transforms");return this.global},n.prototype.calculate=function(t){return!this.parent||this.parent.isBreakPoint()?o(t,this):a(t,this)},n.prototype.getPosition=function(){return this.vectors.position},n.prototype.setPosition=function(t,e,i){this.vectors.positionChanged=s(this.vectors.position,t,e,i)},n.prototype.getRotation=function(){return this.vectors.rotation},n.prototype.setRotation=function(t,e,i,n){var r,o,a,h,u=this.vectors.rotation;if(null!=n)r=t,o=e,a=i,h=n,this._lastEulerVals[0]=null,this._lastEulerVals[1]=null,this._lastEulerVals[2]=null,this._lastEuler=!1;else{if(null==t||null==e||null==i)if(this._lastEuler)t=null==t?this._lastEulerVals[0]:t,e=null==e?this._lastEulerVals[1]:e,i=null==i?this._lastEulerVals[2]:i;else{var c=-2*(u[1]*u[2]-u[3]*u[0]);Math.abs(c)>.99999?(e=null==e?.5*Math.PI*c:e,t=null==t?Math.atan2(-u[0]*u[2]+u[3]*u[1],.5-u[1]*u[1]-u[2]*u[2]):t,i=null==i?0:i):(e=null==e?Math.asin(c):e,t=null==t?Math.atan2(u[0]*u[2]+u[3]*u[1],.5-u[0]*u[0]-u[1]*u[1]):t,i=null==i?Math.atan2(u[0]*u[1]+u[3]*u[2],.5-u[0]*u[0]-u[2]*u[2]):i)}var p=.5*t,l=.5*e,d=.5*i,f=Math.sin(p),m=Math.sin(l),g=Math.sin(d),y=Math.cos(p),_=Math.cos(l),v=Math.cos(d),b=m*g,T=_*g,w=m*v,E=_*v;r=f*E+y*b,o=y*w-f*T,a=y*T+f*w,h=y*E-f*b,this._lastEuler=!0,this._lastEulerVals[0]=t,this._lastEulerVals[1]=e,this._lastEulerVals[2]=i}this.vectors.rotationChanged=s(u,r,o,a,h)},n.prototype.getScale=function(){return this.vectors.scale},n.prototype.setScale=function(t,e,i){this.vectors.scaleChanged=s(this.vectors.scale,t,e,i)},n.prototype.getAlign=function(){return this.offsets.align},n.prototype.setAlign=function(t,e,i){this.offsets.alignChanged=s(this.offsets.align,t,e,null!=i?i-.5:i)},n.prototype.getMountPoint=function(){return this.offsets.mountPoint},n.prototype.setMountPoint=function(t,e,i){this.offsets.mountPointChanged=s(this.offsets.mountPoint,t,e,null!=i?i-.5:i)},n.prototype.getOrigin=function(){return this.offsets.origin},n.prototype.setOrigin=function(t,e,i){this.offsets.originChanged=s(this.offsets.origin,t,e,null!=i?i-.5:i)},n.prototype.calculateWorldMatrix=function(){for(var t=this.parent;t&&!t.isBreakPoint();)t=t.parent;if(t)return h(this.global,t.getWorldTransform(),this.local);for(var e=0;16>e;e++)this.global[e]=this.local[e];return!1},e.exports=n},{}],19:[function(t,e,i){"use strict";function n(){this.pathStore=new g}function r(t,e,i){var n=i.align[0],r=i.align[1],s=i.align[2];t.onAlignChange&&t.onAlignChange(n,r,s);for(var o=0,a=e.length;a>o;o++)e[o]&&e[o].onAlignChange&&e[o].onAlignChange(n,r,s);i.alignChanged=!1}function s(t,e,i){var n=i.mountPoint[0],r=i.mountPoint[1],s=i.mountPoint[2];t.onMountPointChange&&t.onMountPointChange(n,r,s);for(var o=0,a=e.length;a>o;o++)e[o]&&e[o].onMountPointChange&&e[o].onMountPointChange(n,r,s);i.mountPointChanged=!1}function o(t,e,i){var n=i.origin[0],r=i.origin[1],s=i.origin[2];t.onOriginChange&&t.onOriginChange(n,r,s);for(var o=0,a=e.length;a>o;o++)e[o]&&e[o].onOriginChange&&e[o].onOriginChange(n,r,s);i.originChanged=!1}function a(t,e,i){var n=i.position[0],r=i.position[1],s=i.position[2];t.onPositionChange&&t.onPositionChange(n,r,s);for(var o=0,a=e.length;a>o;o++)e[o]&&e[o].onPositionChange&&e[o].onPositionChange(n,r,s);i.positionChanged=!1}function h(t,e,i){var n=i.rotation[0],r=i.rotation[1],s=i.rotation[2],o=i.rotation[3];t.onRotationChange&&t.onRotationChange(n,r,s,o);for(var a=0,h=e.length;h>a;a++)e[a]&&e[a].onRotationChange&&e[a].onRotationChange(n,r,s,o);i.rotationChanged=!1}function u(t,e,i){var n=i.scale[0],r=i.scale[1],s=i.scale[2];t.onScaleChange&&t.onScaleChange(n,r,s);for(var o=0,a=e.length;a>o;o++)e[o]&&e[o].onScaleChange&&e[o].onScaleChange(n,r,s);i.scaleChanged=!1}function c(t,e,i){t.onTransformChange&&t.onTransformChange(i);for(var n=0,r=e.length;r>n;n++)e[n]&&e[n].onTransformChange&&e[n].onTransformChange(i)}function p(t,e,i){t.onLocalTransformChange&&t.onLocalTransformChange(i);for(var n=0,r=e.length;r>n;n++)e[n]&&e[n].onLocalTransformChange&&e[n].onLocalTransformChange(i)}function l(t,e,i){t.onWorldTransformChange&&t.onWorldTransformChange(i);for(var n=0,r=e.length;r>n;n++)e[n]&&e[n].onWorldTransformChange&&e[n].onWorldTransformChange(i)}var d=t("./Path"),f=t("./Transform"),m=t("./Dispatch"),g=t("./PathStore");n.prototype.registerTransformAtPath=function(t,e){if(!d.depth(t))return this.pathStore.insert(t,e?e:new f);var i=this.pathStore.get(d.parent(t));if(!i)throw new Error("No parent transform registered at expected path: "+d.parent(t));e&&e.setParent(i),this.pathStore.insert(t,e?e:new f(i))},n.prototype.deregisterTransformAtPath=function(t){this.pathStore.remove(t)},n.prototype.makeBreakPointAt=function(t){var e=this.pathStore.get(t);if(!e)throw new Error("No transform Registered at path: "+t);e.setBreakPoint()},n.prototype.makeCalculateWorldMatrixAt=function(t){var e=this.pathStore.get(t);if(!e)throw new Error("No transform Registered at path: "+t);e.setCalculateWorldMatrix()},n.prototype.get=function(t){return this.pathStore.get(t)},n.prototype.update=function(){for(var t,e,i,n,d,g,y=this.pathStore.getItems(),_=this.pathStore.getPaths(),v=0,b=y.length;b>v;v++)i=m.getNode(_[v]),i&&(g=i.getComponents(),t=y[v],n=t.vectors,d=t.offsets,d.alignChanged&&r(i,g,d),d.mountPointChanged&&s(i,g,d),d.originChanged&&o(i,g,d),n.positionChanged&&a(i,g,n),n.rotationChanged&&h(i,g,n),n.scaleChanged&&u(i,g,n),(e=t.calculate(i))&&(c(i,g,t),e&f.LOCAL_CHANGED&&p(i,g,t.getLocalTransform()),e&f.WORLD_CHANGED&&l(i,g,t.getWorldTransform())))},e.exports=new n},{"./Dispatch":9,"./Path":13,"./PathStore":14,"./Transform":18}],20:[function(t,e,i){"use strict";function n(t,e){if(!t)throw new Error("DOMElement must be instantiated on a node");if(this._changeQueue=[],this._requestingUpdate=!1,this._renderSized=!1,this._requestRenderSize=!1,this._UIEvents=t.getUIEvents().slice(0),this._classes=["famous-dom-element"],this._requestingEventListeners=[],this._styles={},this._attributes={},this._content="",this._tagName=e&&e.tagName?e.tagName:"div",this._renderSize=[0,0,0],this._node=t,t&&t.addComponent(this),this._callbacks=new r,this.setProperty("display",t.isShown()?"block":"none"),this.onOpacityChange(t.getOpacity()),e){var i,n;if(e.classes)for(i=0;i<e.classes.length;i++)this.addClass(e.classes[i]);if(e.attributes)for(n in e.attributes)this.setAttribute(n,e.attributes[n]);if(e.properties)for(n in e.properties)this.setProperty(n,e.properties[n]);e.id&&this.setId(e.id),e.content&&this.setContent(e.content),e.cutout===!1&&this.setCutoutState(e.cutout)}}var r=t("../utilities/CallbackStore"),s=t("../core/TransformSystem"),o=t("../core/Commands"),a=t("../core/Size");n.prototype.getValue=function(){return{classes:this._classes,styles:this._styles,attributes:this._attributes,content:this._content,id:this._attributes.id,tagName:this._tagName}},n.prototype.onUpdate=function(){var t=this._node,e=this._changeQueue,i=e.length;if(i&&t){for(t.sendDrawCommand(o.WITH),t.sendDrawCommand(t.getLocation());i--;)t.sendDrawCommand(e.shift());this._requestRenderSize&&(t.sendDrawCommand(o.DOM_RENDER_SIZE),t.sendDrawCommand(t.getLocation()),this._requestRenderSize=!1)}this._requestingUpdate=!1},n.prototype.onMount=function(t,e){this._node=t,this._id=e,this._UIEvents=t.getUIEvents().slice(0),s.makeBreakPointAt(t.getLocation()),this.onSizeModeChange.apply(this,t.getSizeMode()),this.draw(),this.setAttribute("data-fa-path",t.getLocation())},n.prototype.onDismount=function(){this.setProperty("display","none"),this.setAttribute("data-fa-path",""),this.setCutoutState(!1),this.onUpdate(),this._initialized=!1},n.prototype.onShow=function(){this.setProperty("display","block")},n.prototype.onHide=function(){this.setProperty("display","none")},n.prototype.setCutoutState=function(t){return this._initialized&&this._changeQueue.push(o.GL_CUTOUT_STATE,t),this._requestingUpdate||this._requestUpdate(),this},n.prototype.onTransformChange=function(t){this._changeQueue.push(o.CHANGE_TRANSFORM),t=t.getLocalTransform();for(var e=0,i=t.length;i>e;e++)this._changeQueue.push(t[e]);this._requestingUpdate||this._requestUpdate()},n.prototype.onSizeChange=function(t,e){var i=this._node.getSizeMode(),n=i[0]!==a.RENDER,r=i[1]!==a.RENDER;return this._initialized&&this._changeQueue.push(o.CHANGE_SIZE,n?t:n,r?e:r),this._requestingUpdate||this._requestUpdate(),this},n.prototype.onOpacityChange=function(t){return this.setProperty("opacity",t)},n.prototype.onAddUIEvent=function(t){return-1===this._UIEvents.indexOf(t)?(this._subscribe(t),this._UIEvents.push(t)):this._inDraw&&this._subscribe(t),this},n.prototype.onRemoveUIEvent=function(t){var e=this._UIEvents.indexOf(t);return-1!==e?(this._unsubscribe(t),this._UIEvents.splice(e,1)):this._inDraw&&this._unsubscribe(t),this},n.prototype._subscribe=function(t){this._initialized&&this._changeQueue.push(o.SUBSCRIBE,t),this._requestingUpdate||this._requestUpdate()},n.prototype.preventDefault=function(t){this._initialized&&this._changeQueue.push(o.PREVENT_DEFAULT,t),this._requestingUpdate||this._requestUpdate()},n.prototype.allowDefault=function(t){this._initialized&&this._changeQueue.push(o.ALLOW_DEFAULT,t),this._requestingUpdate||this._requestUpdate()},n.prototype._unsubscribe=function(t){this._initialized&&this._changeQueue.push(o.UNSUBSCRIBE,t),this._requestingUpdate||this._requestUpdate()},n.prototype.onSizeModeChange=function(t,e,i){(t===a.RENDER||e===a.RENDER||i===a.RENDER)&&(this._renderSized=!0,this._requestRenderSize=!0);var n=this._node.getSize();this.onSizeChange(n[0],n[1])},n.prototype.getRenderSize=function(){return this._renderSize},n.prototype._requestUpdate=function(){!this._requestingUpdate&&this._id&&(this._node.requestUpdate(this._id),this._requestingUpdate=!0)},n.prototype.init=function(){this._changeQueue.push(o.INIT_DOM,this._tagName),this._initialized=!0,this.onTransformChange(s.get(this._node.getLocation()));var t=this._node.getSize();this.onSizeChange(t[0],t[1]),this._requestingUpdate||this._requestUpdate()},n.prototype.setId=function(t){return this.setAttribute("id",t),this},n.prototype.addClass=function(t){return this._classes.indexOf(t)<0?(this._initialized&&this._changeQueue.push(o.ADD_CLASS,t),this._classes.push(t),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0),this):(this._inDraw&&(this._initialized&&this._changeQueue.push(o.ADD_CLASS,t),this._requestingUpdate||this._requestUpdate()),this)},n.prototype.removeClass=function(t){var e=this._classes.indexOf(t);return 0>e?this:(this._changeQueue.push(o.REMOVE_CLASS,t),this._classes.splice(e,1),this._requestingUpdate||this._requestUpdate(),this)},n.prototype.hasClass=function(t){return-1!==this._classes.indexOf(t)},n.prototype.setAttribute=function(t,e){return(this._attributes[t]!==e||this._inDraw)&&(this._attributes[t]=e,this._initialized&&this._changeQueue.push(o.CHANGE_ATTRIBUTE,t,e),this._requestUpdate||this._requestUpdate()),this},n.prototype.setProperty=function(t,e){return(this._styles[t]!==e||this._inDraw)&&(this._styles[t]=e,this._initialized&&this._changeQueue.push(o.CHANGE_PROPERTY,t,e),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0)),this},n.prototype.setContent=function(t){return(this._content!==t||this._inDraw)&&(this._content=t,this._initialized&&this._changeQueue.push(o.CHANGE_CONTENT,t),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0)),this},n.prototype.on=function(t,e){return this._callbacks.on(t,e)},n.prototype.onReceive=function(t,e){"resize"===t&&(this._renderSize[0]=e.val[0],this._renderSize[1]=e.val[1],this._requestingUpdate||this._requestUpdate()),this._callbacks.trigger(t,e)},n.prototype.draw=function(){var t,e,i;for(this._inDraw=!0,this.init(),e=0,i=this._classes.length;i>e;e++)this.addClass(this._classes[e]);this._content&&this.setContent(this._content);for(t in this._styles)null!=this._styles[t]&&this.setProperty(t,this._styles[t]);for(t in this._attributes)null!=this._attributes[t]&&this.setAttribute(t,this._attributes[t]);for(e=0,i=this._UIEvents.length;i>e;e++)this.onAddUIEvent(this._UIEvents[e]);this._inDraw=!1},e.exports=n},{"../core/Commands":8,"../core/Size":16,"../core/TransformSystem":19,"../utilities/CallbackStore":77}],21:[function(t,e,i){"use strict";function n(t,e,i){var n=this;t.classList.add("famous-dom-renderer"),p=p||h("transform"),this._compositor=i,this._target=null,this._parent=null,this._path=null,this._children=[],this._insertElCallbackStore=new u,this._removeElCallbackStore=new u,this._root=new s(t,e),this._boundTriggerEvent=function(t){return n._triggerEvent(t)},this._selector=e,this._elements={},this._elements[e]=this._root,this.perspectiveTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._VPtransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._lastEv=null}function r(t){for(var e=[],i=t.target;i!==document.body;)e.push(i),i=i.parentNode;return e}var s=t("./ElementCache"),o=t("./Math"),a=t("../core/Path"),h=t("../utilities/vendorPrefix"),u=t("../utilities/CallbackStore"),c=t("./events/EventMap"),p=null;n.prototype.subscribe=function(t){this._assertTargetLoaded(),this._listen(t),this._target.subscribe[t]=!0},n.prototype.preventDefault=function(t){this._assertTargetLoaded(),this._listen(t),this._target.preventDefault[t]=!0},n.prototype.allowDefault=function(t){this._assertTargetLoaded(),this._listen(t),this._target.preventDefault[t]=!1},n.prototype._listen=function(t){if(this._assertTargetLoaded(),!this._target.listeners[t]&&!this._root.listeners[t]){var e=c[t][1]?this._root:this._target;e.listeners[t]=this._boundTriggerEvent,e.element.addEventListener(t,this._boundTriggerEvent)}},n.prototype.unsubscribe=function(t){this._assertTargetLoaded(),this._target.subscribe[t]=!1},n.prototype._triggerEvent=function(t){if(this._lastEv!==t)for(var e=t.path?t.path:r(t),i=0;i<e.length;i++)if(e[i].dataset){var n=e[i].dataset.faPath;if(n&&(this._elements[n].preventDefault[t.type]&&t.preventDefault(),this._elements[n]&&this._elements[n].subscribe[t.type])){this._lastEv=t;var s=c[t.type][0];this._compositor.sendEvent(n,t.type,new s(t));break}}},n.prototype.getSizeOf=function(t){var e=this._elements[t];if(!e)return null;var i={val:e.size};return this._compositor.sendEvent(t,"resize",i),i},n.prototype.draw=function(t){t.perspectiveDirty&&(this.perspectiveDirty=!0,this.perspectiveTransform[0]=t.perspectiveTransform[0],this.perspectiveTransform[1]=t.perspectiveTransform[1],this.perspectiveTransform[2]=t.perspectiveTransform[2],this.perspectiveTransform[3]=t.perspectiveTransform[3],this.perspectiveTransform[4]=t.perspectiveTransform[4],this.perspectiveTransform[5]=t.perspectiveTransform[5],this.perspectiveTransform[6]=t.perspectiveTransform[6],this.perspectiveTransform[7]=t.perspectiveTransform[7],this.perspectiveTransform[8]=t.perspectiveTransform[8],
this.perspectiveTransform[9]=t.perspectiveTransform[9],this.perspectiveTransform[10]=t.perspectiveTransform[10],this.perspectiveTransform[11]=t.perspectiveTransform[11],this.perspectiveTransform[12]=t.perspectiveTransform[12],this.perspectiveTransform[13]=t.perspectiveTransform[13],this.perspectiveTransform[14]=t.perspectiveTransform[14],this.perspectiveTransform[15]=t.perspectiveTransform[15]),(t.viewDirty||t.perspectiveDirty)&&(o.multiply(this._VPtransform,this.perspectiveTransform,t.viewTransform),this._root.element.style[p]=this._stringifyMatrix(this._VPtransform))},n.prototype._assertPathLoaded=function(){if(!this._path)throw new Error("path not loaded")},n.prototype._assertParentLoaded=function(){if(!this._parent)throw new Error("parent not loaded")},n.prototype._assertChildrenLoaded=function(){if(!this._children)throw new Error("children not loaded")},n.prototype._assertTargetLoaded=function(){if(!this._target)throw new Error("No target loaded")},n.prototype.findParent=function(){this._assertPathLoaded();for(var t,e=this._path;!t&&e.length;)e=e.substring(0,e.lastIndexOf("/")),t=this._elements[e];return this._parent=t,t},n.prototype.findTarget=function(){return this._target=this._elements[this._path],this._target},n.prototype.loadPath=function(t){return this._path=t,this._target=this._elements[this._path],this._path},n.prototype.resolveChildren=function(t,e){for(var i,n,r=0,s=this._path;i=e.childNodes[r];)i.dataset?(n=i.dataset.faPath,n&&a.isDescendentOf(n,s)?t.appendChild(i):r++):r++},n.prototype.insertEl=function(t){if(this.findParent(),this._assertParentLoaded(),this._parent.void)throw new Error(this._parent.path+" is a void element. Void elements are not allowed to have children.");this._target||(this._target=new s(document.createElement(t),this._path));var e=this._target.element,i=this._parent.element;this.resolveChildren(e,i),i.appendChild(e),this._elements[this._path]=this._target,this._insertElCallbackStore.trigger(this._path,this._target)},n.prototype.setProperty=function(t,e){this._assertTargetLoaded(),this._target.element.style[t]=e},n.prototype.setSize=function(t,e){this._assertTargetLoaded(),this.setWidth(t),this.setHeight(e)},n.prototype.setWidth=function(t){this._assertTargetLoaded();var e=this._target.content;t===!1?(this._target.explicitWidth=!0,e&&(e.style.width=""),t=e?e.offsetWidth:0,this._target.element.style.width=t+"px"):(this._target.explicitWidth=!1,e&&(e.style.width=t+"px"),this._target.element.style.width=t+"px"),this._target.size[0]=t},n.prototype.setHeight=function(t){this._assertTargetLoaded();var e=this._target.content;t===!1?(this._target.explicitHeight=!0,e&&(e.style.height=""),t=e?e.offsetHeight:0,this._target.element.style.height=t+"px"):(this._target.explicitHeight=!1,e&&(e.style.height=t+"px"),this._target.element.style.height=t+"px"),this._target.size[1]=t},n.prototype.setAttribute=function(t,e){this._assertTargetLoaded(),this._target.element.setAttribute(t,e)},n.prototype.setContent=function(t){this._assertTargetLoaded(),this._target.formElement?this._target.element.value=t:(this._target.content||(this._target.content=document.createElement("div"),this._target.content.classList.add("famous-dom-element-content"),this._target.element.insertBefore(this._target.content,this._target.element.firstChild)),this._target.content.innerHTML=t),this.setSize(this._target.explicitWidth?!1:this._target.size[0],this._target.explicitHeight?!1:this._target.size[1])},n.prototype.setMatrix=function(t){this._assertTargetLoaded(),this._target.element.style[p]=this._stringifyMatrix(t)},n.prototype.addClass=function(t){this._assertTargetLoaded(),this._target.element.classList.add(t)},n.prototype.removeClass=function(t){this._assertTargetLoaded(),this._target.element.classList.remove(t)},n.prototype._stringifyMatrix=function(t){var e="matrix3d(";return e+=t[0]<1e-6&&t[0]>-1e-6?"0,":t[0]+",",e+=t[1]<1e-6&&t[1]>-1e-6?"0,":t[1]+",",e+=t[2]<1e-6&&t[2]>-1e-6?"0,":t[2]+",",e+=t[3]<1e-6&&t[3]>-1e-6?"0,":t[3]+",",e+=t[4]<1e-6&&t[4]>-1e-6?"0,":t[4]+",",e+=t[5]<1e-6&&t[5]>-1e-6?"0,":t[5]+",",e+=t[6]<1e-6&&t[6]>-1e-6?"0,":t[6]+",",e+=t[7]<1e-6&&t[7]>-1e-6?"0,":t[7]+",",e+=t[8]<1e-6&&t[8]>-1e-6?"0,":t[8]+",",e+=t[9]<1e-6&&t[9]>-1e-6?"0,":t[9]+",",e+=t[10]<1e-6&&t[10]>-1e-6?"0,":t[10]+",",e+=t[11]<1e-6&&t[11]>-1e-6?"0,":t[11]+",",e+=t[12]<1e-6&&t[12]>-1e-6?"0,":t[12]+",",e+=t[13]<1e-6&&t[13]>-1e-6?"0,":t[13]+",",e+=t[14]<1e-6&&t[14]>-1e-6?"0,":t[14]+",",e+=t[15]+")"},n.prototype.onInsertEl=function(t,e){return this._insertElCallbackStore.on(t,e),this},n.prototype.offInsertEl=function(t,e){return this._insertElCallbackStore.off(t,e),this},n.prototype.onRemoveEl=function(t,e){return this._removeElCallbackStore.on(t,e),this},n.prototype.offRemoveEl=function(t,e){return this._removeElCallbackStore.off(t,e),this},e.exports=n},{"../core/Path":13,"../utilities/CallbackStore":77,"../utilities/vendorPrefix":82,"./ElementCache":22,"./Math":23,"./events/EventMap":27}],22:[function(t,e,i){"use strict";function n(t,e){this.tagName=t.tagName.toLowerCase(),this.void=r[this.tagName];var i=t.constructor;this.formElement=i===HTMLInputElement||i===HTMLTextAreaElement||i===HTMLSelectElement,this.element=t,this.path=e,this.content=null,this.size=new Int16Array(3),this.explicitHeight=!1,this.explicitWidth=!1,this.postRenderSize=new Float32Array(2),this.listeners={},this.preventDefault={},this.subscribe={}}var r=t("./VoidElements");e.exports=n},{"./VoidElements":24}],23:[function(t,e,i){"use strict";function n(t,e){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],h=e[6],u=e[7],c=e[8],p=e[9],l=e[10],d=e[11],f=e[12],m=e[13],g=e[14],y=e[15],_=i*a-n*o,v=i*h-r*o,b=i*u-s*o,T=n*h-r*a,w=n*u-s*a,E=r*u-s*h,I=c*m-p*f,C=c*g-l*f,x=c*y-d*f,R=p*g-l*m,A=p*y-d*m,S=l*y-d*g,O=_*S-v*A+b*R+T*x-w*C+E*I;return O?(O=1/O,t[0]=(a*S-h*A+u*R)*O,t[1]=(r*A-n*S-s*R)*O,t[2]=(m*E-g*w+y*T)*O,t[3]=(l*w-p*E-d*T)*O,t[4]=(h*x-o*S-u*C)*O,t[5]=(i*S-r*x+s*C)*O,t[6]=(g*b-f*E-y*v)*O,t[7]=(c*E-l*b+d*v)*O,t[8]=(o*A-a*x+u*I)*O,t[9]=(n*x-i*A-s*I)*O,t[10]=(f*w-m*b+y*_)*O,t[11]=(p*b-c*w-d*_)*O,t[12]=(a*C-o*R-h*I)*O,t[13]=(i*R-n*C+r*I)*O,t[14]=(m*v-f*T-g*_)*O,t[15]=(c*T-p*v+l*_)*O,t):null}function r(t,e,i){var n,r,s,o,a=e[0],h=e[1],u=e[2],c=e[3],p=e[4],l=e[5],d=e[6],f=e[7],m=e[8],g=e[9],y=e[10],_=e[11],v=e[12],b=e[13],T=e[14],w=e[15],E=i[0],I=i[1],C=i[2],x=i[3],R=i[4],A=i[5],S=i[6],O=i[7],M=i[8],N=i[9],D=i[10],L=i[11],z=i[12],P=i[13],U=i[14],F=i[15],V=!1;return n=E*a+I*p+C*m+x*v,r=E*h+I*l+C*g+x*b,s=E*u+I*d+C*y+x*T,o=E*c+I*f+C*_+x*w,V=V?V:n===t[0]||r===t[1]||s===t[2]||o===t[3],t[0]=n,t[1]=r,t[2]=s,t[3]=o,E=R,I=A,C=S,x=O,n=E*a+I*p+C*m+x*v,r=E*h+I*l+C*g+x*b,s=E*u+I*d+C*y+x*T,o=E*c+I*f+C*_+x*w,V=V?V:n===t[4]||r===t[5]||s===t[6]||o===t[7],t[4]=n,t[5]=r,t[6]=s,t[7]=o,E=M,I=N,C=D,x=L,n=E*a+I*p+C*m+x*v,r=E*h+I*l+C*g+x*b,s=E*u+I*d+C*y+x*T,o=E*c+I*f+C*_+x*w,V=V?V:n===t[8]||r===t[9]||s===t[10]||o===t[11],t[8]=n,t[9]=r,t[10]=s,t[11]=o,E=z,I=P,C=U,x=F,n=E*a+I*p+C*m+x*v,r=E*h+I*l+C*g+x*b,s=E*u+I*d+C*y+x*T,o=E*c+I*f+C*_+x*w,V=V?V:n===t[12]||r===t[13]||s===t[14]||o===t[15],t[12]=n,t[13]=r,t[14]=s,t[15]=o,t}e.exports={multiply:r,invert:n}},{}],24:[function(t,e,i){"use strict";var n={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};e.exports=n},{}],25:[function(t,e,i){"use strict";function n(t){r.call(this,t),this.data=t.data}var r=t("./UIEvent");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"CompositionEvent"},e.exports=n},{"./UIEvent":33}],26:[function(t,e,i){"use strict";function n(t){this.type=t.type,this.defaultPrevented=t.defaultPrevented,this.timeStamp=t.timeStamp;var e=t.target.constructor;(e===HTMLInputElement||e===HTMLTextAreaElement||e===HTMLSelectElement)&&(this.value=t.target.value)}n.prototype.toString=function(){return"Event"},e.exports=n},{}],27:[function(t,e,i){"use strict";var n=t("./CompositionEvent"),r=t("./Event"),s=t("./FocusEvent"),o=t("./InputEvent"),a=t("./KeyboardEvent"),h=t("./MouseEvent"),u=t("./TouchEvent"),c=t("./UIEvent"),p=t("./WheelEvent"),l={change:[r,!0],submit:[r,!0],abort:[r,!1],beforeinput:[o,!0],blur:[s,!1],click:[h,!0],compositionend:[n,!0],compositionstart:[n,!0],compositionupdate:[n,!0],dblclick:[h,!0],focus:[s,!1],focusin:[s,!0],focusout:[s,!0],input:[o,!0],keydown:[a,!0],keyup:[a,!0],load:[r,!1],mousedown:[h,!0],mouseenter:[h,!1],mouseleave:[h,!1],mousemove:[h,!1],mouseout:[h,!0],mouseover:[h,!0],mouseup:[h,!0],contextMenu:[h,!0],resize:[c,!1],scroll:[c,!1],select:[r,!0],unload:[r,!1],wheel:[p,!0],touchcancel:[u,!0],touchend:[u,!0],touchmove:[u,!0],touchstart:[u,!0]};e.exports=l},{"./CompositionEvent":25,"./Event":26,"./FocusEvent":28,"./InputEvent":29,"./KeyboardEvent":30,"./MouseEvent":31,"./TouchEvent":32,"./UIEvent":33,"./WheelEvent":34}],28:[function(t,e,i){"use strict";function n(t){r.call(this,t)}var r=t("./UIEvent");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"FocusEvent"},e.exports=n},{"./UIEvent":33}],29:[function(t,e,i){"use strict";function n(t){r.call(this,t),this.inputType=t.inputType,this.data=t.data,this.isComposing=t.isComposing,this.targetRange=t.targetRange}var r=t("./UIEvent");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"InputEvent"},e.exports=n},{"./UIEvent":33}],30:[function(t,e,i){"use strict";function n(t){r.call(this,t),this.DOM_KEY_LOCATION_STANDARD=0,this.DOM_KEY_LOCATION_LEFT=1,this.DOM_KEY_LOCATION_RIGHT=2,this.DOM_KEY_LOCATION_NUMPAD=3,this.key=t.key,this.code=t.code,this.location=t.location,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.repeat=t.repeat,this.isComposing=t.isComposing,this.keyCode=t.keyCode}var r=t("./UIEvent");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"KeyboardEvent"},e.exports=n},{"./UIEvent":33}],31:[function(t,e,i){"use strict";function n(t){r.call(this,t),this.screenX=t.screenX,this.screenY=t.screenY,this.clientX=t.clientX,this.clientY=t.clientY,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.button=t.button,this.buttons=t.buttons,this.pageX=t.pageX,this.pageY=t.pageY,this.x=t.x,this.y=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY}var r=t("./UIEvent");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"MouseEvent"},e.exports=n},{"./UIEvent":33}],32:[function(t,e,i){"use strict";function n(t){this.identifier=t.identifier,this.screenX=t.screenX,this.screenY=t.screenY,this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY}function r(t){if(!t)return a;for(var e=[],i=0;i<t.length;i++)e[i]=new n(t[i]);return e}function s(t){o.call(this,t),this.touches=r(t.touches),this.targetTouches=r(t.targetTouches),this.changedTouches=r(t.changedTouches),this.altKey=t.altKey,this.metaKey=t.metaKey,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey}var o=t("./UIEvent"),a=[];s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.toString=function(){return"TouchEvent"},e.exports=s},{"./UIEvent":33}],33:[function(t,e,i){"use strict";function n(t){r.call(this,t),this.detail=t.detail}var r=t("./Event");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"UIEvent"},e.exports=n},{"./Event":26}],34:[function(t,e,i){"use strict";function n(t){r.call(this,t),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2,this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.deltaZ=t.deltaZ,this.deltaMode=t.deltaMode}var r=t("./MouseEvent");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"WheelEvent"},e.exports=n},{"./MouseEvent":31}],35:[function(t,e,i){"use strict";function n(t){this.values=t||[1,0,0,0,1,0,0,0,1]}n.prototype.get=function(){return this.values},n.prototype.set=function(t){return this.values=t,this},n.prototype.copy=function(t){var e=this.values,i=t.values;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},n.prototype.vectorMultiply=function(t,e){var i=this.values,n=t.x,r=t.y,s=t.z;return e.x=i[0]*n+i[1]*r+i[2]*s,e.y=i[3]*n+i[4]*r+i[5]*s,e.z=i[6]*n+i[7]*r+i[8]*s,e},n.prototype.multiply=function(t){var e=this.values,i=t.values,n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],h=e[5],u=e[6],c=e[7],p=e[8],l=i[0],d=i[1],f=i[2],m=i[3],g=i[4],y=i[5],_=i[6],v=i[7],b=i[8];return e[0]=n*l+r*m+s*_,e[1]=n*d+r*g+s*v,e[2]=n*f+r*y+s*b,e[3]=o*l+a*m+h*_,e[4]=o*d+a*g+h*v,e[5]=o*f+a*y+h*b,e[6]=u*l+c*m+p*_,e[7]=u*d+c*g+p*v,e[8]=u*f+c*y+p*b,this},n.prototype.transpose=function(){var t=this.values,e=t[1],i=t[2],n=t[3],r=t[5],s=t[6],o=t[7];return t[1]=n,t[2]=s,t[3]=e,t[5]=o,t[6]=i,t[7]=r,this},n.prototype.getDeterminant=function(){var t=this.values,e=t[3],i=t[4],n=t[5],r=t[6],s=t[7],o=t[8],a=t[0]*(i*o-n*s)-t[1]*(e*o-n*r)+t[2]*(e*s-i*r);return a},n.prototype.inverse=function(){var t=this.values,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],h=t[7],u=t[8],c=e*(s*u-o*h)-i*(r*u-o*a)+n*(r*h-s*a);return Math.abs(c)<1e-40?null:(c=1/c,t[0]=(s*u-o*h)*c,t[3]=(-r*u+o*a)*c,t[6]=(r*h-s*a)*c,t[1]=(-i*u+n*h)*c,t[4]=(e*u-n*a)*c,t[7]=(-e*h+i*a)*c,t[2]=(i*o-n*s)*c,t[5]=(-e*o+n*r)*c,t[8]=(e*s-i*r)*c,this)},n.clone=function(t){return new n(t.values.slice())},n.inverse=function(t,e){var i=t.values,n=e.values,r=i[0],s=i[1],o=i[2],a=i[3],h=i[4],u=i[5],c=i[6],p=i[7],l=i[8],d=r*(h*l-u*p)-s*(a*l-u*c)+o*(a*p-h*c);return Math.abs(d)<1e-40?null:(d=1/d,n[0]=(h*l-u*p)*d,n[3]=(-a*l+u*c)*d,n[6]=(a*p-h*c)*d,n[1]=(-s*l+o*p)*d,n[4]=(r*l-o*c)*d,n[7]=(-r*p+s*c)*d,n[2]=(s*u-o*h)*d,n[5]=(-r*u+o*a)*d,n[8]=(r*h-s*a)*d,e)},n.transpose=function(t,e){var i=t.values,n=e.values,r=i[0],s=i[1],o=i[2],a=i[3],h=i[4],u=i[5],c=i[6],p=i[7],l=i[8];return n[0]=r,n[1]=a,n[2]=c,n[3]=s,n[4]=h,n[5]=p,n[6]=o,n[7]=u,n[8]=l,e},n.add=function(t,e,i){var n=t.values,r=e.values,s=i.values,o=n[0],a=n[1],h=n[2],u=n[3],c=n[4],p=n[5],l=n[6],d=n[7],f=n[8],m=r[0],g=r[1],y=r[2],_=r[3],v=r[4],b=r[5],T=r[6],w=r[7],E=r[8];return s[0]=o+m,s[1]=a+g,s[2]=h+y,s[3]=u+_,s[4]=c+v,s[5]=p+b,s[6]=l+T,s[7]=d+w,s[8]=f+E,i},n.subtract=function(t,e,i){var n=t.values,r=e.values,s=i.values,o=n[0],a=n[1],h=n[2],u=n[3],c=n[4],p=n[5],l=n[6],d=n[7],f=n[8],m=r[0],g=r[1],y=r[2],_=r[3],v=r[4],b=r[5],T=r[6],w=r[7],E=r[8];return s[0]=o-m,s[1]=a-g,s[2]=h-y,s[3]=u-_,s[4]=c-v,s[5]=p-b,s[6]=l-T,s[7]=d-w,s[8]=f-E,i},n.multiply=function(t,e,i){var n=t.values,r=e.values,s=i.values,o=n[0],a=n[1],h=n[2],u=n[3],c=n[4],p=n[5],l=n[6],d=n[7],f=n[8],m=r[0],g=r[1],y=r[2],_=r[3],v=r[4],b=r[5],T=r[6],w=r[7],E=r[8];return s[0]=o*m+a*_+h*T,s[1]=o*g+a*v+h*w,s[2]=o*y+a*b+h*E,s[3]=u*m+c*_+p*T,s[4]=u*g+c*v+p*w,s[5]=u*y+c*b+p*E,s[6]=l*m+d*_+f*T,s[7]=l*g+d*v+f*w,s[8]=l*y+d*b+f*E,i},e.exports=n},{}],36:[function(t,e,i){"use strict";function n(t,e,i,n){this.w=t||1,this.x=e||0,this.y=i||0,this.z=n||0}var r=Math.sin,s=Math.cos,o=Math.asin,a=Math.acos,h=Math.atan2,u=Math.sqrt;n.prototype.multiply=function(t){var e=this.x,i=this.y,n=this.z,r=this.w,s=t.x,o=t.y,a=t.z,h=t.w||0;return this.w=r*h-e*s-i*o-n*a,this.x=e*h+s*r+o*n-i*a,this.y=i*h+o*r+e*a-s*n,this.z=n*h+a*r+s*i-e*o,this},n.prototype.leftMultiply=function(t){var e=t.x,i=t.y,n=t.z,r=t.w||0,s=this.x,o=this.y,a=this.z,h=this.w;return this.w=r*h-e*s-i*o-n*a,this.x=e*h+s*r+o*n-i*a,this.y=i*h+o*r+e*a-s*n,this.z=n*h+a*r+s*i-e*o,this},n.prototype.rotateVector=function(t,e){var i=this.w,n=-this.x,r=-this.y,s=-this.z,o=t.x,a=t.y,h=t.z,u=-n*o-r*a-s*h,c=o*i+a*s-r*h,p=a*i+n*h-o*s,l=h*i+o*r-n*a,d=i,f=-n,m=-r,g=-s;return e.x=c*d+f*u+m*l-p*g,e.y=p*d+m*u+c*g-f*l,e.z=l*d+g*u+f*p-c*m,e},n.prototype.invert=function(){return this.w=-this.w,this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.prototype.conjugate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.prototype.length=function(){var t=this.w,e=this.x,i=this.y,n=this.z;return u(t*t+e*e+i*i+n*n)},n.prototype.normalize=function(){var t=this.w,e=this.x,i=this.y,n=this.z,r=u(t*t+e*e+i*i+n*n);return 0===r?this:(r=1/r,this.w*=r,this.x*=r,this.y*=r,this.z*=r,this)},n.prototype.set=function(t,e,i,n){return null!=t&&(this.w=t),null!=e&&(this.x=e),null!=i&&(this.y=i),null!=n&&(this.z=n),this},n.prototype.copy=function(t){return this.w=t.w,this.x=t.x,this.y=t.y,this.z=t.z,this},n.prototype.clear=function(){return this.w=1,this.x=0,this.y=0,this.z=0,this},n.prototype.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},n.prototype.slerp=function(t,e,i){var n,s,o,h,u,c=this.w,p=this.x,l=this.y,d=this.z,f=t.w,m=t.x,g=t.y,y=t.z;return s=c*f+p*m+l*g+d*y,1-s>1e-5?(n=a(s),o=r(n),h=r((1-e)*n)/o,u=r(e*n)/o):(h=1-e,u=e),i.w=c*h+f*u,i.x=p*h+m*u,i.y=l*h+g*u,i.z=d*h+y*u,i},n.prototype.toMatrix=function(t){var e=this.w,i=this.x,n=this.y,r=this.z,s=i*i,o=n*n,a=r*r,h=i*n,u=i*r,c=n*r;return t.set([1-2*(o+a),2*(h-e*r),2*(u+e*n),2*(h+e*r),1-2*(s+a),2*(c-e*i),2*(u-e*n),2*(c+e*i),1-2*(s+o)])},n.prototype.toEuler=function(t){var e=this.w,i=this.x,n=this.y,r=this.z,s=i*i,a=n*n,u=r*r,c=2*(i*r+n*e);return c=-1>c?-1:c>1?1:c,t.x=h(2*(i*e-n*r),1-2*(s+a)),t.y=o(c),t.z=h(2*(r*e-i*n),1-2*(a+u)),t},n.prototype.fromEuler=function(t,e,i){var n=.5*t,o=.5*e,a=.5*i,h=r(n),u=r(o),c=r(a),p=s(n),l=s(o),d=s(a);return this.w=p*l*d-h*u*c,this.x=h*l*d+p*u*c,this.y=p*u*d-h*l*c,this.z=p*l*c+h*u*d,this},n.prototype.fromAngleAxis=function(t,e,i,n){var o=u(e*e+i*i+n*n);if(0===o)this.w=1,this.x=this.y=this.z=0;else{o=1/o;var a=.5*t,h=r(a);this.w=s(a),this.x=h*e*o,this.y=h*i*o,this.z=h*n*o}return this},n.multiply=function(t,e,i){var n=t.w||0,r=t.x,s=t.y,o=t.z,a=e.w||0,h=e.x,u=e.y,c=e.z;return i.w=n*a-r*h-s*u-o*c,i.x=r*a+h*n+u*o-s*c,i.y=s*a+u*n+r*c-h*o,i.z=o*a+c*n+h*s-r*u,i},n.normalize=function(t,e){var i=t.w,n=t.x,r=t.y,s=t.z,o=u(i*i+n*n+r*r+s*s);return 0===o?this:(o=1/o,e.w*=o,e.x*=o,e.y*=o,e.z*=o,e)},n.conjugate=function(t,e){return e.w=t.w,e.x=-t.x,e.y=-t.y,e.z=-t.z,e},n.clone=function(t){return new n(t.w,t.x,t.y,t.z)},n.dot=function(t,e){return t.w*e.w+t.x*e.x+t.y*e.y+t.z*e.z},e.exports=n},{}],37:[function(t,e,i){"use strict";var n=function(t,e){t instanceof Array||t instanceof Float32Array?(this.x=t[0]||0,this.y=t[1]||0):(this.x=t||0,this.y=e||0)};n.prototype.set=function(t,e){return null!=t&&(this.x=t),null!=e&&(this.y=e),this},n.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.prototype.scale=function(t){return t instanceof n?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t),this},n.prototype.rotate=function(t){var e=this.x,i=this.y,n=Math.cos(t),r=Math.sin(t);return this.x=e*n-i*r,this.y=e*r+i*n,this},n.prototype.dot=function(t){return this.x*t.x+this.y*t.y},n.prototype.cross=function(t){return this.x*t.y-this.y*t.x},n.prototype.invert=function(){return this.x*=-1,this.y*=-1,this},n.prototype.map=function(t){return this.x=t(this.x),this.y=t(this.y),this},n.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},n.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},n.prototype.clear=function(){return this.x=0,this.y=0,this},n.prototype.isZero=function(){return 0!==this.x||0!==this.y?!1:!0},n.prototype.toArray=function(){return[this.x,this.y]},n.normalize=function(t,e){var i=t.x,n=t.y,r=Math.sqrt(i*i+n*n)||1;return r=1/r,e.x=t.x*r,e.y=t.y*r,e},n.clone=function(t){return new n(t.x,t.y)},n.add=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i},n.subtract=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i},n.scale=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i},n.dot=function(t,e){return t.x*e.x+t.y*e.y},n.cross=function(t,e){return t.x*e.y-t.y*e.x},e.exports=n},{}],38:[function(t,e,i){"use strict";var n=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};n.prototype.set=function(t,e,i){return null!=t&&(this.x=t),null!=e&&(this.y=e),null!=i&&(this.z=i),this},n.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.prototype.rotateX=function(t){var e=this.y,i=this.z,n=Math.cos(t),r=Math.sin(t);return this.y=e*n-i*r,this.z=e*r+i*n,this},n.prototype.rotateY=function(t){var e=this.x,i=this.z,n=Math.cos(t),r=Math.sin(t);return this.x=i*r+e*n,this.z=i*n-e*r,this},n.prototype.rotateZ=function(t){var e=this.x,i=this.y,n=Math.cos(t),r=Math.sin(t);return this.x=e*n-i*r,this.y=e*r+i*n,this},n.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},n.prototype.cross=function(t){var e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,o=t.z;return this.x=i*o-n*s,this.y=n*r-e*o,this.z=e*s-i*r,this},n.prototype.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},n.prototype.invert=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.prototype.map=function(t){return this.x=t(this.x),this.y=t(this.y),this.z=t(this.z),this},n.prototype.length=function(){var t=this.x,e=this.y,i=this.z;return Math.sqrt(t*t+e*e+i*i)},n.prototype.lengthSq=function(){var t=this.x,e=this.y,i=this.z;return t*t+e*e+i*i},n.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},n.prototype.clear=function(){return this.x=0,this.y=0,this.z=0,this},n.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},n.prototype.toArray=function(){return[this.x,this.y,this.z]},n.prototype.normalize=function(){var t=this.x,e=this.y,i=this.z,n=Math.sqrt(t*t+e*e+i*i)||1;return n=1/n,this.x*=n,this.y*=n,this.z*=n,this},n.prototype.applyRotation=function(t){var e=t.w,i=-t.x,n=-t.y,r=-t.z,s=this.x,o=this.y,a=this.z,h=-i*s-n*o-r*a,u=s*e+o*r-n*a,c=o*e+i*a-s*r,p=a*e+s*n-i*o,l=e,d=-i,f=-n,m=-r;return this.x=u*l+d*h+f*p-c*m,this.y=c*l+f*h+u*m-d*p,this.z=p*l+m*h+d*c-u*f,this},n.prototype.applyMatrix=function(t){var e=t.get(),i=this.x,n=this.y,r=this.z;return this.x=e[0]*i+e[1]*n+e[2]*r,this.y=e[3]*i+e[4]*n+e[5]*r,this.z=e[6]*i+e[7]*n+e[8]*r,this},n.normalize=function(t,e){var i=t.x,n=t.y,r=t.z,s=Math.sqrt(i*i+n*n+r*r)||1;return s=1/s,e.x=i*s,e.y=n*s,e.z=r*s,e},n.applyRotation=function(t,e,i){var n=e.w,r=-e.x,s=-e.y,o=-e.z,a=t.x,h=t.y,u=t.z,c=-r*a-s*h-o*u,p=a*n+h*o-s*u,l=h*n+r*u-a*o,d=u*n+a*s-r*h,f=n,m=-r,g=-s,y=-o;return i.x=p*f+m*c+g*d-l*y,i.y=l*f+g*c+p*y-m*d,i.z=d*f+y*c+m*l-p*g,i},n.clone=function(t){return new n(t.x,t.y,t.z)},n.add=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i},n.subtract=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z,i},n.scale=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i.z=t.z*e,i},n.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},n.cross=function(t,e,i){var n=t.x,r=t.y,s=t.z,o=e.x,a=e.y,h=e.z;return i.x=r*h-s*a,i.y=s*o-n*h,i.z=n*a-r*o,i},n.project=function(t,e,i){var n=t.x,r=t.y,s=t.z,o=e.x,a=e.y,h=e.z,u=n*o+r*a+s*h;return u/=o*o+a*a+h*h,i.x=o*u,i.y=a*u,i.z=h*u,i},e.exports=n},{}],39:[function(t,e,i){e.exports={Mat33:t("./Mat33"),Quaternion:t("./Quaternion"),Vec2:t("./Vec2"),Vec3:t("./Vec3")}},{"./Mat33":35,"./Quaternion":36,"./Vec2":37,"./Vec3":38}],40:[function(t,e,i){"use strict";function n(t,e,i){var n=y;return l.cross(t,e,n),l.cross(n,i,n),n}function r(t,e){for(var i,n,r,s,o=-(1/0),a=0;a<t.length;a++)r=t[a],n=l.dot(r,e),n>o&&(i=r,o=n,s=a);return{vertex:i,index:s}}function s(t,e,i){this.distance=t,this.normal=e,this.vertexIndices=i}function o(){this.vertices=[],this.numVertices=0,this.features=[],this.numFeatures=0,this.lastVertexIndex=0,this._IDPool={vertices:[],features:[]}}function a(t,e,i,n){for(var r=t[i].vertex,s=t[n].vertex,o=0,a=e.length;a>o;o++){var h=e[o];if(h){var u=t[h[0]].vertex,c=t[h[1]].vertex;if(r===u&&s===c||r===c&&s===u)return void(e[o]=null)}}e.push([i,n])}function h(t,e){e=e||1e3;var i,n,r=u(t,e),s=[];for(i=0,n=r.features.length;n>i;i++){var o=r.features[i];o&&s.push(o.vertexIndices)}var a=p(r.vertices,s),h=a.centroid,c=[];for(i=0,n=r.vertices.length;n>i;i++)c.push(l.subtract(r.vertices[i].vertex,h,new l));var d=[];for(i=0,n=c.length;n>i;i++)d.push(l.normalize(c[i],new l));var f={},m={};for(i=0;i<s.length;i++){var g=s[i][0],y=s[i][1],_=s[i][2];m[g]=m[g]||{},m[y]=m[y]||{},m[_]=m[_]||{},f[g]=f[g]||[],f[y]=f[y]||[],f[_]=f[_]||[],m[g][y]||(m[g][y]=1,f[g].push(y)),m[g][_]||(m[g][_]=1,f[g].push(_)),m[y][g]||(m[y][g]=1,f[y].push(g)),m[y][_]||(m[y][_]=1,f[y].push(_)),m[_][g]||(m[_][g]=1,f[_].push(g)),m[_][y]||(m[_][y]=1,f[_].push(y))}this.indices=s,this.vertices=c,this.normals=d,this.polyhedralProperties=a,this.graph=f}function u(t,e){var i=new o;i.addVertex(r(t,new l(1,0,0))),i.addVertex(r(t,new l(-1,0,0)));var s,a,h,u,c,p,d=i.vertices[0].vertex,f=i.vertices[1].vertex,m=l.subtract(f,d,T),g=-(1/0);for(c=0;c<t.length;c++)if(a=t[c],a!==d&&a!==f){var y=l.subtract(a,d,_);s=l.dot(y,n(m,y,m)),s=0>s?-1*s:s,s>g&&(g=s,h=a,u=c)}i.addVertex({vertex:h,index:u});var v=h,b=l.subtract(v,d,w),x=l.cross(m,b,new l);for(x.normalize(),g=-(1/0),c=0;c<t.length;c++)a=t[c],a!==d&&a!==f&&a!==v&&(s=l.dot(l.subtract(a,d,_),x),s=0>s?-1*s:s,s>g&&(g=s,h=a,u=c));i.addVertex({vertex:h,index:u});var R=h,A=l.subtract(R,d,E),S=l.subtract(v,f,I),O=l.subtract(R,f,C),M=l.cross(b,A,new l),N=l.cross(m,A,new l),D=l.cross(S,O,new l);M.normalize(),N.normalize(),D.normalize(),l.dot(x,A)>0&&x.invert(),l.dot(M,m)>0&&M.invert(),l.dot(N,b)>0&&N.invert(),l.dot(D,m)<0&&D.invert();var L=0,z=1,P=2,U=3;i.addFeature(null,x,[L,z,P]),i.addFeature(null,M,[L,P,U]),i.addFeature(null,N,[L,z,U]),i.addFeature(null,D,[z,P,U]);var F={};for(c=0,p=i.vertices.length;p>c;c++)F[i.vertices[c].index]=!0;var V=d.x+f.x+v.x+R.x,G=d.y+f.y+v.y+R.y,k=d.z+f.z+v.z+R.z,B=new l(V,G,k);B.scale(.25);for(var H=i.features,q=0;q++<e;){var W=null;for(c=0,p=H.length;p>c;c++)if(H[c]&&!H[c].done){W=H[c],h=null,u=null,d=i.vertices[W.vertexIndices[0]].vertex;var j=r(t,W.normal);h=j.vertex,u=j.index;var Y=l.dot(l.subtract(h,d,_),W.normal);.001>Y||F[u]?W.done=!0:(F[u]=!0,i.addVertex(j),i.reshape(B))}if(null===W)break}return i}function c(t,e,i,n,r){var s=t+e;n[0]=s+i;var o=t*t,a=o+e*s;n[1]=a+i*n[0],n[2]=t*o+e*a+i*n[1],r[0]=n[1]+t*(n[0]+t),r[1]=n[1]+e*(n[0]+e),r[2]=n[1]+i*(n[0]+i)}function p(t,e){var i,n,r=[0,0,0,0,0,0,0,0,0,0],s=[],o=[],a=[],h=[],u=[],p=[];for(i=0,n=e.length;n>i;i++){var f=t[e[i][0]].vertex,m=t[e[i][1]].vertex,g=t[e[i][2]].vertex,y=l.subtract(m,f,T),_=l.subtract(g,f,w),v=y.cross(_);l.dot(f,v)<0&&v.invert();var b=v.x,E=v.y,I=v.z,C=f.x,x=f.y,R=f.z,A=m.x,S=m.y,O=m.z,M=g.x,N=g.y,D=g.z;c(C,A,M,s,h),c(x,S,N,o,u),c(R,O,D,a,p),r[0]+=b*s[0],r[1]+=b*s[1],r[2]+=E*o[1],r[3]+=I*a[1],r[4]+=b*s[2],r[5]+=E*o[2],r[6]+=I*a[2],r[7]+=b*(x*h[0]+S*h[1]+N*h[2]),r[8]+=E*(R*u[0]+O*u[1]+D*u[2]),r[9]+=I*(C*p[0]+A*p[1]+M*p[2])}r[0]/=6,r[1]/=24,r[2]/=24,r[3]/=24,r[4]/=60,r[5]/=60,r[6]/=60,r[7]/=120,r[8]/=120,r[9]/=120;var L=1/0,z=-(1/0),P=1/0,U=-(1/0),F=1/0,V=-(1/0);for(i=0,n=t.length;n>i;i++){var G=t[i].vertex;G.x<L&&(L=G.x),G.x>z&&(z=G.x),G.y<P&&(P=G.y),G.y>U&&(U=G.y),G.z<F&&(F=G.z),G.z>V&&(V=G.z)}var k=[z-L,U-P,V-F],B=r[0],H=new l(r[1],r[2],r[3]);H.scale(1/B);var q=new d([r[4],r[7],r[9],r[7],r[5],r[8],r[9],r[8],r[6]]);return{size:k,volume:B,centroid:H,eulerTensor:q}}var l=t("../math/Vec3"),d=t("../math/Mat33"),f=t("../utilities/ObjectManager");f.register("DynamicGeometry",o),f.register("DynamicGeometryFeature",s);var m=f.requestDynamicGeometryFeature,g=f.freeDynamicGeometryFeature,y=new l,_=new l,v=new l,b=new l,T=new l,w=new l,E=new l,I=new l,C=new l;s.prototype.reset=function(t,e,i){return this.distance=t,this.normal=e,this.vertexIndices=i,this},o.prototype.reset=function(){return this.vertices=[],this.numVertices=0,this.features=[],this.numFeatures=0,this.lastVertexIndex=0,this._IDPool={vertices:[],features:[]},this},o.prototype.addVertex=function(t){var e=this._IDPool.vertices.length?this._IDPool.vertices.pop():this.vertices.length;this.vertices[e]=t,this.lastVertexIndex=e,this.numVertices++},o.prototype.removeVertex=function(t){var e=this.vertices[t];return this.vertices[t]=null,this._IDPool.vertices.push(t),this.numVertices--,e},o.prototype.addFeature=function(t,e,i){var n=this._IDPool.features.length?this._IDPool.features.pop():this.features.length;this.features[n]=m().reset(t,e,i),this.numFeatures++},o.prototype.removeFeature=function(t){var e=this.features[t];this.features[t]=null,this._IDPool.features.push(t),this.numFeatures--,g(e)},o.prototype.getLastVertex=function(){return this.vertices[this.lastVertexIndex]},o.prototype.getFeatureClosestToOrigin=function(){for(var t=1/0,e=null,i=this.features,n=0,r=i.length;r>n;n++){var s=i[n];s&&s.distance<t&&(t=s.distance,e=s)}return e},o.prototype.reshape=function(t){var e,i,n,r,s,o=this.vertices,h=this.getLastVertex().vertex,u=this.features,c=[];for(n=0,s=u.length;s>n;n++)u[n]&&(i=u[n].vertexIndices,e=o[i[0]].vertex,l.dot(u[n].normal,l.subtract(h,e,v))>-.001&&(a(o,c,i[0],i[1]),a(o,c,i[1],i[2]),a(o,c,i[2],i[0]),this.removeFeature(n)));var p=h,d=this.lastVertexIndex;for(r=0,s=c.length;s>r;r++)if(c[r]){var f=c[r][0],m=c[r][1],g=o[f].vertex,y=o[m].vertex,b=l.subtract(g,p,T),E=l.subtract(y,p,w),I=l.cross(b,E,new l);if(I.normalize(),t){var C=l.subtract(t,p,_);l.dot(I,C)>-.001&&I.invert(),this.addFeature(null,I,[d,f,m])}else{var x=l.dot(I,p);0>x&&(I.invert(),x*=-1),this.addFeature(x,I,[d,f,m])}}},o.prototype.simplexContainsOrigin=function(t,e){var i=this.vertices.length,r=this.lastVertexIndex,s=r-1,o=r-2,a=r-3;s=0>s?s+i:s,o=0>o?o+i:o,a=0>a?a+i:a;var h,u,c,p,d,f,m,g,y,_,v,x,R,A=this.vertices[r].vertex,S=this.vertices[s].vertex,O=this.vertices[o].vertex,M=this.vertices[a].vertex,N=l.scale(A,-1,b),D=l.subtract(S,A,T);if(4===i){if(h=l.subtract(O,A,w),u=l.subtract(M,A,E),d=l.cross(D,h,new l),f=l.cross(h,u,new l),m=l.cross(D,u,new l),d.normalize(),f.normalize(),m.normalize(),l.dot(d,u)>0&&d.invert(),l.dot(f,D)>0&&f.invert(),l.dot(m,h)>0&&m.invert(),y=l.dot(d,N),_=l.dot(f,N),v=l.dot(m,N),.001>y&&.001>v&&.001>_)return c=l.subtract(O,S,I),p=l.subtract(M,S,C),g=l.cross(c,p,new l),g.normalize(),l.dot(g,D)<=0&&g.invert(),x=-1*l.dot(g,S),this.addFeature(-y,d,[r,s,o]),this.addFeature(-_,f,[r,o,a]),this.addFeature(-v,m,[r,a,s]),this.addFeature(-x,g,[s,o,a]),!0;y>=.001?(R=this.removeVertex(a),t.copy(d)):_>=.001?(R=this.removeVertex(s),t.copy(f)):(R=this.removeVertex(o),t.copy(m))}else 3===i?(h=l.subtract(O,A,w),l.cross(D,h,t),l.dot(t,N)<=0&&t.invert()):t.copy(n(D,N,D));return R&&e&&e(R),!1},e.exports={DynamicGeometry:o,ConvexHull:h}},{"../math/Mat33":35,"../math/Vec3":38,"../utilities/ObjectManager":78}],41:[function(t,e,i){"use strict";function n(t){this.events=new p,t=t||{},this.bodies=[],this.forces=[],this.constraints=[],this.step=t.step||1e3/60,this.iterations=t.iterations||10,this._indexPools={bodies:[],forces:[],constraints:[]},this._entityMaps={bodies:{},forces:{},constraints:{}},this.speed=t.speed||1,this.time=0,this.delta=0,this.origin=t.origin||new l,this.orientation=t.orientation?t.orientation.normalize():new d,this.frameDependent=t.frameDependent||!1,this.transformBuffers={position:[0,0,0],rotation:[0,0,0,1]}}function r(t,e,i){var n=t._entityMaps[i];if(null==n[e._ID]){var r=t[i],s=t._indexPools[i];s.length?n[e._ID]=s.pop():n[e._ID]=r.length,r[n[e._ID]]=e}}function s(t,e,i){var n=t._entityMaps[i],r=n[e._ID];null!=r&&(t._indexPools[i].push(r),t[i][r]=null,n[e._ID]=null)}function o(t,e){t.momentum.add(l.scale(t.force,e,g)),t.angularMomentum.add(l.scale(t.torque,e,g)),l.scale(t.momentum,t.inverseMass,t.velocity),t.inverseInertia.vectorMultiply(t.angularMomentum,t.angularVelocity),t.force.clear(),t.torque.clear()}function a(t,e){if(0!==t.restrictions){var i=t.restrictions,n=null,r=null,s=null,o=null,a=null,h=null;32&i&&(n=0),16&i&&(r=0),8&i&&(s=0),4&i&&(o=0),2&i&&(a=0),1&i&&(h=0),(null!==n||null!==r||null!==s)&&t.setVelocity(n,r,s),(null!==o||null!==a||null!==h)&&t.setAngularVelocity(o,a,h)}t.position.add(l.scale(t.velocity,e,g));var u=t.angularVelocity,c=t.orientation,p=u.x,d=u.y,f=u.z,m=c.w,y=c.x,_=c.y,v=c.z,b=.5*e;c.w+=(-p*y-d*_-f*v)*b,c.x+=(p*m+d*v-f*_)*b,c.y+=(d*m+f*y-p*v)*b,c.z+=(f*m+p*_-d*y)*b,c.normalize(),t.updateInertia()}var h=t("./bodies/Particle"),u=t("./constraints/Constraint"),c=t("./forces/Force"),p=t("../utilities/CallbackStore"),l=t("../math/Vec3"),d=t("../math/Quaternion"),f=new l,m=new d,g=new l;
n.prototype.on=function(t,e){return this.events.on(t,e),this},n.prototype.off=function(t,e){return this.events.off(t,e),this},n.prototype.trigger=function(t,e){return this.events.trigger(t,e),this},n.prototype.setOrigin=function(t,e,i){return this.origin.set(t,e,i),this},n.prototype.setOrientation=function(t,e,i,n){return this.orientation.set(t,e,i,n).normalize(),this},n.prototype.add=function(){for(var t=0,e=arguments.length;e>t;t++){var i=arguments[t];if(i instanceof Array)for(var n=0,r=i.length;r>n;n++){var s=i[n];this.add(s)}else i instanceof h?this.addBody(i):i instanceof u?this.addConstraint(i):i instanceof c&&this.addForce(i)}return this},n.prototype.remove=function(){for(var t=0,e=arguments.length;e>t;t++){var i=arguments[t];if(i instanceof Array)for(var n=0,r=i.length;r>n;n++){var s=i[n];this.add(s)}else i instanceof h?this.removeBody(i):i instanceof u?this.removeConstraint(i):i instanceof c&&this.removeForce(i)}return this},n.prototype.addBody=function(t){r(this,t,"bodies")},n.prototype.addForce=function(t){r(this,t,"forces")},n.prototype.addConstraint=function(t){r(this,t,"constraints")},n.prototype.removeBody=function(t){s(this,t,"bodies")},n.prototype.removeForce=function(t){s(this,t,"forces")},n.prototype.removeConstraint=function(t){s(this,t,"constraints")},n.prototype.update=function(t){0===this.time&&(this.time=t);var e=this.bodies,i=this.forces,n=this.constraints,r=this.frameDependent,s=this.step,h=.001*s,u=this.speed,c=this.delta;c+=(t-this.time)*u,this.time=t;for(var p,l,d,f,m;c>s;){for(this.events.trigger("prestep",t),p=0,l=i.length;l>p;p++)d=i[p],null!==d&&d.update(t,h);for(p=0,l=e.length;l>p;p++)f=e[p],null!==f&&o(f,h);for(p=0,l=n.length;l>p;p++)m=n[p],null!==m&&m.update(t,h);for(var g=0,y=this.iterations;y>g;g++)for(p=0,l=n.length;l>p;p++)m=n[p],null!==m&&m.resolve(t,h);for(p=0,l=e.length;l>p;p++)f=e[p],null!==f&&a(f,h);this.events.trigger("poststep",t),r?c=0:c-=s}this.delta=c},n.prototype.getTransform=function(t){var e=this.origin,i=this.orientation,n=this.transformBuffers,r=t.position,s=t.orientation,o=s,a=r;return 1!==i.w&&(o=d.multiply(s,i,m),a=i.rotateVector(r,f)),n.position[0]=e.x+a.x,n.position[1]=e.y+a.y,n.position[2]=e.z+a.z,n.rotation[0]=o.x,n.rotation[1]=o.y,n.rotation[2]=o.z,n.rotation[3]=o.w,n},e.exports=n},{"../math/Quaternion":36,"../math/Vec3":38,"../utilities/CallbackStore":77,"./bodies/Particle":43,"./constraints/Constraint":50,"./forces/Force":61}],42:[function(t,e,i){"use strict";function n(t){o.call(this,t),this.normals=[new r(0,1,0),new r(1,0,0),new r(0,0,1)],this.type=2}var r=t("../../math/Vec3"),s=t("./convexBodyFactory"),o=s([new r(-100,-100,-100),new r(100,-100,-100),new r(-100,-100,100),new r(100,-100,100),new r(-100,100,-100),new r(100,100,-100),new r(-100,100,100),new r(100,100,100)]);n.prototype=Object.create(o.prototype),n.prototype.constructor=n,e.exports=n},{"../../math/Vec3":38,"./convexBodyFactory":46}],43:[function(t,e,i){"use strict";function n(t){this.events=new a,t=t||{},this.position=t.position||new r,this.orientation=t.orientation||new s,this.velocity=new r,this.momentum=new r,this.angularVelocity=new r,this.angularMomentum=new r,this.mass=t.mass||1,this.inverseMass=1/this.mass,this.force=new r,this.torque=new r,this.restitution=null!=t.restitution?t.restitution:.4,this.friction=null!=t.friction?t.friction:.2,this.inverseInertia=new o([0,0,0,0,0,0,0,0,0]),this.localInertia=new o([0,0,0,0,0,0,0,0,0]),this.localInverseInertia=new o([0,0,0,0,0,0,0,0,0]),this.size=t.size||[0,0,0];var e=t.velocity;e&&this.setVelocity(e.x,e.y,e.z),this.restrictions=0,this.setRestrictions.apply(this,t.restrictions||[]),this.collisionMask=t.collisionMask||1,this.collisionGroup=t.collisionGroup||1,this.type=1,this._ID=c++}var r=t("../../math/Vec3"),s=t("../../math/Quaternion"),o=t("../../math/Mat33"),a=t("../../utilities/CallbackStore"),h=new r,u=new o,c=0;n.prototype.on=function(t,e){return this.events.on(t,e),this},n.prototype.off=function(t,e){return this.events.off(t,e),this},n.prototype.trigger=function(t,e){return this.events.trigger(t,e),this},n.prototype.getRestrictions=function(){var t="",e="",i=this.restrictions;return 32&i&&(t+="x"),16&i&&(t+="y"),8&i&&(t+="z"),4&i&&(e+="x"),2&i&&(e+="y"),1&i&&(e+="z"),[t,e]},n.prototype.setRestrictions=function(t,e){return t=t||"",e=e||"",this.restrictions=0,t.indexOf("x")>-1&&(this.restrictions|=32),t.indexOf("y")>-1&&(this.restrictions|=16),t.indexOf("z")>-1&&(this.restrictions|=8),e.indexOf("x")>-1&&(this.restrictions|=4),e.indexOf("y")>-1&&(this.restrictions|=2),e.indexOf("z")>-1&&(this.restrictions|=1),this},n.prototype.getMass=function(){return this.mass},n.prototype.setMass=function(t){return this.mass=t,this.inverseMass=1/t,this},n.prototype.getInverseMass=function(){return this.inverseMass},n.prototype.updateLocalInertia=function(){return this.localInertia.set([0,0,0,0,0,0,0,0,0]),this.localInverseInertia.set([0,0,0,0,0,0,0,0,0]),this},n.prototype.updateInertia=function(){var t=this.localInverseInertia,e=this.orientation;if(t[0]===t[4]&&t[4]===t[8]||1===e.w)return this;var i=e.toMatrix(u);return o.multiply(i,this.inverseInertia,this.inverseInertia),o.multiply(this.localInverseInertia,i.transpose(),this.inverseInertia),this},n.prototype.getPosition=function(){return this.position},n.prototype.setPosition=function(t,e,i){return this.position.set(t,e,i),this},n.prototype.getVelocity=function(){return this.velocity},n.prototype.setVelocity=function(t,e,i){return this.velocity.set(t,e,i),r.scale(this.velocity,this.mass,this.momentum),this},n.prototype.getMomentum=function(){return this.momentum},n.prototype.setMomentum=function(t,e,i){return this.momentum.set(t,e,i),r.scale(this.momentum,this.inverseMass,this.velocity),this},n.prototype.getOrientation=function(){return this.orientation},n.prototype.setOrientation=function(t,e,i,n){return this.orientation.set(t,e,i,n).normalize(),this.updateInertia(),this},n.prototype.getAngularVelocity=function(){return this.angularVelocity},n.prototype.setAngularVelocity=function(t,e,i){this.angularVelocity.set(t,e,i);var n=o.inverse(this.inverseInertia,u);return n?n.vectorMultiply(this.angularVelocity,this.angularMomentum):this.angularMomentum.clear(),this},n.prototype.getAngularMomentum=function(){return this.angularMomentum},n.prototype.setAngularMomentum=function(t,e,i){return this.angularMomentum.set(t,e,i),this.inverseInertia.vectorMultiply(this.angularMomentum,this.angularVelocity),this},n.prototype.getForce=function(){return this.force},n.prototype.setForce=function(t,e,i){return this.force.set(t,e,i),this},n.prototype.getTorque=function(){return this.torque},n.prototype.setTorque=function(t,e,i){return this.torque.set(t,e,i),this},n.prototype.applyForce=function(t){return this.force.add(t),this},n.prototype.applyTorque=function(t){return this.torque.add(t),this},n.prototype.applyImpulse=function(t){return this.momentum.add(t),r.scale(this.momentum,this.inverseMass,this.velocity),this},n.prototype.applyAngularImpulse=function(t){return this.angularMomentum.add(t),this.inverseInertia.vectorMultiply(this.angularMomentum,this.angularVelocity),this},n.prototype.support=function(){return h},n.prototype.updateShape=function(){},e.exports=n},{"../../math/Mat33":35,"../../math/Quaternion":36,"../../math/Vec3":38,"../../utilities/CallbackStore":77}],44:[function(t,e,i){"use strict";function n(t){r.call(this,t);var e=t.radius||1;this.radius=e,this.size=[2*e,2*e,2*e],this.updateLocalInertia(),this.inverseInertia.copy(this.localInverseInertia);var i=t.angularVelocity;i&&this.setAngularVelocity(i.x,i.y,i.z),this.type=4}var r=t("./Particle"),s=t("../../math/Vec3"),o=new s;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.getRadius=function(){return this.radius},n.prototype.setRadius=function(t){return this.radius=t,this.size=[2*this.radius,2*this.radius,2*this.radius],this},n.prototype.updateLocalInertia=function(){var t=this.mass,e=this.radius,i=t*e*e;this.localInertia.set([.4*i,0,0,0,.4*i,0,0,0,.4*i]),this.localInverseInertia.set([2.5/i,0,0,0,2.5/i,0,0,0,2.5/i])},n.prototype.support=function(t){return s.scale(t,this.radius,o)},e.exports=n},{"../../math/Vec3":38,"./Particle":43}],45:[function(t,e,i){"use strict";function n(t){r.call(this,t);var e=this.normal=new s,i=this.direction=t.direction;switch(i){case n.DOWN:e.set(0,1,0);break;case n.UP:e.set(0,-1,0);break;case n.LEFT:e.set(-1,0,0);break;case n.RIGHT:e.set(1,0,0);break;case n.FORWARD:e.set(0,0,-1);break;case n.BACKWARD:e.set(0,0,1)}this.invNormal=s.clone(e,new s).invert(),this.mass=1/0,this.inverseMass=0,this.type=8}var r=t("./Particle"),s=t("../../math/Vec3");n.DOWN=0,n.UP=1,n.LEFT=2,n.RIGHT=3,n.FORWARD=4,n.BACKWARD=5,n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n},{"../../math/Vec3":38,"./Particle":43}],46:[function(t,e,i){"use strict";function n(t){function e(e){s.call(this,e);var i=t.polyhedralProperties.size,n=e.size||i,h=n[0]/i[0],u=n[1]/i[1],c=n[2]/i[2];this._scale=[h,u,c];var p=new o([h,0,0,0,u,0,0,0,c]);this.hull=t,this.vertices=[];for(var l=0,d=t.vertices.length;d>l;l++)this.vertices.push(p.vectorMultiply(t.vertices[l],new a));r.call(this,p),this.inverseInertia.copy(this.localInverseInertia),this.updateInertia();var f=e.angularVelocity;f&&this.setAngularVelocity(f.x,f.y,f.z)}if(!(t instanceof u)){if(!(t instanceof Array))throw new Error("convexBodyFactory requires a ConvexHull object or an array of Vec3's as input.");t=new u(t)}return e.prototype=Object.create(s.prototype),e.prototype.constructor=e,e.prototype.setSize=function(e,i,n){var r=t.polyhedralProperties.size;this.size[0]=e,this.size[1]=i,this.size[2]=n;var s=e/r[0],a=i/r[1],h=n/r[2];this._scale=[s,a,h];for(var u=new o([s,0,0,0,a,0,0,0,h]),c=this.vertices,p=0,l=t.vertices.length;l>p;p++)u.vectorMultiply(t.vertices[p],c[p]);return this},e.prototype.updateLocalInertia=function(){var t=this._scale[0],e=this._scale[1],i=this._scale[2],n=new o([t,0,0,0,e,0,0,0,i]);return r.call(this,n),this},e.prototype.support=function(t){for(var e,i,n,r=this.vertices,s=-(1/0),o=0,h=r.length;h>o;o++)e=r[o],i=a.dot(e,t),i>s&&(n=e,s=i);return n},e.prototype.updateShape=function(){for(var t=this.vertices,e=this.orientation,i=this.hull.vertices,n=this._scale[0],r=this._scale[1],s=this._scale[2],o=c,h=0,u=t.length;u>h;h++)o.copy(i[h]),o.x*=n,o.y*=r,o.z*=s,a.applyRotation(o,e,t[h]);return this},e}function r(t){var e=this.hull.polyhedralProperties,i=t.get(),n=i[0]*i[4]*i[8],r=e.eulerTensor,s=new o;o.multiply(t,r,s),o.multiply(s,t,s);var a=s.get(),h=a[0],u=a[4],c=a[8],p=a[1],l=a[7],d=a[2],f=e.volume*n,m=this.mass,g=m/f,y=u+c,_=h+c,v=h+u,b=-p,T=-l,w=-d,E=e.centroid;y-=f*(E.y*E.y+E.z*E.z),_-=f*(E.z*E.z+E.x*E.x),v-=f*(E.x*E.x+E.y*E.y),b+=f*E.x*E.y,T+=f*E.y*E.z,w+=f*E.z*E.x,y*=g*n,_*=g*n,v*=g*n,b*=g*n,T*=g*n,w*=g*n;var I=[y,b,w,b,_,T,w,T,v];this.localInertia.set(I),o.inverse(this.localInertia,this.localInverseInertia)}var s=t("./Particle"),o=t("../../math/Mat33"),a=t("../../math/Vec3"),h=t("../Geometry"),u=h.ConvexHull,c=new a;e.exports=n},{"../../math/Mat33":35,"../../math/Vec3":38,"../Geometry":40,"./Particle":43}],47:[function(t,e,i){"use strict";function n(t,e,i){this.a=t,this.b=e,r.call(this,i),this.effectiveInertia=new o,this.angularImpulse=new s,this.error=0}var r=t("./Constraint"),s=t("../../math/Vec3"),o=t("../../math/Mat33"),a=new s;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.init=function(){this.cosAngle=this.cosAngle||this.a.orientation.dot(this.b.orientation)},n.prototype.update=function(){var t=this.a,e=this.b,i=t.orientation,n=e.orientation,r=i.dot(n),s=2*(r-this.cosAngle);this.error=s;var a=this.angularImpulse;e.applyAngularImpulse(a),t.applyAngularImpulse(a.invert()),o.add(t.inverseInertia,e.inverseInertia,this.effectiveInertia),this.effectiveInertia.inverse(),a.clear()},n.prototype.resolve=function(){var t=this.a,e=this.b,i=a,n=t.angularVelocity,r=e.angularVelocity;s.subtract(n,r,i),i.scale(1+this.error);var o=i.applyMatrix(this.effectiveInertia);e.applyAngularImpulse(o),t.applyAngularImpulse(o.invert()),o.invert(),this.angularImpulse.add(o)},e.exports=n},{"../../math/Mat33":35,"../../math/Vec3":38,"./Constraint":50}],48:[function(t,e,i){"use strict";function n(t,e,i){this.a=t,this.b=e,r.call(this,i),this.impulse=new s,this.angImpulseA=new s,this.angImpulseB=new s,this.error=new s,this.effMassMatrix=new o}var r=t("./Constraint"),s=t("../../math/Vec3"),o=t("../../math/Mat33"),a=t("../../math/Quaternion"),h=new s,u=new s,c=new s,p=new s,l=new s;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.init=function(){var t=this.anchor,e=this.a,i=this.b,n=a.conjugate(e.orientation,new a),r=a.conjugate(i.orientation,new a);this.rA=s.subtract(t,e.position,new s),this.rB=s.subtract(t,i.position,new s),this.bodyRA=n.rotateVector(this.rA,new s),this.bodyRB=r.rotateVector(this.rB,new s)},n.prototype.update=function(t,e){var i=this.a,n=this.b,r=i.orientation.rotateVector(this.bodyRA,this.rA),a=n.orientation.rotateVector(this.bodyRB,this.rB),h=new o([0,r.z,-r.y,-r.z,0,r.x,r.y,-r.x,0]),c=new o([0,a.z,-a.y,-a.z,0,a.x,a.y,-a.x,0]),p=o.multiply(h,i.inverseInertia,new o).multiply(h.transpose()),l=o.multiply(c,n.inverseInertia,new o).multiply(c.transpose()),d=o.add(p,l,p),f=s.add(i.position,this.rA,this.anchor),m=s.add(n.position,this.rB,u);s.subtract(m,f,this.error),this.error.scale(.2/e);var g=i.inverseMass,y=n.inverseMass,_=new o([g+y,0,0,0,g+y,0,0,0,g+y]);o.add(d,_,this.effMassMatrix),this.effMassMatrix.inverse();var v=this.impulse,b=this.angImpulseA,T=this.angImpulseB;n.applyImpulse(v),n.applyAngularImpulse(T),v.invert(),i.applyImpulse(v),i.applyAngularImpulse(b),v.clear(),b.clear(),T.clear()},n.prototype.resolve=function(){var t=this.a,e=this.b,i=this.rA,n=this.rB,r=s.add(t.velocity,s.cross(t.angularVelocity,i,l),c),o=s.add(e.velocity,s.cross(e.angularVelocity,n,l),p),a=r.subtract(o).subtract(this.error).applyMatrix(this.effMassMatrix),d=s.cross(n,a,h),f=s.cross(i,a,u).invert();e.applyImpulse(a),e.applyAngularImpulse(d),a.invert(),t.applyImpulse(a),t.applyAngularImpulse(f),a.invert(),this.impulse.add(a),this.angImpulseA.add(f),this.angImpulseB.add(d)},e.exports=n},{"../../math/Mat33":35,"../../math/Quaternion":36,"../../math/Vec3":38,"./Constraint":50}],49:[function(t,e,i){"use strict";function n(t,e,i){return e>t?e:t>i?i:t}function r(t,e,i,n,r,s){this.penetration=t,this.normal=e,this.worldContactA=i,this.worldContactB=n,this.localContactA=r,this.localContactB=s}function s(t,e){this.targets=[],t&&(this.targets=this.targets.concat(t)),p.call(this,e)}function o(t,e,i){var n=e.position,r=i.position,s=c.subtract(r,n,new c),o=s.length(),a=e.radius+i.radius,h=s.scale(1/o),u=a-o;if(!(0>u)){var p=c.scale(h,e.radius,new c),l=c.scale(h,-i.radius,new c),d=c.add(n,p,new c),f=c.add(r,l,new c),m=v().reset(u,h,d,f,p,l);t.contactManifoldTable.registerContact(e,i,m)}}function a(t,e,i){if(e.type===E){var r=i;i=e,e=r}var s=e.position,o=i.position,a=c.subtract(o,s,b),h=e.orientation,u=i.radius,p=e.size,l=.5*p[0],d=.5*p[1],f=.5*p[2],m=e.normals,g=h.rotateVector(m[1],new c),y=h.rotateVector(m[0],new c),_=h.rotateVector(m[2],new c),T=new c;T.x=n(c.dot(a,g),-l,l),T.y=n(c.dot(a,y),-d,d),T.z=n(c.dot(a,_),-f,f),T.applyRotation(h);var w=c.add(s,T,new c),I=c.subtract(w,o,w),C=I.length(),x=u-C;if(!(0>x)){var R=c.scale(I,-1/C,new c),A=T,S=I,O=c.add(s,A,new c),M=c.add(o,S,new c),N=v().reset(x,R,O,M,A,S);t.contactManifoldTable.registerContact(e,i,N)}}function h(t,e,i){var n=m(e,i);if(n){var r=g(e,i,n);null!==r&&t.contactManifoldTable.registerContact(e,i,r)}}function u(t,e,i){if(e.type===I){var n=i;i=e,e=n}var r=e.position,s=i.position,o=i.normal,a=i.invNormal,h=e.support(a),u=c.add(r,h,new c),p=c.subtract(u,s,b),l=c.dot(p,a);if(!(0>l)){var d=c.scale(o,l,new c).add(u),f=c.subtract(d,i.position,new c),m=v().reset(l,a,u,d,h,f);t.contactManifoldTable.registerContact(e,i,m)}}var c=t("../../math/Vec3"),p=t("./Constraint"),l=t("./collision/SweepAndPrune"),d=t("./collision/BruteForce"),f=t("./collision/ConvexCollisionDetection"),m=f.gjk,g=f.epa,y=t("./collision/ContactManifold"),_=t("../../utilities/ObjectManager");_.register("CollisionData",r);var v=_.requestCollisionData,b=new c;r.prototype.reset=function(t,e,i,n,r,s){return this.penetration=t,this.normal=e,this.worldContactA=i,this.worldContactB=n,this.localContactA=r,this.localContactB=s,this},s.prototype=Object.create(p.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(this.broadPhase){var t=this.broadphase;t instanceof Function&&(this.broadPhase=new t(this.targets))}else this.broadPhase=new l(this.targets);this.contactManifoldTable=this.contactManifoldTable||new y},s.prototype.update=function(t,e){if(this.contactManifoldTable.update(e),0!==this.targets.length){var i,n;for(i=0,n=this.targets.length;n>i;i++)this.targets[i].updateShape();var r,s=this.broadPhase.update();for(i=0,n=s.length;n>i;i++)r=s[i],r&&this.applyNarrowPhase(r);this.contactManifoldTable.prepContacts(e)}},s.prototype.resolve=function(t,e){this.contactManifoldTable.resolveManifolds(e)},s.prototype.addTarget=function(t){this.targets.push(t),this.broadPhase.add(t)},s.prototype.removeTarget=function(t){var e=this.targets.indexOf(t);0>e||(this.targets.splice(e,1),this.broadPhase.remove(t))};var T=1,w=2,E=4,I=8,C=T|T,x=w|w,R=w|T,A=E|E,S=w|E,O=T|E,M=T|I,N=w|I,D=E|I,L={};L[C]=h,L[x]=h,L[R]=h,L[O]=h,L[A]=o,L[S]=a,L[M]=u,L[N]=u,L[D]=u,s.prototype.applyNarrowPhase=function(t){for(var e=0,i=t.length;i>e;e++)for(var n=e+1;i>n;n++){var r=t[e],s=t[n];if(0!==(r.collisionMask&s.collisionGroup&&r.collisionGroup&s.collisionMask)){var o=r.type|s.type;L[o]&&L[o](this,r,s)}}},s.SweepAndPrune=l,s.BruteForce=d.BruteForce,s.BruteForceAABB=d.BruteForceAABB,e.exports=s},{"../../math/Vec3":38,"../../utilities/ObjectManager":78,"./Constraint":50,"./collision/BruteForce":56,"./collision/ContactManifold":57,"./collision/ConvexCollisionDetection":58,"./collision/SweepAndPrune":59}],50:[function(t,e,i){"use strict";function n(t){t=t||{},this.setOptions(t),this._ID=r++}var r=0;n.prototype.setOptions=function(t){for(var e in t)this[e]=t[e];this.init(t)},n.prototype.init=function(t){},n.prototype.update=function(t,e){},n.prototype.resolve=function(t,e){},e.exports=n},{}],51:[function(t,e,i){"use strict";function n(t,e){t?t instanceof Array?this.targets=t:this.targets=[t]:this.targets=[],r.call(this,e),this.impulses={},this.normals={},this.velocityBiases={},this.divisors={}}var r=t("./Constraint"),s=t("../../math/Vec3"),o=new s,a=new s,h=1e-7,u=Math.PI;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.init=function(){this.equation1=this.equation1||function(){return 0},this.equation2=this.equation2||function(t,e,i){return i},this.period=this.period||1,this.dampingRatio=this.dampingRatio||.5,this.stiffness=4*u*u/(this.period*this.period),this.damping=4*u*this.dampingRatio/this.period},n.prototype.update=function(t,e){for(var i=this.targets,n=this.normals,r=this.velocityBiases,u=this.divisors,c=this.impulses,p=o,l=a,d=this.equation1,f=this.equation2,m=this.damping,g=this.stiffness,y=0,_=i.length;_>y;y++){var v=i[y],b=v._ID;if(!v.immune){var T,w,E=v.position,I=v.mass;if(0===this.period)T=0,w=1;else{var C=m*I,x=g*I;T=1/(e*(C+e*x)),w=e*x/(C+e*x)}var R=E.x,A=E.y,S=E.z,O=d(R,A,S),M=(d(R+h,A,S)-O)/h,N=(d(R,A+h,S)-O)/h,D=(d(R,A,S+h)-O)/h,L=f(R,A,S),z=(f(R+h,A,S)-L)/h,P=(f(R,A+h,S)-L)/h,U=(f(R,A,S+h)-L)/h;l.set(M+z,N+P,D+U),l.normalize();var F=w*(O+L)/e,V=T+1/I,G=c[b]||0;s.scale(l,G,p),v.applyImpulse(p),n[b]=n[b]||new s,n[b].copy(l),r[b]=F,u[b]=V,c[b]=0}}},n.prototype.resolve=function(){for(var t=this.targets,e=this.normals,i=this.velocityBiases,n=this.divisors,r=this.impulses,a=o,h=0,u=t.length;u>h;h++){var c=t[h],p=c._ID;if(!c.immune){var l=c.velocity,d=e[p],f=-(s.dot(d,l)+i[p])/n[p];s.scale(d,f,a),c.applyImpulse(a),r[p]+=f}}},e.exports=n},{"../../math/Vec3":38,"./Constraint":50}],52:[function(t,e,i){"use strict";function n(t,e,i){this.a=t,this.b=e,r.call(this,i),this.impulse=0,this.distance=0,this.normal=new s,this.velocityBias=0,this.divisor=0}var r=t("./Constraint"),s=t("../../math/Vec3"),o=new s,a=new s,h=new s,u=new s,c=new s,p=Math.PI;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.init=function(){this.direction=this.direction||s.subtract(this.b.position,this.a.position,new s),this.direction.normalize(),this.minLength=this.minLength||0,this.period=this.period||.2,this.dampingRatio=this.dampingRatio||.5,this.stiffness=4*p*p/(this.period*this.period),this.damping=4*p*this.dampingRatio/this.period},n.prototype.update=function(t,e){var i=this.a,n=this.b,r=o,h=u,p=a,l=c,d=i.position,f=i.inverseMass,m=n.position,g=n.inverseMass,y=this.direction;s.subtract(m,d,h),s.scale(y,s.dot(y,h),l);var _=l.add(d);s.subtract(m,_,r);var v=r.length();r.normalize();var b,T,w=f+g,E=1/w;if(0===this.period)b=0,T=1;else{var I=this.damping*E,C=this.stiffness*E;b=1/(e*(I+e*C)),T=e*C/(I+e*C)}var x=T*v/e,R=b+w,A=this.impulse;s.scale(r,A,p),n.applyImpulse(p),i.applyImpulse(p.invert()),this.normal.copy(r),this.distance=v,this.velocityBias=x,this.divisor=R,this.impulse=0},n.prototype.resolve=function(){var t=this.a,e=this.b,i=a,n=h,r=this.minLength,o=this.distance;if(!(Math.abs(o)<r)){var u=t.velocity,c=e.velocity,p=this.normal;s.subtract(c,u,n);var l=-(s.dot(p,n)+this.velocityBias)/this.divisor;s.scale(p,l,i),e.applyImpulse(i),t.applyImpulse(i.invert()),this.impulse+=l}},e.exports=n},{"../../math/Vec3":38,"./Constraint":50}],53:[function(t,e,i){"use strict";function n(t,e,i){this.a=t,this.b=e,r.call(this,i),this.impulse=0,this.distance=0,this.normal=new s,this.velocityBias=0,this.divisor=0}var r=t("./Constraint"),s=t("../../math/Vec3"),o=new s,a=new s,h=new s,u=new s,c=Math.PI;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.init=function(){this.length=this.length||s.subtract(this.b.position,this.a.position,u).length(),this.minLength=this.minLength||0,this.period=this.period||.2,this.dampingRatio=this.dampingRatio||.5,this.stiffness=4*c*c/(this.period*this.period),this.damping=4*c*this.dampingRatio/this.period},n.prototype.update=function(t,e){var i=this.a,n=this.b,r=o,h=u,c=a,p=this.length,l=i.position,d=i.inverseMass,f=n.position,m=n.inverseMass;s.subtract(f,l,h);var g=h.length();s.scale(h,1/g,r);var y,_,v=g-p,b=d+m,T=1/b;if(0===this.period)y=0,_=1;else{var w=this.damping*T,E=this.stiffness*T;y=1/(e*(w+e*E)),_=e*E/(w+e*E)}var I=_*v/e,C=y+b,x=this.impulse;s.scale(r,x,c),n.applyImpulse(c),i.applyImpulse(c.invert()),this.normal.copy(r),this.distance=v,this.velocityBias=I,this.divisor=C,this.impulse=0},n.prototype.resolve=function(){var t=this.a,e=this.b,i=a,n=h,r=this.minLength,o=this.distance;if(!(Math.abs(o)<r)){var u=t.getVelocity(),c=e.getVelocity(),p=this.normal;s.subtract(c,u,n);var l=-(s.dot(p,n)+this.velocityBias)/this.divisor;s.scale(p,l,i),e.applyImpulse(i),t.applyImpulse(i.invert()),this.impulse+=l}},e.exports=n},{"../../math/Vec3":38,"./Constraint":50}],54:[function(t,e,i){"use strict";function n(t,e,i){this.a=t,this.b=e,r.call(this,i),this.impulse=new s,this.angImpulseA=new s,this.angImpulseB=new s,this.error=new s,this.errorRot=[0,0],this.effMassMatrix=new o,this.effMassMatrixRot=[]}var r=t("./Constraint"),s=t("../../math/Vec3"),o=t("../../math/Mat33"),a=t("../../math/Quaternion"),h=new s,u=new s,c=new s,p=new s,l=new s,d=new s,f=new s,m=new s;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.init=function(){var t=this.anchor,e=this.axis.normalize(),i=this.a,n=this.b,r=a.conjugate(i.orientation,new a),o=a.conjugate(n.orientation,new a);this.rA=s.subtract(t,i.position,new s),this.rB=s.subtract(t,n.position,new s),this.bodyRA=r.rotateVector(this.rA,new s),this.bodyRB=o.rotateVector(this.rB,new s),this.axisA=s.clone(e),this.axisB=s.clone(e),this.axisBTangent1=new s,this.axisBTangent2=new s,this.t1xA=new s,this.t2xA=new s,this.bodyAxisA=r.rotateVector(e,new s),this.bodyAxisB=o.rotateVector(e,new s)},n.prototype.update=function(t,e){var i=this.a,n=this.b,r=i.orientation.rotateVector(this.bodyAxisA,this.axisA),a=n.orientation.rotateVector(this.bodyAxisB,this.axisB);this.axis.copy(a);var l=a,d=this.axisBTangent1,f=this.axisBTangent2;l.x>=.57735?d.set(l.y,-l.x,0):d.set(0,l.z,-l.y),d.normalize(),s.cross(l,d,f);var m=s.cross(d,r,this.t1xA),g=s.cross(f,r,this.t2xA),y=i.orientation.rotateVector(this.bodyRA,this.rA),_=n.orientation.rotateVector(this.bodyRB,this.rB),v=new o([0,y.z,-y.y,-y.z,0,y.x,y.y,-y.x,0]),b=new o([0,_.z,-_.y,-_.z,0,_.x,_.y,-_.x,0]),T=o.multiply(v,i.inverseInertia,new o).multiply(v.transpose()),w=o.multiply(b,n.inverseInertia,new o).multiply(b.transpose()),E=o.add(T,w,T),I=s.add(i.position,this.rA,this.anchor),C=s.add(n.position,this.rB,h),x=1/e;s.subtract(C,I,this.error),this.error.scale(.2*x);var R=i.inverseMass,A=n.inverseMass,S=new o([R+A,0,0,0,R+A,0,0,0,R+A]);o.add(E,S,this.effMassMatrix),this.effMassMatrix.inverse();var O=i.inverseInertia.vectorMultiply(m,h),M=i.inverseInertia.vectorMultiply(g,u),N=n.inverseInertia.vectorMultiply(m,c),D=n.inverseInertia.vectorMultiply(g,p),L=s.dot(m,O)+s.dot(m,N),z=s.dot(m,M)+s.dot(m,D),P=s.dot(g,O)+s.dot(g,N),U=s.dot(g,M)+s.dot(g,D),F=1/(L*U-z*P);this.effMassMatrixRot[0]=U*F,this.effMassMatrixRot[1]=-P*F,this.effMassMatrixRot[2]=-z*F,this.effMassMatrixRot[3]=L*F,this.errorRot[0]=.2*s.dot(r,d)*x,this.errorRot[1]=.2*s.dot(r,f)*x;var V=this.impulse.scale(.5),G=this.angImpulseA.scale(.5),k=this.angImpulseB.scale(.5);n.applyImpulse(V),n.applyAngularImpulse(k),V.invert(),i.applyImpulse(V),i.applyAngularImpulse(G),V.clear(),G.clear(),k.clear()},n.prototype.resolve=function(){var t=this.a,e=this.b,i=this.rA,n=this.rB,r=this.t1xA,o=this.t2xA,a=t.angularVelocity,g=e.angularVelocity,y=s.add(t.velocity,s.cross(a,i,f),l),_=s.add(e.velocity,s.cross(g,n,f),d),v=y.subtract(_).subtract(this.error).applyMatrix(this.effMassMatrix),b=s.subtract(g,a,m),T=this.errorRot,w=s.dot(r,b)+T[0],E=s.dot(o,b)+T[1],I=this.effMassMatrixRot,C=-(I[0]*w+I[1]*E),x=-(I[2]*w+I[3]*E),R=s.scale(r,C,u).add(s.scale(o,x,c)),A=s.cross(n,v,h).add(R),S=s.cross(i,v,p).invert().subtract(R);e.applyImpulse(v),e.applyAngularImpulse(A),v.invert(),t.applyImpulse(v),t.applyAngularImpulse(S),v.invert(),this.impulse.add(v),this.angImpulseA.add(S),this.angImpulseB.add(A)},e.exports=n},{"../../math/Mat33":35,"../../math/Quaternion":36,"../../math/Vec3":38,"./Constraint":50}],55:[function(t,e,i){"use strict";function n(t){this._body=t,this._ID=t._ID,this.position=null,this.vertices={x:[],y:[],z:[]},this.update()}var r=4,s=8,o=0,a=1,h=2,u=3,c=4,p=5;n.prototype.update=function(){var t=this._body,e=this.position=t.position,i=1/0,n=-(1/0),l=1/0,d=-(1/0),f=1/0,m=-(1/0),g=t.type;if(g===r)n=d=m=t.radius,i=l=f=-t.radius;else if(g===s){var y=t.direction;switch(n=d=m=1e6,i=l=f=-1e6,y){case o:d=25,l=-1e3;break;case a:d=1e3,l=-25;break;case h:n=25,i=-1e3;break;case u:n=1e3,i=-25;break;case c:m=25,f=-1e3;break;case p:m=1e3,f=-25}}else if(t.vertices)for(var _=t.vertices,v=0,b=_.length;b>v;v++){var T=_[v];T.x<i&&(i=T.x),T.x>n&&(n=T.x),T.y<l&&(l=T.y),T.y>d&&(d=T.y),T.z<f&&(f=T.z),T.z>m&&(m=T.z)}else n=d=m=25,i=l=f=-25;var w=this.vertices;w.x[0]=i+e.x,w.x[1]=n+e.x,w.y[0]=l+e.y,w.y[1]=d+e.y,w.z[0]=f+e.z,w.z[1]=m+e.z},n.checkOverlap=function(t,e){var i=t.vertices,n=e.vertices,r=i.x[0],s=i.x[1],o=n.x[0],a=n.x[1];if(r>=o&&a>=r||o>=r&&s>=o){var h=i.y[0],u=i.y[1],c=n.y[0],p=n.y[1];if(h>=c&&p>=h||c>=h&&u>=c){var l=i.z[0],d=i.z[1],f=n.z[0],m=n.z[1];if(l>=f&&m>=l||f>=l&&d>=f)return!0}}return!1},n.vertexThreshold=100,e.exports=n},{}],56:[function(t,e,i){"use strict";function n(t){this._volumes=[],this._entityRegistry={};for(var e=0;e<t.length;e++)this.add(t[e])}function r(t){this.targets=t}var s=t("./AABB");n.prototype.add=function(t){var e=new s(t);this._entityRegistry[t._ID]=t,this._volumes.push(e)},n.prototype.update=function(){for(var t=this._volumes,e=this._entityRegistry,i=0,n=t.length;n>i;i++)t[i].update();for(var r=[],o=0,a=t.length;a>o;o++)for(var h=o+1;a>h;h++)s.checkOverlap(t[o],t[h])&&r.push([e[o],e[h]]);return r},r.prototype.add=function(t){this.targets.push(t)},r.prototype.update=function(){return[this.targets]},e.exports.BruteForceAABB=n,e.exports.BruteForce=r},{"./AABB":55}],57:[function(t,e,i){"use strict";function n(t,e,i){return e>t?e:t>i?i:t}function r(){this.manifolds=[],this.collisionMatrix={},this._IDPool=[]}function s(t,e,i,n){this.lowID=t,this.highID=e,this.contacts=[],this.numContacts=0,this.bodyA=i,this.bodyB=n,this.lru=0}function o(t,e,i){this.bodyA=t,this.bodyB=e,this.data=i,this.normalImpulse=0,this.tangentImpulse1=0,this.tangentImpulse2=0,this.impulse=new a,this.angImpulseA=new a,this.angImpulseB=new a,i&&this.init()}var a=t("../../../math/Vec3"),h=t("../../../utilities/ObjectManager");h.register("Manifold",s),h.register("Contact",o);var u=h.requestManifold,c=h.requestContact,p=h.freeManifold,l=h.freeContact,d=new a,f=new a,m=new a,g=new a,y=new a,_=new a,v=new a,b=new a,T=new a,w=new a,E=new a,I=new a,C=new a,x=new a,R=new a;r.prototype.addManifold=function(t,e,i,n){var r=this.collisionMatrix;r[t]=r[t]||{};var s=this._IDPool.length?this._IDPool.pop():this.manifolds.length;this.collisionMatrix[t][e]=s;var o=u().reset(t,e,i,n);return this.manifolds[s]=o,o},r.prototype.removeManifold=function(t,e){var i=this.collisionMatrix;this.manifolds[e]=null,i[t.lowID][t.highID]=null,this._IDPool.push(e),p(t)},r.prototype.update=function(t){for(var e=this.manifolds,i=0,n=e.length;n>i;i++){var r=e[i];if(r){var s=r.update(t);s||(this.removeManifold(r,i),r.bodyA.events.trigger("collision:end",r),r.bodyB.events.trigger("collision:end",r))}}},r.prototype.prepContacts=function(t){for(var e=this.manifolds,i=0,n=e.length;n>i;i++){var r=e[i];if(r)for(var s=r.contacts,o=0,a=s.length;a>o;o++){var h=s[o];h&&h.update(t)}}},r.prototype.resolveManifolds=function(){for(var t=this.manifolds,e=0,i=t.length;i>e;e++){var n=t[e];n&&n.resolveContacts()}},r.prototype.registerContact=function(t,e,i){var n,r;t._ID<e._ID?(n=t._ID,r=e._ID):(n=e._ID,r=t._ID);var s,o=this.manifolds,a=this.collisionMatrix;a[n]&&null!=a[n][r]?(s=o[a[n][r]],s.contains(i),s.addContact(t,e,i)):(s=this.addManifold(n,r,t,e),s.addContact(t,e,i),t.events.trigger("collision:start",s),e.events.trigger("collision:start",s))};var A=10;s.prototype.reset=function(t,e,i,n){return this.lowID=t,this.highID=e,this.contacts=[],this.numContacts=0,this.bodyA=i,this.bodyB=n,this.lru=0,this},s.prototype.addContact=function(t,e,i){var n=this.lru;this.contacts[n]&&this.removeContact(this.contacts[n],n),this.contacts[n]=c().reset(t,e,i),this.lru=(this.lru+1)%4,this.numContacts++},s.prototype.removeContact=function(t,e){this.contacts[e]=null,this.numContacts--,h.freeCollisionData(t.data),t.data=null,l(t)},s.prototype.contains=function(t){for(var e=t.worldContactA,i=t.worldContactB,n=this.contacts,r=0,s=n.length;s>r;r++){var o=n[r];if(o){var h=o.data,u=a.subtract(h.worldContactA,e,x).length(),c=a.subtract(h.worldContactB,i,R).length();if(A>u||A>c)return this.removeContact(o,r),!0}}return!1},s.prototype.update=function(){for(var t=this.contacts,e=this.bodyA,i=this.bodyB,n=e.position,r=i.position,s=0,o=t.length;o>s;s++){var h=t[s];if(h){var u=h.data,c=u.normal,p=u.localContactA,l=u.localContactB,d=u.worldContactA,f=u.worldContactB,m=a.add(n,p,E),g=a.add(r,l,I),y=a.dot(a.subtract(g,m,C),c)>0,_=a.subtract(d,m,x),v=a.subtract(f,g,R);(_.length()>=A||v.length()>=A||y)&&this.removeContact(h,s)}}return this.numContacts?!0:!1},s.prototype.resolveContacts=function(){for(var t=this.contacts,e=0,i=t.length;i>e;e++)t[e]&&t[e].resolve()},o.prototype.reset=function(t,e,i){return this.bodyA=t,this.bodyB=e,this.data=i,this.normalImpulse=0,this.tangentImpulse1=0,this.tangentImpulse2=0,this.impulse.clear(),this.angImpulseA.clear(),this.angImpulseB.clear(),this.init(),this},o.prototype.init=function(){var t=this.data,e=t.normal,i=new a;e.x>=.57735?i.set(e.y,-e.x,0):i.set(0,e.z,-e.y),i.normalize();var n=a.cross(e,i,new a);this.tangent1=i,this.tangent2=n;var r=this.bodyA,s=this.bodyB,o=t.localContactA,h=t.localContactB,u=r.inverseMass+s.inverseMass,c=a.cross(o,e,_),p=a.cross(h,e,v);
this.effNormalMass=1/(u+a.dot(c,r.inverseInertia.vectorMultiply(c,d))+a.dot(p,s.inverseInertia.vectorMultiply(p,d)));var l=a.cross(o,i,_),f=a.cross(h,i,v);this.effTangentialMass1=1/(u+a.dot(l,r.inverseInertia.vectorMultiply(l,d))+a.dot(f,s.inverseInertia.vectorMultiply(f,d)));var m=a.cross(o,n,_),g=a.cross(h,n,v);this.effTangentialMass2=1/(u+a.dot(m,r.inverseInertia.vectorMultiply(m,d))+a.dot(g,s.inverseInertia.vectorMultiply(g,d))),this.restitution=Math.min(r.restitution,s.restitution),this.friction=r.friction*s.friction},o.prototype.update=function(t){var e=this.data,i=this.bodyA,n=this.bodyB,r=e.localContactA,s=e.localContactB,o=e.normal,h=a.add(i.velocity,a.cross(i.angularVelocity,r,y),m),u=a.add(n.velocity,a.cross(n.angularVelocity,s,y),g),c=u.subtract(h),p=a.dot(c,o),l=.15,d=1.5,f=20,_=Math.abs(p)<f?0:this.restitution;this.velocityBias=-l*Math.max(e.penetration-d,0)/t,this.velocityBias+=_*p;var v=this.impulse.scale(.25),b=this.angImpulseA.scale(.25),T=this.angImpulseB.scale(.25);n.applyImpulse(v),n.applyAngularImpulse(T),v.invert(),i.applyImpulse(v),i.applyAngularImpulse(b),this.normalImpulse=0,this.tangentImpulse1=0,this.tangentImpulse2=0,v.clear(),b.clear(),T.clear()},o.prototype.resolve=function(){var t=this.data,e=this.bodyA,i=this.bodyB,r=t.localContactA,s=t.localContactB,o=t.normal,h=this.tangent1,u=this.tangent2,c=a.add(e.velocity,a.cross(e.angularVelocity,r,y),m),p=a.add(i.velocity,a.cross(i.angularVelocity,s,y),g),l=p.subtract(c),_=-(a.dot(l,o)+this.velocityBias)*this.effNormalMass,v=Math.max(this.normalImpulse+_,0);_=v-this.normalImpulse;var E=this.friction*v,I=-a.dot(l,h)*this.effTangentialMass1,C=n(this.tangentImpulse1+I,-E,E);I=C-this.tangentImpulse1;var x=-a.dot(l,u)*this.effTangentialMass2,R=n(this.tangentImpulse2+x,-E,E);x=R-this.tangentImpulse2;var A=a.scale(o,_,b),S=a.scale(h,I,T),O=a.scale(u,x,w);A.add(S).add(O);var M=a.cross(s,A,d),N=a.cross(r,A,f).invert();i.applyImpulse(A),i.applyAngularImpulse(M),A.invert(),e.applyImpulse(A),e.applyAngularImpulse(N),this.normalImpulse=v,this.tangentImpulse1=C,this.tangentImpulse2=R,this.impulse.add(A),this.angImpulseA.add(N),this.angImpulseB.add(M)},e.exports=r},{"../../../math/Vec3":38,"../../../utilities/ObjectManager":78}],58:[function(t,e,i){"use strict";function n(t,e,i){this.vertex=t,this.worldVertexA=e,this.worldVertexB=i}function r(t){var e,i=t.vertices;for(e=i.length;e--;){var n=i.pop();null!==n&&l(n)}t.numVertices=0;var r=t.features;for(e=r.length;e--;){var s=r.pop();null!==s&&f(s)}t.numFeatures=0,d(t)}function s(t,e,i){var n=h.scale(i,-1,b),r=h.add(t.support(i),t.position,new h),s=h.add(e.support(n),e.position,new h);return c().reset(h.subtract(r,s,new h),r,s)}function o(t,e){var i=s,n=h.subtract(e.position,t.position,v).normalize(),o=p();o.addVertex(i(t,e,n)),n.invert();for(var a=0,u=1e3;a++<u&&(0!==n.x||0!==n.y||0!==n.z)&&(o.addVertex(i(t,e,n)),!(h.dot(o.getLastVertex().vertex,n)<0));)if(o.simplexContainsOrigin(n,l))return o;return r(o),!1}function a(t,e,i){for(var n=s,o=1/0,a=0,c=1e3;a++<c;){var p=i.getFeatureClosestToOrigin();if(null===p)return null;var d=p.normal,f=n(t,e,d);if(o=Math.min(o,h.dot(f.vertex,d)),o-p.distance<=.01){var v=i.vertices[p.vertexIndices[0]],b=i.vertices[p.vertexIndices[1]],T=i.vertices[p.vertexIndices[2]],w=v.vertex,E=b.vertex,I=T.vertex,C=h.scale(d,p.distance,m),x=h.subtract(E,w,g),R=h.subtract(I,w,y),A=h.subtract(C,w,_),S=h.dot(x,x),O=h.dot(x,R),M=h.dot(R,R),N=h.dot(A,x),D=h.dot(A,R),L=S*M-O*O,z=(M*N-O*D)/L,P=(S*D-O*N)/L,U=1-z-P,F=v.worldVertexA.scale(U).add(b.worldVertexA.scale(z)).add(T.worldVertexA.scale(P)),V=v.worldVertexB.scale(U).add(b.worldVertexB.scale(z)).add(T.worldVertexB.scale(P)),G=h.subtract(F,t.position,new h),k=h.subtract(V,e.position,new h);return r(i),l(f),u.requestCollisionData().reset(p.distance,d,F,V,G,k)}i.addVertex(f),i.reshape()}throw new Error("EPA failed to terminate in allotted iterations.")}var h=t("../../../math/Vec3"),u=t("../../../utilities/ObjectManager");u.register("GJK_EPASupportPoint",n);var c=u.requestGJK_EPASupportPoint,p=u.requestDynamicGeometry,l=u.freeGJK_EPASupportPoint,d=u.freeDynamicGeometry,f=u.freeDynamicGeometryFeature,m=new h,g=new h,y=new h,_=new h,v=new h,b=new h;n.prototype.reset=function(t,e,i){return this.vertex=t,this.worldVertexA=e,this.worldVertexB=i,this},e.exports.gjk=o,e.exports.epa=a},{"../../../math/Vec3":38,"../../../utilities/ObjectManager":78}],59:[function(t,e,i){"use strict";function n(t){this._sweepVolumes=[],this._entityRegistry={},this._boundingVolumeRegistry={},this.endpoints={x:[],y:[],z:[]},this.overlaps=[],this.overlapsMatrix={},this._IDPool=[],t=t||[];for(var e=0;e<t.length;e++)this.add(t[e])}function r(t){this._boundingVolume=t,this._ID=t._ID,this.points={x:[{_ID:t._ID,side:0,value:null},{_ID:t._ID,side:1,value:null}],y:[{_ID:t._ID,side:0,value:null},{_ID:t._ID,side:1,value:null}],z:[{_ID:t._ID,side:0,value:null},{_ID:t._ID,side:1,value:null}]},this.update()}var s=t("./AABB"),o=["x","y","z"];n.prototype.add=function(t){var e=new s(t),i=new r(e);this._entityRegistry[t._ID]=t,this._boundingVolumeRegistry[t._ID]=e,this._sweepVolumes.push(i);for(var n=0;3>n;n++){var a=o[n];this.endpoints[a].push(i.points[a][0]),this.endpoints[a].push(i.points[a][1])}},n.prototype.remove=function(t){this._entityRegistry[t._ID]=null,this._boundingVolumeRegistry[t._ID]=null;var e,i,n;for(e=0,i=this._sweepVolumes.length;i>e;e++)if(this._sweepVolumes[e]._ID===t._ID){n=e;break}this._sweepVolumes.splice(n,1);var r,s=this.endpoints,o=[];for(e=0,i=s.x.length;i>e;e++)r=s.x[e],r._ID!==t._ID&&o.push(r);var a=[];for(e=0,i=s.y.length;i>e;e++)r=s.y[e],r._ID!==t._ID&&a.push(r);var h=[];for(e=0,i=s.z.length;i>e;e++)r=s.z[e],r._ID!==t._ID&&h.push(r);s.x=o,s.y=a,s.z=h},n.prototype.update=function(){var t,e,i,n,r=this._sweepVolumes,a=this._entityRegistry,h=this._boundingVolumeRegistry;for(e=0,n=r.length;n>e;e++)r[e].update();var u=this.endpoints,c=this.overlaps,p=this.overlapsMatrix,l=this._IDPool;for(i=0;3>i;i++){var d=o[i],f=u[d];for(e=1,n=f.length;n>e;e++){var m,g,y,_,v,b,T,w=f[e],E=w.value;for(t=e-1;t>=0&&(m=f[t]).value>E;)b=w._ID,T=m._ID,T>b?(_=b,v=T):(_=T,v=b),~w.side&m.side?s.checkOverlap(h[b],h[T])&&(g=p[_]=p[_]||{},y=g[v]=l.length?l.pop():c.length,c[y]=[a[_],a[v]]):w.side&~m.side&&(g=p[_])&&null!=g[v]&&(y=g[v],c[y]=null,g[v]=null,l.push(y)),f[t+1]=m,t--;f[t+1]=w}}return c},r.prototype.update=function(){var t=this._boundingVolume;t.update();for(var e=this.points,i=0;3>i;i++){var n=o[i];e[n][0].value=t.vertices[n][0],e[n][1].value=t.vertices[n][1]}},e.exports=n},{"./AABB":55}],60:[function(t,e,i){"use strict";function n(t,e){r.call(this,t,e)}var r=t("./Force"),s=t("../../math/Vec3"),o=new s;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.QUADRATIC=function(t){return t*t},n.LINEAR=function(t){return t},n.prototype.init=function(){this.max=this.max||1/0,this.strength=this.strength||1,this.type=this.type||n.LINEAR},n.prototype.update=function(){for(var t=this.targets,e=this.type,i=o,n=this.max,r=this.strength,a=0,h=t.length;h>a;a++){var u=t[a],c=u.velocity,p=c.length(),l=p?1/p:0,d=-r*e(p);s.scale(c,(-n>d?-n:d)*l,i),u.applyForce(i)}},e.exports=n},{"../../math/Vec3":38,"./Force":61}],61:[function(t,e,i){"use strict";function n(t,e){t?t instanceof Array?this.targets=t:this.targets=[t]:this.targets=[],e=e||{},this.setOptions(e),this._ID=r++}var r=0;n.prototype.setOptions=function(t){for(var e in t)this[e]=t[e];this.init(t)},n.prototype.addTarget=function(t){this.targets.push(t)},n.prototype.removeTarget=function(t){var e=this.targets.indexOf(t);0>e||this.targets.splice(e,1)},n.prototype.init=function(t){},n.prototype.update=function(t,e){},e.exports=n},{}],62:[function(t,e,i){"use strict";function n(t,e){r.call(this,t,e)}var r=t("./Force"),s=t("../../math/Vec3"),o=new s;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.DOWN=0,n.UP=1,n.LEFT=2,n.RIGHT=3,n.FORWARD=4,n.BACKWARD=5,n.prototype.init=function(t){if(this.max=this.max||1/0,t.acceleration)return this.strength=this.acceleration.length(),void(this.direction=-1);var e=this.acceleration=new s,i=this.direction=this.direction||n.DOWN,r=this.strength=this.strength||200;switch(i){case n.DOWN:e.set(0,r,0);break;case n.UP:e.set(0,-1*r,0);break;case n.LEFT:e.set(-1*r,0,0);break;case n.RIGHT:e.set(r,0,0);break;case n.FORWARD:e.set(0,0,-1*r);break;case n.BACKWARD:e.set(0,0,r)}},n.prototype.update=function(){for(var t=this.targets,e=o,i=this.max,n=this.acceleration,r=n.length(),a=r?1/r:0,h=0,u=t.length;u>h;h++){var c=t[h],p=r*c.mass;s.scale(n,(p>i?i:p)*a,e),c.applyForce(e)}},e.exports=n},{"../../math/Vec3":38,"./Force":61}],63:[function(t,e,i){"use strict";function n(t,e,i){this.source=t||null,r.call(this,e,i)}var r=t("./Force"),s=t("../../math/Vec3"),o=new s;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.init=function(){this.max=this.max||1/0,this.strength=this.strength||200},n.prototype.update=function(){for(var t=this.source,e=this.targets,i=o,n=this.strength,r=this.max,a=this.anchor||t.position,h=this.anchor?1:t.mass,u=0,c=e.length;c>u;u++){var p=e[u];s.subtract(a,p.position,i);var l=i.length(),d=l?1/l:0,f=n*h*p.mass*d*d;f=0>f?-r>f?-r:f:f>r?r:f,i.scale(f*d),p.applyForce(i),t&&t.applyForce(i.invert())}},e.exports=n},{"../../math/Vec3":38,"./Force":61}],64:[function(t,e,i){"use strict";function n(t,e){r.call(this,t,e)}var r=t("./Force"),s=t("../../math/Vec3"),o=new s;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.QUADRATIC=function(t){return t.length()},n.LINEAR=function(){return 1},n.prototype.init=function(){this.max=this.max||1/0,this.strength=this.strength||1,this.type=this.type||n.LINEAR},n.prototype.update=function(){for(var t=this.targets,e=this.type,i=o,n=this.max,r=this.strength,a=0,h=t.length;h>a;a++){var u=t[a],c=u.angularVelocity,p=-r*e(c);s.scale(c,-n>p?-n:p,i),u.applyTorque(i)}},e.exports=n},{"../../math/Vec3":38,"./Force":61}],65:[function(t,e,i){"use strict";function n(t,e,i){this.source=t||null,r.call(this,e,i)}var r=t("./Force"),s=t("../../math/Vec3"),o=t("../../math/Mat33"),a=t("../../math/Quaternion"),h=new a,u=new s,c=new s,p=new o,l=Math.PI;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.init=function(t){this.source||(this.anchor=this.anchor?this.anchor.normalize():new a(1,0,0,0)),t.stiffness||t.damping?(this.stiffness=this.stiffness||100,this.damping=this.damping||0,this.period=null,this.dampingRatio=null):(t.period||t.dampingRatio)&&(this.period=this.period||1,this.dampingRatio=this.dampingRatio||0,this.stiffness=2*l/this.period,this.stiffness*=this.stiffness,this.damping=4*l*this.dampingRatio/this.period)},n.prototype.update=function(){for(var t=this.source,e=this.targets,i=h,n=u,r=c,l=p,d=this.max,f=this.stiffness,m=this.damping,g=this.anchor||t.orientation,y=this.anchor?null:t.inverseInertia,_=0,v=e.length;v>_;_++){var b=e[_],T=b.orientation;if(a.conjugate(T,i),i.multiply(g),!(i.w>=1)){var w=Math.acos(i.w),E=Math.sqrt(1-i.w*i.w),I=r.copy(i).scale(2*w/E);I.scale(f),null!==y?o.add(y,b.inverseInertia,l).inverse():o.inverse(b.inverseInertia,l),0!==m&&(t?I.add(s.subtract(b.angularVelocity,t.angularVelocity,n).scale(-m)):I.add(s.scale(b.angularVelocity,-m,n)));var C=I.applyMatrix(l),x=C.length();x>d&&C.scale(d/x),b.applyTorque(C),t&&t.applyTorque(C.invert())}}},e.exports=n},{"../../math/Mat33":35,"../../math/Quaternion":36,"../../math/Vec3":38,"./Force":61}],66:[function(t,e,i){"use strict";function n(t,e,i){this.source=t||null,r.call(this,e,i)}var r=t("./Force"),s=t("../../math/Vec3"),o=new s,a=new s;n.prototype=Object.create(r.prototype),n.prototype.constructor=n;var h=Math.PI;n.FENE=function(t,e){var i=.99*e,n=Math.max(Math.min(t,i),-i);return n/(1-n*n/(e*e))},n.HOOKE=function(t){return t},n.prototype.init=function(t){this.max=this.max||1/0,this.length=this.length||0,this.type=this.type||n.HOOKE,this.maxLength=this.maxLength||1/0,t.stiffness||t.damping?(this.stiffness=this.stiffness||100,this.damping=this.damping||0,this.period=null,this.dampingRatio=null):(t.period||t.dampingRatio)&&(this.period=this.period||1,this.dampingRatio=this.dampingRatio||0,this.stiffness=2*h/this.period,this.stiffness*=this.stiffness,this.damping=4*h*this.dampingRatio/this.period)},n.prototype.update=function(){for(var t=this.source,e=this.targets,i=o,n=a,r=this.max,h=this.stiffness,u=this.damping,c=this.length,p=this.maxLength,l=this.anchor||t.position,d=this.anchor?0:t.inverseMass,f=this.type,m=0,g=e.length;g>m;m++){var y=e[m];s.subtract(l,y.position,i);var _=i.length(),v=_-c;if(!(Math.abs(v)<1e-6)){var b=1/(y.inverseMass+d);null!==this.period&&(h*=b,u*=b),i.scale(h*f(v,p)/v),0!==u&&(t?i.add(s.subtract(y.velocity,t.velocity,n).scale(-u)):i.add(s.scale(y.velocity,-u,n)));var T=i.length(),w=T?1/T:0;s.scale(i,(T>r?r:T)*w,i),y.applyForce(i),t&&t.applyForce(i.invert())}}},e.exports=n},{"../../math/Vec3":38,"./Force":61}],67:[function(t,e,i){"use strict";e.exports={Particle:t("./bodies/Particle"),convexBodyFactory:t("./bodies/convexBodyFactory"),Box:t("./bodies/Box"),Sphere:t("./bodies/Sphere"),Wall:t("./bodies/Wall"),Constraint:t("./constraints/Constraint"),Angle:t("./constraints/Angle"),Collision:t("./constraints/Collision"),Direction:t("./constraints/Direction"),Distance:t("./constraints/Distance"),Curve:t("./constraints/Curve"),Hinge:t("./constraints/Hinge"),BallAndSocket:t("./constraints/BallAndSocket"),Force:t("./forces/Force"),Drag:t("./forces/Drag"),RotationalDrag:t("./forces/RotationalDrag"),Gravity1D:t("./forces/Gravity1D"),Gravity3D:t("./forces/Gravity3D"),Spring:t("./forces/Spring"),RotationalSpring:t("./forces/RotationalSpring"),PhysicsEngine:t("./PhysicsEngine"),Geometry:t("./Geometry")}},{"./Geometry":40,"./PhysicsEngine":41,"./bodies/Box":42,"./bodies/Particle":43,"./bodies/Sphere":44,"./bodies/Wall":45,"./bodies/convexBodyFactory":46,"./constraints/Angle":47,"./constraints/BallAndSocket":48,"./constraints/Collision":49,"./constraints/Constraint":50,"./constraints/Curve":51,"./constraints/Direction":52,"./constraints/Distance":53,"./constraints/Hinge":54,"./forces/Drag":60,"./forces/Force":61,"./forces/Gravity1D":62,"./forces/Gravity3D":63,"./forces/RotationalDrag":64,"./forces/RotationalSpring":65,"./forces/Spring":66}],68:[function(t,e,i){"use strict";var n,r,s=0,o=["ms","moz","webkit","o"];if("object"==typeof window){n=window.requestAnimationFrame,r=window.cancelAnimationFrame||window.cancelRequestAnimationFrame;for(var a=0;a<o.length&&!n;++a)n=window[o[a]+"RequestAnimationFrame"],r=window[o[a]+"CancelRequestAnimationFrame"]||window[o[a]+"CancelAnimationFrame"];n&&!r&&(n=null)}if(!n){var h=Date.now?Date.now:function(){return(new Date).getTime()};n=function(t){var e=h(),i=Math.max(0,16-(e-s)),n=setTimeout(function(){t(e+i)},i);return s=e+i,n},r=function(t){clearTimeout(t)}}var u={requestAnimationFrame:n,cancelAnimationFrame:r};e.exports=u},{}],69:[function(t,e,i){"use strict";e.exports={requestAnimationFrame:t("./animationFrame").requestAnimationFrame,cancelAnimationFrame:t("./animationFrame").cancelAnimationFrame}},{"./animationFrame":68}],70:[function(t,e,i){"use strict";function n(){var t=this;this._updates=[],this._looper=function(e){t.loop(e)},this._time=0,this._stoppedAt=0,this._sleep=0,this._startOnVisibilityChange=!0,this._rAF=null,this._sleepDiff=!0,this.start(),a&&document.addEventListener(u,function(){t._onVisibilityChange()})}var r=t("../polyfills"),s=r.requestAnimationFrame,o=r.cancelAnimationFrame,a="undefined"!=typeof document;if(a){var h,u;"undefined"!=typeof document.hidden?(h="hidden",u="visibilitychange"):"undefined"!=typeof document.mozHidden?(h="mozHidden",u="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(h="msHidden",u="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(h="webkitHidden",u="webkitvisibilitychange")}n.prototype._onVisibilityChange=function(){document[h]?this._onUnfocus():this._onFocus()},n.prototype._onFocus=function(){this._startOnVisibilityChange&&this._start()},n.prototype._onUnfocus=function(){this._stop()},n.prototype.start=function(){return this._running||(this._startOnVisibilityChange=!0,this._start()),this},n.prototype._start=function(){this._running=!0,this._sleepDiff=!0,this._rAF=s(this._looper)},n.prototype.stop=function(){return this._running&&(this._startOnVisibilityChange=!1,this._stop()),this},n.prototype._stop=function(){this._running=!1,this._stoppedAt=this._time,o(this._rAF)},n.prototype.isRunning=function(){return this._running},n.prototype.step=function(t){this._time=t,this._sleepDiff&&(this._sleep+=t-this._stoppedAt,this._sleepDiff=!1);for(var e=t-this._sleep,i=0,n=this._updates.length;n>i;i++)this._updates[i].update(e);return this},n.prototype.loop=function(t){return this.step(t),this._rAF=s(this._looper),this},n.prototype.update=function(t){return-1===this._updates.indexOf(t)&&this._updates.push(t),this},n.prototype.noLongerUpdate=function(t){var e=this._updates.indexOf(t);return e>-1&&this._updates.splice(e,1),this},e.exports=n},{"../polyfills":69}],71:[function(t,e,i){"use strict";function n(){s(),this._contexts={},this._outCommands=[],this._inCommands=[],this._time=null,this._resized=!1;var t=this;window.addEventListener("resize",function(){t.onResize()})}var r=t("./Context"),s=t("./inject-css"),o=t("../core/Commands");n.prototype.onResize=function(){this._resized=!0;for(var t in this._contexts)this._contexts[t].updateSize()},n.prototype.getTime=function(){return this._time},n.prototype.sendEvent=function(t,e,i){this._outCommands.push(o.WITH,t,o.TRIGGER,e,i)},n.prototype.sendResize=function(t,e){this.sendEvent(t,"CONTEXT_RESIZE",e)},n.prototype.handleWith=function(t,e){var i=e[t],n=i.split("/"),r=this.getOrSetContext(n.shift());return r.receive(i,e,t)},n.prototype.getOrSetContext=function(t){if(this._contexts[t])return this._contexts[t];var e=new r(t,this);return this._contexts[t]=e,e},n.prototype.getContext=function(t){return this._contexts[t]?this._contexts[t]:void 0},n.prototype.drawCommands=function(){for(var t=this._inCommands,e=0,i=t[e];i;){switch(i){case o.TIME:this._time=t[++e];break;case o.WITH:e=this.handleWith(++e,t);break;case o.NEED_SIZE_FOR:this.giveSizeFor(++e,t)}i=t[++e]}for(var n in this._contexts)this._contexts[n].draw();return this._resized&&this.updateSize(),this._outCommands},n.prototype.updateSize=function(){for(var t in this._contexts)this._contexts[t].updateSize()},n.prototype.receiveCommands=function(t){for(var e=t.length,i=0;e>i;i++)this._inCommands.push(t[i]);for(var n in this._contexts)this._contexts[n].checkInit()},n.prototype.giveSizeFor=function(t,e){var i=e[t],n=this.getContext(i);if(n){var r=n.getRootSize();this.sendResize(i,r)}else this.getOrSetContext(i)},n.prototype.clearCommands=function(){this._inCommands.length=0,this._outCommands.length=0,this._resized=!1},e.exports=n},{"../core/Commands":8,"./Context":72,"./inject-css":74}],72:[function(t,e,i){"use strict";function n(t,e){if(this._compositor=e,this._rootEl=document.querySelector(t),this._selector=t,null===this._rootEl)throw new Error('Failed to create Context: No matches for "'+t+'" found.');this._selector=t,this._initDOMRenderer(),this._webGLRenderer=null,this._domRenderer=new L(this._domRendererRootEl,t,e),this._canvasEl=null,this._renderState={projectionType:D.ORTHOGRAPHIC_PROJECTION,perspectiveTransform:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewTransform:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewDirty:!1,perspectiveDirty:!1},this._size=[],this._meshTransform=new Float32Array(16),this._meshSize=[0,0,0],this._initDOM=!1,this._commandCallbacks=[],this.initCommandCallbacks(),this.updateSize()}function r(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.preventDefault(i[++n]),n}function s(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.allowDefault(i[++n]),n}function o(t,e,i,n){return t._initDOM=!0,n}function a(t,e,i,n){return t._domRenderer.insertEl(i[++n]),n}function h(t,e,i,n){return t._domRenderer.getSizeOf(i[++n]),n}function u(t,e,i,n){var r=t._meshTransform;return r[0]=i[++n],r[1]=i[++n],r[2]=i[++n],r[3]=i[++n],r[4]=i[++n],r[5]=i[++n],r[6]=i[++n],r[7]=i[++n],r[8]=i[++n],r[9]=i[++n],r[10]=i[++n],r[11]=i[++n],r[12]=i[++n],r[13]=i[++n],r[14]=i[++n],r[15]=i[++n],t._domRenderer.setMatrix(r),t._webGLRenderer&&t._webGLRenderer.setCutoutUniform(e,"u_transform",r),n}function c(t,e,i,n){var r=i[++n],s=i[++n];return t._domRenderer.setSize(r,s),t._webGLRenderer&&(t._meshSize[0]=r,t._meshSize[1]=s,t._webGLRenderer.setCutoutUniform(e,"u_size",t._meshSize)),n}function p(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.setProperty(i[++n],i[++n]),n}function l(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.setContent(i[++n]),n}function d(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.setAttribute(i[++n],i[++n]),n}function f(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.addClass(i[++n]),n}function m(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.removeClass(i[++n]),n}function g(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.subscribe(i[++n]),n}function y(t,e,i,n){return t._webGLRenderer&&t._webGLRenderer.getOrSetCutout(e),t._domRenderer.unsubscribe(i[++n]),n}function _(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setMeshOptions(e,i[++n]),n}function v(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setAmbientLightColor(e,i[++n],i[++n],i[++n]),n}function b(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setLightPosition(e,i[++n],i[++n],i[++n]),n}function T(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setLightColor(e,i[++n],i[++n],i[++n]),n}function w(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.handleMaterialInput(e,i[++n],i[++n]),n}function E(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setGeometry(e,i[++n],i[++n],i[++n]),n}function I(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setMeshUniform(e,i[++n],i[++n]),n}function C(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.bufferData(i[++n],i[++n],i[++n],i[++n],i[++n]),n}function x(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setCutoutState(e,i[++n]),n}function R(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.setMeshVisibility(e,i[++n]),n}function A(t,e,i,n){return t._webGLRenderer||t._initWebGLRenderer(),t._webGLRenderer.removeMesh(e),n}function S(t,e,i,n){return t._renderState.projectionType=D.PINHOLE_PROJECTION,t._renderState.perspectiveTransform[11]=-1/i[++n],t._renderState.perspectiveDirty=!0,n}function O(t,e,i,n){return t._renderState.projectionType=D.ORTHOGRAPHIC_PROJECTION,t._renderState.perspectiveTransform[11]=0,t._renderState.perspectiveDirty=!0,n}function M(t,e,i,n){return t._renderState.viewTransform[0]=i[++n],t._renderState.viewTransform[1]=i[++n],t._renderState.viewTransform[2]=i[++n],t._renderState.viewTransform[3]=i[++n],t._renderState.viewTransform[4]=i[++n],t._renderState.viewTransform[5]=i[++n],t._renderState.viewTransform[6]=i[++n],t._renderState.viewTransform[7]=i[++n],t._renderState.viewTransform[8]=i[++n],t._renderState.viewTransform[9]=i[++n],t._renderState.viewTransform[10]=i[++n],t._renderState.viewTransform[11]=i[++n],t._renderState.viewTransform[12]=i[++n],t._renderState.viewTransform[13]=i[++n],t._renderState.viewTransform[14]=i[++n],t._renderState.viewTransform[15]=i[++n],t._renderState.viewDirty=!0,n}var N=t("../webgl-renderers/WebGLRenderer"),D=t("../components/Camera"),L=t("../dom-renderers/DOMRenderer"),z=t("../core/Commands");n.prototype.updateSize=function(){var t=this._rootEl.offsetWidth,e=this._rootEl.offsetHeight;return this._size[0]=t,this._size[1]=e,this._size[2]=t>e?t:e,this._compositor.sendResize(this._selector,this._size),this._webGLRenderer&&this._webGLRenderer.updateSize(this._size),this},n.prototype.draw=function(){this._domRenderer.draw(this._renderState),this._webGLRenderer&&this._webGLRenderer.draw(this._renderState),this._renderState.perspectiveDirty&&(this._renderState.perspectiveDirty=!1),this._renderState.viewDirty&&(this._renderState.viewDirty=!1)},n.prototype._initDOMRenderer=function(){this._domRendererRootEl=document.createElement("div"),this._rootEl.appendChild(this._domRendererRootEl),this._domRendererRootEl.style.visibility="hidden",this._domRenderer=new L(this._domRendererRootEl,this._selector,this._compositor)},n.prototype.initCommandCallbacks=function(){this._commandCallbacks[z.INIT_DOM]=a,this._commandCallbacks[z.DOM_RENDER_SIZE]=h,this._commandCallbacks[z.CHANGE_TRANSFORM]=u,this._commandCallbacks[z.CHANGE_SIZE]=c,this._commandCallbacks[z.CHANGE_PROPERTY]=p,this._commandCallbacks[z.CHANGE_CONTENT]=l,this._commandCallbacks[z.CHANGE_ATTRIBUTE]=d,this._commandCallbacks[z.ADD_CLASS]=f,this._commandCallbacks[z.REMOVE_CLASS]=m,this._commandCallbacks[z.SUBSCRIBE]=g,this._commandCallbacks[z.UNSUBSCRIBE]=y,this._commandCallbacks[z.GL_SET_DRAW_OPTIONS]=_,this._commandCallbacks[z.GL_AMBIENT_LIGHT]=v,this._commandCallbacks[z.GL_LIGHT_POSITION]=b,this._commandCallbacks[z.GL_LIGHT_COLOR]=T,this._commandCallbacks[z.MATERIAL_INPUT]=w,this._commandCallbacks[z.GL_SET_GEOMETRY]=E,this._commandCallbacks[z.GL_UNIFORMS]=I,this._commandCallbacks[z.GL_BUFFER_DATA]=C,this._commandCallbacks[z.GL_CUTOUT_STATE]=x,this._commandCallbacks[z.GL_MESH_VISIBILITY]=R,this._commandCallbacks[z.GL_REMOVE_MESH]=A,this._commandCallbacks[z.PINHOLE_PROJECTION]=S,this._commandCallbacks[z.ORTHOGRAPHIC_PROJECTION]=O,this._commandCallbacks[z.CHANGE_VIEW_TRANSFORM]=M,this._commandCallbacks[z.PREVENT_DEFAULT]=r,this._commandCallbacks[z.ALLOW_DEFAULT]=s,this._commandCallbacks[z.READY]=o},n.prototype._initWebGLRenderer=function(){this._webGLRendererRootEl=document.createElement("canvas"),this._rootEl.appendChild(this._webGLRendererRootEl),this._webGLRenderer=new N(this._webGLRendererRootEl,this._compositor),this._webGLRenderer.updateSize(this._size)},n.prototype.getRootSize=function(){return[this._rootEl.offsetWidth,this._rootEl.offsetHeight]},n.prototype.checkInit=function(){this._initDOM&&(this._domRendererRootEl.style.visibility="visible",this._initDOM=!1)},n.prototype.receive=function(t,e,i){var n=i,r=e[++n];for(this._domRenderer.loadPath(t);null!=r;){if(r===z.WITH||r===z.TIME)return n-1;n=this._commandCallbacks[r](this,t,e,n)+1,r=e[n]}return n},n.prototype.getDOMRenderer=function(){return this._domRenderer},n.prototype.getWebGLRenderer=function(){return this._webGLRenderer},e.exports=n},{"../components/Camera":2,"../core/Commands":8,"../dom-renderers/DOMRenderer":21,"../webgl-renderers/WebGLRenderer":89}],73:[function(t,e,i){"use strict";function n(t,e,i){this._thread=t,this._compositor=e,this._renderLoop=i,this._renderLoop.update(this);var n=this;this._thread.onmessage=function(t){var e=t.data?t.data:t;if(e[0]===r.ENGINE)switch(e[1]){case r.START:n._engine.start();break;case r.STOP:n._engine.stop();break;default:console.error('Unknown ENGINE command "'+e[1]+'"')}else n._compositor.receiveCommands(e)},this._thread.onerror=function(t){console.error(t)}}var r=t("../core/Commands");n.prototype.getThread=function(){return this._thread},n.prototype.getCompositor=function(){return this._compositor},n.prototype.getEngine=function(){return this._renderLoop},n.prototype.getRenderLoop=function(){return this._renderLoop},n.prototype.update=function(t){this._thread.postMessage([r.FRAME,t]);var e=this._compositor.drawCommands();this._thread.postMessage(e),this._compositor.clearCommands()},e.exports=n},{"../core/Commands":8}],74:[function(t,e,i){"use strict";function n(){if(!s)if(s=!0,document.createStyleSheet){var t=document.createStyleSheet();t.cssText=r}else{var e=document.getElementsByTagName("head")[0],i=document.createElement("style");i.styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r)),(e?e:document.documentElement).appendChild(i)}}var r=".famous-dom-renderer {width:100%;height:100%;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;}.famous-dom-element {-webkit-transform-origin:0% 0%;transform-origin:0% 0%;-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-tap-highlight-color:transparent;pointer-events:auto;z-index:1;}.famous-dom-element-content,.famous-dom-element {position:absolute;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}.famous-webgl-renderer {-webkit-transform:translateZ(1000000px);transform:translateZ(1000000px);pointer-events:none;position:absolute;z-index:1;top:0;width:100%;height:100%;}",s="undefined"==typeof document;e.exports=n},{}],75:[function(t,e,i){"use strict";var n={linear:function(t){return t},easeIn:function(t){return t*t},easeOut:function(t){return t*(2-t)},easeInOut:function(t){return.5>=t?2*t*t:-2*t*t+4*t-1},easeOutBounce:function(t){return t*(3-2*t)},spring:function(t){return(1-t)*Math.sin(6*Math.PI*t)+t},inQuad:function(t){return t*t},outQuad:function(t){return-(t-=1)*t+1},inOutQuad:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},inCubic:function(t){return t*t*t},outCubic:function(t){return--t*t*t+1},inOutCubic:function(t){return(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},inQuart:function(t){return t*t*t*t},outQuart:function(t){return-(--t*t*t*t-1)},inOutQuart:function(t){return(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},inQuint:function(t){return t*t*t*t*t},outQuint:function(t){return--t*t*t*t*t+1},inOutQuint:function(t){return(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},inSine:function(t){return-1*Math.cos(t*(Math.PI/2))+1},outSine:function(t){return Math.sin(t*(Math.PI/2))},inOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},inExpo:function(t){return 0===t?0:Math.pow(2,10*(t-1))},outExpo:function(t){return 1===t?1:-Math.pow(2,-10*t)+1},inOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*--t)+2)},inCirc:function(t){return-(Math.sqrt(1-t*t)-1)},outCirc:function(t){return Math.sqrt(1- --t*t)},inOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},inElastic:function(t){var e=1.70158,i=0,n=1;return 0===t?0:1===t?1:(i||(i=.3),e=i/(2*Math.PI)*Math.asin(1/n),-(n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)))},outElastic:function(t){var e=1.70158,i=0,n=1;return 0===t?0:1===t?1:(i||(i=.3),e=i/(2*Math.PI)*Math.asin(1/n),n*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/i)+1)},inOutElastic:function(t){var e=1.70158,i=0,n=1;return 0===t?0:2===(t/=.5)?1:(i||(i=.3*1.5),e=i/(2*Math.PI)*Math.asin(1/n),1>t?-.5*(n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)):n*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/i)*.5+1)},inBack:function(t,e){return void 0===e&&(e=1.70158),t*t*((e+1)*t-e)},outBack:function(t,e){return void 0===e&&(e=1.70158),--t*t*((e+1)*t+e)+1},inOutBack:function(t,e){return void 0===e&&(e=1.70158),(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},inBounce:function(t){return 1-n.outBounce(1-t)},outBounce:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},inOutBounce:function(t){return.5>t?.5*n.inBounce(2*t):.5*n.outBounce(2*t-1)+.5},flat:function(){return 0}};e.exports=n},{}],76:[function(t,e,i){"use strict";function n(t){this._queue=[],this._from=null,this._state=null,this._startedAt=null,this._pausedAt=null,null!=t&&this.from(t)}var r=t("./Curves"),s=t("../core/FamousEngine");n.Clock=s.getClock(),n.prototype.to=function(t,e,i,n,s){return e=null!=e&&e.constructor===String?r[e]:e,0===this._queue.length&&(this._startedAt=this.constructor.Clock.now(),this._pausedAt=null),this._queue.push(t,null!=e?e:r.linear,null!=i?i:100,n,s),this},n.prototype.from=function(t){
return this._state=t,this._from=this._sync(null,this._state),this._queue.length=0,this._startedAt=this.constructor.Clock.now(),this._pausedAt=null,this},n.prototype.delay=function(t,e){var i=this._queue.length>0?this._queue[this._queue.length-5]:this._state;return this.to(i,r.flat,t,e)},n.prototype.override=function(t,e,i,n,s){return this._queue.length>0&&(null!=t&&(this._queue[0]=t),null!=e&&(this._queue[1]=e.constructor===String?r[e]:e),null!=i&&(this._queue[2]=i),null!=n&&(this._queue[3]=n),null!=s&&(this._queue[4]=s)),this},n.prototype._interpolate=function(t,e,i,n,r){if(i instanceof Object)if("slerp"===r){var s,o,a,h,u,c,p,l,d,f,m,g,y;if(s=e[0],o=e[1],a=e[2],h=e[3],u=i[0],c=i[1],p=i[2],l=i[3],1===n)return t[0]=u,t[1]=c,t[2]=p,t[3]=l,t;f=h*l+s*u+o*c+a*p,1-f>1e-5?(d=Math.acos(f),m=Math.sin(d),g=Math.sin((1-n)*d)/m,y=Math.sin(n*d)/m):(g=1-n,y=n),t[0]=s*g+u*y,t[1]=o*g+c*y,t[2]=a*g+p*y,t[3]=h*g+l*y}else if(i instanceof Array)for(var _=0,v=i.length;v>_;_++)t[_]=this._interpolate(t[_],e[_],i[_],n,r);else for(var b in i)t[b]=this._interpolate(t[b],e[b],i[b],n,r);else t=e+n*(i-e);return t},n.prototype._sync=function t(e,i){if("number"==typeof i)e=i;else if(i instanceof Array){null==e&&(e=[]);for(var n=0,r=i.length;r>n;n++)e[n]=t(e[n],i[n])}else if(i instanceof Object){null==e&&(e={});for(var s in i)e[s]=t(e[s],i[s])}return e},n.prototype.get=function(t){if(0===this._queue.length)return this._state;t=this._pausedAt?this._pausedAt:t,t=t?t:this.constructor.Clock.now();var e=(t-this._startedAt)/this._queue[2];this._state=this._interpolate(this._state,this._from,this._queue[0],this._queue[1](e>1?1:e),this._queue[4]);var i=this._state;if(e>=1){this._startedAt=this._startedAt+this._queue[2],this._from=this._sync(this._from,this._state),this._queue.shift(),this._queue.shift(),this._queue.shift();var n=this._queue.shift();this._queue.shift(),n&&n()}return e>1?this.get():i},n.prototype.isActive=function(){return this._queue.length>0},n.prototype.halt=function(){return this.from(this.get())},n.prototype.pause=function(){return this._pausedAt=this.constructor.Clock.now(),this},n.prototype.isPaused=function(){return!!this._pausedAt},n.prototype.resume=function(){var t=this._pausedAt-this._startedAt;return this._startedAt=this.constructor.Clock.now()-t,this._pausedAt=null,this},n.prototype.reset=function(t){return this.from(t)},n.prototype.set=function(t,e,i){return null==e?(this.from(t),i&&i()):this.to(t,e.curve,e.duration,i,e.method),this},e.exports=n},{"../core/FamousEngine":11,"./Curves":75}],77:[function(t,e,i){"use strict";function n(){this._events={}}n.prototype.on=function(t,e){this._events[t]||(this._events[t]=[]);var i=this._events[t];return i.push(e),function(){i.splice(i.indexOf(e),1)}},n.prototype.off=function(t,e){var i=this._events[t];return i&&i.splice(i.indexOf(e),1),this},n.prototype.trigger=function(t,e){var i=this._events[t];if(i)for(var n=0,r=i.length;r>n;n++)i[n](e);return this},e.exports=n},{}],78:[function(t,e,i){"use strict";function n(t,e){return function(){return 0!==t.length?t.pop():new e}}function r(t){return function(e){t.push(e)}}var s={};s.pools={},s.register=function(t,e){var i=this.pools[t]=[];this["request"+t]=n(i,e),this["free"+t]=r(i)},s.disposeOf=function(t){for(var e=this.pools[t],i=e.length;i--;)e.pop()},e.exports=s},{}],79:[function(t,e,i){"use strict";function n(){this._keyToValue={},this._values=[],this._keys=[],this._keyToIndex={},this._freedIndices=[]}n.prototype.register=function(t,e){var i=this._keyToIndex[t];null==i?(i=this._freedIndices.pop(),void 0===i&&(i=this._values.length),this._values[i]=e,this._keys[i]=t,this._keyToIndex[t]=i,this._keyToValue[t]=e):(this._keyToValue[t]=e,this._values[i]=e)},n.prototype.unregister=function(t){var e=this._keyToIndex[t];null!=e&&(this._freedIndices.push(e),this._keyToValue[t]=null,this._keyToIndex[t]=null,this._values[e]=null,this._keys[e]=null)},n.prototype.get=function(t){return this._keyToValue[t]},n.prototype.getValues=function(){return this._values},n.prototype.getKeys=function(){return this._keys},n.prototype.getKeyToValue=function(){return this._keyToValue},e.exports=n},{}],80:[function(t,e,i){"use strict";var n=function t(e){var i;if("object"==typeof e){i=e instanceof Array?[]:{};for(var n in e)if("object"==typeof e[n]&&null!==e[n])if(e[n]instanceof Array){i[n]=new Array(e[n].length);for(var r=0;r<e[n].length;r++)i[n][r]=t(e[n][r])}else i[n]=t(e[n]);else i[n]=e[n]}else i=e;return i};e.exports=n},{}],81:[function(t,e,i){"use strict";e.exports=function(t){var e=[],i=[],n=0;for(var r in t)t.hasOwnProperty(r)&&(e[n]=r,i[n]=t[r],n++);return{keys:e,values:i}}},{}],82:[function(t,e,i){"use strict";function n(t){for(var e=0;e<r.length;e++){var i=r[e]+t;if(""===document.documentElement.style[i])return i}return t}var r=["","-ms-","-webkit-","-moz-","-o-"];e.exports=n},{}],83:[function(t,e,i){"use strict";function n(t,e,i){this.buffer=null,this.target=t,this.type=e,this.data=[],this.gl=i}n.prototype.subData=function(){for(var t=this.gl,e=[],i=0,n=1e4;i<this.data.length;i+=n)e=Array.prototype.concat.apply(e,this.data.slice(i,i+n));this.buffer=this.buffer||t.createBuffer(),t.bindBuffer(this.target,this.buffer),t.bufferData(this.target,new this.type(e),t.STATIC_DRAW)},e.exports=n},{}],84:[function(t,e,i){"use strict";function n(t){this.gl=t,this.registry={},this._dynamicBuffers=[],this._staticBuffers=[],this._arrayBufferMax=3e4,this._elementBufferMax=3e4}var r="indices",s=t("./Buffer");n.prototype.allocate=function(t,e,i,n,o){var a,h,u,c,p=this.registry[t]||(this.registry[t]={keys:[],values:[],spacing:[],offset:[],length:[]}),l=p.keys.indexOf(e),d=e===r,f=!1,m=0;if(-1===l){if(l=p.keys.length,h=d?i.length:Math.floor(i.length/n),o)u=new s(d?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,d?Uint16Array:Float32Array,this.gl),this._dynamicBuffers.push({buffer:u,offset:i.length,isIndex:d});else{for(c=0;c<this._staticBuffers.length;c++)if(d===this._staticBuffers[c].isIndex&&(a=this._staticBuffers[c].offset+i.length,!d&&a<this._arrayBufferMax||d&&a<this._elementBufferMax)){u=this._staticBuffers[c].buffer,m=this._staticBuffers[c].offset,this._staticBuffers[c].offset+=i.length,f=!0;break}f||(u=new s(d?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,d?Uint16Array:Float32Array,this.gl),this._staticBuffers.push({buffer:u,offset:i.length,isIndex:d}))}p.keys.push(e),p.values.push(u),p.spacing.push(n),p.offset.push(m),p.length.push(h)}var g=i.length;for(c=0;g>c;c++)p.values[l].data[m+c]=i[c];p.values[l].subData()},e.exports=n},{"./Buffer":83}],85:[function(t,e,i){"use strict";function n(){return r(this.gl.compileShader,function(t){if(!this.getShaderParameter(t,this.COMPILE_STATUS)){var e=this.getShaderInfoLog(t),i=this.getShaderSource(t);s(e,i)}})}function r(t,e){return function(){var i=t.apply(this,arguments);return e.apply(this,arguments),i}}function s(t,e){var i="body,html{background:#e3e3e3;font-family:monaco,monospace;font-size:14px;line-height:1.7em}#shaderReport{left:0;top:0;right:0;box-sizing:border-box;position:absolute;z-index:1000;color:#222;padding:15px;white-space:normal;list-style-type:none;margin:50px auto;max-width:1200px}#shaderReport li{background-color:#fff;margin:13px 0;box-shadow:0 1px 2px rgba(0,0,0,.15);padding:20px 30px;border-radius:2px;border-left:20px solid #e01111}span{color:#e01111;text-decoration:underline;font-weight:700}#shaderReport li p{padding:0;margin:0}#shaderReport li:nth-child(even){background-color:#f4f4f4}#shaderReport li p:first-child{margin-bottom:10px;color:#666}",n=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(n),n.textContent=i;var r=document.createElement("ul");r.setAttribute("id","shaderReport"),document.body.appendChild(r);for(var s,o=/ERROR: [\d]+:([\d]+): (.+)/gim,a=e.split("\n");null!=(s=o.exec(t));){s.index===o.lastIndex&&o.lastIndex++;var h=document.createElement("li"),u='<p><span>ERROR</span> "'+s[2]+'" in line '+s[1]+"</p>";u+="<p><b>"+a[s[1]-1].replace(/^[ \t]+/g,"")+"</b></p>",h.innerHTML=u,r.appendChild(h)}}e.exports=n},{}],86:[function(t,e,i){"use strict";function n(t,e){this.gl=t,this.options=e||{},this.registeredMaterials={},this.cachedUniforms={},this.uniformTypes=[],this.definitionVec4=[],this.definitionVec3=[],this.definitionFloat=[],this.applicationVec3=[],this.applicationVec4=[],this.applicationFloat=[],this.applicationVert=[],this.definitionVert=[],this.options.debug&&(this.gl.compileShader=h.call(this)),this.resetProgram()}var r=t("../utilities/clone"),s=t("../utilities/keyValueToArrays"),o=t("../webgl-shaders").vertex,a=t("../webgl-shaders").fragment,h=t("./Debug"),u=35633,c=35632,p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l="precision mediump float;\n",d={undefined:"float ",1:"float ",2:"vec2 ",3:"vec3 ",4:"vec4 ",16:"mat4 "},f={u_baseColor:"vec4",u_normals:"vert",u_glossiness:"vec4",u_positionOffset:"vert"},m={vert:1,vec3:2,vec4:4,float:8},g=s({u_perspective:p,u_view:p,u_resolution:[0,0,0],u_transform:p,u_size:[1,1,1],u_time:0,u_opacity:1,u_metalness:0,u_glossiness:[0,0,0,0],u_baseColor:[1,1,1,1],u_normals:[1,1,1],u_positionOffset:[0,0,0],u_lightPosition:p,u_lightColor:p,u_ambientLight:[0,0,0],u_flatShading:0,u_numLights:0}),y=s({a_pos:[0,0,0],a_texCoord:[0,0],a_normals:[0,0,0]}),_=s({v_textureCoordinate:[0,0],v_normal:[0,0,0],v_position:[0,0,0],v_eyeVector:[0,0,0]});n.prototype.registerMaterial=function(t,e){var i=e,n=f[t],r=m[n];if((this.registeredMaterials[e._id]&r)===r)return this;var s;for(s in i.uniforms)-1===g.keys.indexOf(s)&&(g.keys.push(s),g.values.push(i.uniforms[s]));for(s in i.varyings)-1===_.keys.indexOf(s)&&(_.keys.push(s),_.values.push(i.varyings[s]));for(s in i.attributes)-1===y.keys.indexOf(s)&&(y.keys.push(s),y.values.push(i.attributes[s]));return this.registeredMaterials[e._id]|=r,"float"===n&&(this.definitionFloat.push(e.defines),this.definitionFloat.push("float fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationFloat.push("if (int(abs(ID)) == "+e._id+") return fa_"+e._id+"();")),"vec3"===n&&(this.definitionVec3.push(e.defines),this.definitionVec3.push("vec3 fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationVec3.push("if (int(abs(ID.x)) == "+e._id+") return fa_"+e._id+"();")),"vec4"===n&&(this.definitionVec4.push(e.defines),this.definitionVec4.push("vec4 fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationVec4.push("if (int(abs(ID.x)) == "+e._id+") return fa_"+e._id+"();")),"vert"===n&&(this.definitionVert.push(e.defines),this.definitionVert.push("vec3 fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationVert.push("if (int(abs(ID.x)) == "+e._id+") return fa_"+e._id+"();")),this.resetProgram()},n.prototype.resetProgram=function(){var t,e,i,n,s,h,p=[l],f=[l];for(this.uniformLocations=[],this.attributeLocations={},this.uniformTypes={},this.attributeNames=r(y.keys),this.attributeValues=r(y.values),this.varyingNames=r(_.keys),this.varyingValues=r(_.values),this.uniformNames=r(g.keys),this.uniformValues=r(g.values),this.cachedUniforms={},f.push("uniform sampler2D u_textures[7];\n"),this.applicationVert.length&&p.push("uniform sampler2D u_textures[7];\n"),h=0;h<this.uniformNames.length;h++)n=this.uniformNames[h],s=this.uniformValues[h],p.push("uniform "+d[s.length]+n+";\n"),f.push("uniform "+d[s.length]+n+";\n");for(h=0;h<this.attributeNames.length;h++)n=this.attributeNames[h],s=this.attributeValues[h],p.push("attribute "+d[s.length]+n+";\n");for(h=0;h<this.varyingNames.length;h++)n=this.varyingNames[h],s=this.varyingValues[h],p.push("varying "+d[s.length]+n+";\n"),f.push("varying "+d[s.length]+n+";\n");e=p.join("")+o.replace("#vert_definitions",this.definitionVert.join("\n")).replace("#vert_applications",this.applicationVert.join("\n")),t=f.join("")+a.replace("#vec3_definitions",this.definitionVec3.join("\n")).replace("#vec3_applications",this.applicationVec3.join("\n")).replace("#vec4_definitions",this.definitionVec4.join("\n")).replace("#vec4_applications",this.applicationVec4.join("\n")).replace("#float_definitions",this.definitionFloat.join("\n")).replace("#float_applications",this.applicationFloat.join("\n")),i=this.gl.createProgram(),this.gl.attachShader(i,this.compileShader(this.gl.createShader(u),e)),this.gl.attachShader(i,this.compileShader(this.gl.createShader(c),t)),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.program=i,this.gl.useProgram(this.program)):(console.error("link error: "+this.gl.getProgramInfoLog(i)),this.program=null),this.setUniforms(this.uniformNames,this.uniformValues);var m=this.gl.getUniformLocation(this.program,"u_textures[0]");return this.gl.uniform1iv(m,[0,1,2,3,4,5,6]),this},n.prototype.uniformIsCached=function(t,e){if(null==this.cachedUniforms[t])return e.length?this.cachedUniforms[t]=new Float32Array(e):this.cachedUniforms[t]=e,!1;if(e.length){for(var i=e.length;i--;)if(e[i]!==this.cachedUniforms[t][i]){for(i=e.length;i--;)this.cachedUniforms[t][i]=e[i];return!1}}else if(this.cachedUniforms[t]!==e)return this.cachedUniforms[t]=e,!1;return!0},n.prototype.setUniforms=function(t,e){var i,n,r,s,o,a=this.gl;if(!this.program)return this;for(s=t.length,o=0;s>o;o++)if(r=t[o],n=e[o],i=this.uniformLocations[r],null!==i&&(void 0===i&&(i=a.getUniformLocation(this.program,r),this.uniformLocations[r]=i),!this.uniformIsCached(r,n)))switch(this.uniformTypes[r]||(this.uniformTypes[r]=this.getUniformTypeFromValue(n)),this.uniformTypes[r]){case"uniform4fv":a.uniform4fv(i,n);break;case"uniform3fv":a.uniform3fv(i,n);break;case"uniform2fv":a.uniform2fv(i,n);break;case"uniform1fv":a.uniform1fv(i,n);break;case"uniform1f":a.uniform1f(i,n);break;case"uniformMatrix3fv":a.uniformMatrix3fv(i,!1,n);break;case"uniformMatrix4fv":a.uniformMatrix4fv(i,!1,n)}return this},n.prototype.getUniformTypeFromValue=function(t){if(Array.isArray(t)||t instanceof Float32Array)switch(t.length){case 1:return"uniform1fv";case 2:return"uniform2fv";case 3:return"uniform3fv";case 4:return"uniform4fv";case 9:return"uniformMatrix3fv";case 16:return"uniformMatrix4fv"}else if(!isNaN(parseFloat(t))&&isFinite(t))return"uniform1f";throw'cant load uniform "'+name+'" with value:'+JSON.stringify(t)},n.prototype.compileShader=function(t,e){var i=1;return this.gl.shaderSource(t,e),this.gl.compileShader(t),this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS)||(console.error("compile error: "+this.gl.getShaderInfoLog(t)),console.error("1: "+e.replace(/\n/g,function(){return"\n"+(i+=1)+": "}))),t},e.exports=n},{"../utilities/clone":80,"../utilities/keyValueToArrays":81,"../webgl-shaders":93,"./Debug":85}],87:[function(t,e,i){"use strict";function n(t,e){e=e||{},this.id=t.createTexture(),this.width=e.width||0,this.height=e.height||0,this.mipmap=e.mipmap,this.format=e.format||"RGBA",this.type=e.type||"UNSIGNED_BYTE",this.gl=t,this.bind(),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipYWebgl||!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlphaWebgl||!1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[e.magFilter]||t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[e.minFilter]||t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t[e.wrapS]||t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t[e.wrapT]||t.CLAMP_TO_EDGE)}n.prototype.bind=function(){return this.gl.bindTexture(this.gl.TEXTURE_2D,this.id),this},n.prototype.unbind=function(){return this.gl.bindTexture(this.gl.TEXTURE_2D,null),this},n.prototype.setImage=function(t){return this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.format],this.gl[this.format],this.gl[this.type],t),this.mipmap&&this.gl.generateMipmap(this.gl.TEXTURE_2D),this},n.prototype.setArray=function(t){return this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.format],this.width,this.height,0,this.gl[this.format],this.gl[this.type],t),this},n.prototype.readBack=function(t,e,i,n){var r,s=this.gl;t=t||0,e=e||0,i=i||this.width,n=n||this.height;var o=s.createFramebuffer();return s.bindFramebuffer(s.FRAMEBUFFER,o),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.id,0),s.checkFramebufferStatus(s.FRAMEBUFFER)===s.FRAMEBUFFER_COMPLETE&&(r=new Uint8Array(i*n*4),s.readPixels(t,e,i,n,s.RGBA,s.UNSIGNED_BYTE,r)),r},e.exports=n},{}],88:[function(t,e,i){"use strict";function n(t){this.registry=[],this._needsResample=[],this._activeTexture=0,this._boundTexture=null,this._checkerboard=o(),this.gl=t}function r(t,e){var i=("string"==typeof t?new Image:t)||{};return i.crossOrigin="anonymous",i.src||(i.src=t),i.complete?e(i):i.onload=function(){e(i)},i}var s=t("./Texture"),o=t("./createCheckerboard");n.prototype.update=function(t){for(var e=this.registry.length,i=1;e>i;i++){var n=this.registry[i];n&&n.isLoaded&&n.resampleRate&&(!n.lastResample||t-n.lastResample>n.resampleRate)&&(this._needsResample[n.id]||(this._needsResample[n.id]=!0,n.lastResample=t))}},n.prototype.register=function(t,e){var i,n=this,o=t.data,a=t.id,h=t.options||{},u=this.registry[a];return u||(u=new s(this.gl,h),u.setImage(this._checkerboard),i=this.registry[a]={resampleRate:h.resampleRate||null,lastResample:null,isLoaded:!1,texture:u,source:o,id:a,slot:e},Array.isArray(o)||o instanceof Uint8Array||o instanceof Float32Array?(this.bindTexture(a),u.setArray(o),i.isLoaded=!0):o instanceof HTMLVideoElement?o.addEventListener("loadeddata",function(){n.bindTexture(a),u.setImage(o),i.isLoaded=!0,i.source=o}):"string"==typeof o&&r(o,function(t){n.bindTexture(a),u.setImage(t),i.isLoaded=!0,i.source=t})),a},n.prototype.bindTexture=function(t){var e=this.registry[t];this._activeTexture!==e.slot&&(this.gl.activeTexture(this.gl.TEXTURE0+e.slot),this._activeTexture=e.slot),this._boundTexture!==t&&(this._boundTexture=t,e.texture.bind()),this._needsResample[e.id]&&(e.texture.setImage(e.source),this._needsResample[e.id]=!1)},e.exports=n},{"./Texture":87,"./createCheckerboard":91}],89:[function(t,e,i){"use strict";function n(t,e){t.classList.add("famous-webgl-renderer"),this.canvas=t,this.compositor=e;var i=this.gl=this.getWebGLContext(this.canvas);i.clearColor(0,0,0,0),i.polygonOffset(.1,.1),i.enable(i.POLYGON_OFFSET_FILL),i.enable(i.DEPTH_TEST),i.enable(i.BLEND),i.depthFunc(i.LEQUAL),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.enable(i.CULL_FACE),i.cullFace(i.BACK),this.meshRegistry=new c,this.cutoutRegistry=new c,this.lightRegistry=new c,this.numLights=0,this.ambientLightColor=[0,0,0],this.lightPositions=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.lightColors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.textureManager=new h(i),this.bufferRegistry=new s(i),this.program=new r(i,{debug:!0}),this.state={boundArrayBuffer:null,boundElementBuffer:null,lastDrawn:null,enabledAttributes:{},enabledAttributesKeys:[]},this.resolutionName=["u_resolution"],this.resolutionValues=[[0,0,0]],this.cachedSize=[],this.projectionTransform=[1,0,0,0,0,1,0,0,0,0,-1e-6,0,-1,1,0,1];var n=this.cutoutGeometry={spec:{id:-1,bufferValues:[[-1,-1,0,1,-1,0,-1,1,0,1,1,0]],bufferNames:["a_pos"],type:"TRIANGLE_STRIP"}};this.bufferRegistry.allocate(this.cutoutGeometry.spec.id,n.spec.bufferNames[0],n.spec.bufferValues[0],3)}var r=t("./Program"),s=t("./BufferRegistry"),o=t("./radixSort"),a=t("../utilities/keyValueToArrays"),h=t("./TextureManager"),u=t("./compileMaterial"),c=t("../utilities/Registry"),p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l=a({u_numLights:0,u_ambientLight:new Array(3),u_lightPosition:new Array(3),u_lightColor:new Array(3),u_perspective:new Array(16),u_time:0,u_view:new Array(16)});n.prototype.getWebGLContext=function(t){for(var e,i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=0,r=i.length;r>n;n++){try{e=t.getContext(i[n])}catch(t){console.error("Error creating WebGL context: "+t.toString())}if(e)return e}return e?void 0:(console.error("Could not retrieve WebGL context. Please refer to https://www.khronos.org/webgl/ for requirements"),!1)},n.prototype.createLight=function(t){this.numLights++;var e={color:[0,0,0],position:[0,0,0]};return this.lightRegistry.register(t,e),e},n.prototype.createMesh=function(t){var e=a({u_opacity:1,u_transform:p,u_size:[0,0,0],u_baseColor:[.5,.5,.5,1],u_positionOffset:[0,0,0],u_normals:[0,0,0],u_flatShading:0,u_glossiness:[0,0,0,0]}),i={depth:null,uniformKeys:e.keys,uniformValues:e.values,buffers:{},geometry:null,drawType:null,textures:[],visible:!0};return this.meshRegistry.register(t,i),i},n.prototype.setCutoutState=function(t,e){var i=this.getOrSetCutout(t);i.visible=e},n.prototype.getOrSetCutout=function(t){var e=this.cutoutRegistry.get(t);if(!e){var i=a({u_opacity:0,u_transform:p.slice(),u_size:[0,0,0],u_origin:[0,0,0],u_baseColor:[0,0,0,1]});e={uniformKeys:i.keys,uniformValues:i.values,geometry:this.cutoutGeometry.spec.id,drawType:this.cutoutGeometry.spec.type,visible:!0},this.cutoutRegistry.register(t,e)}return e},n.prototype.setMeshVisibility=function(t,e){var i=this.meshRegistry.get(t)||this.createMesh(t);i.visible=e},n.prototype.removeMesh=function(t){this.meshRegistry.unregister(t)},n.prototype.setCutoutUniform=function(t,e,i){var n=this.getOrSetCutout(t),r=n.uniformKeys.indexOf(e);if(i.length)for(var s=0,o=i.length;o>s;s++)n.uniformValues[r][s]=i[s];else n.uniformValues[r]=i},n.prototype.setMeshOptions=function(t,e){var i=this.meshRegistry.get(t)||this.createMesh(t);return i.options=e,this},n.prototype.setAmbientLightColor=function(t,e,i,n){return this.ambientLightColor[0]=e,this.ambientLightColor[1]=i,this.ambientLightColor[2]=n,this},n.prototype.setLightPosition=function(t,e,i,n){var r=this.lightRegistry.get(t)||this.createLight(t);return r.position[0]=e,r.position[1]=i,r.position[2]=n,this},n.prototype.setLightColor=function(t,e,i,n){var r=this.lightRegistry.get(t)||this.createLight(t);return r.color[0]=e,r.color[1]=i,r.color[2]=n,this},n.prototype.handleMaterialInput=function(t,e,i){var n=this.meshRegistry.get(t)||this.createMesh(t);i=u(i,n.textures.length),n.uniformValues[n.uniformKeys.indexOf(e)][0]=-i._id;for(var r=i.textures.length;r--;)n.textures.push(this.textureManager.register(i.textures[r],n.textures.length+r));return this.program.registerMaterial(e,i),this.updateSize()},n.prototype.setGeometry=function(t,e,i,n){var r=this.meshRegistry.get(t)||this.createMesh(t);return r.geometry=e,r.drawType=i,r.dynamic=n,this},n.prototype.setMeshUniform=function(t,e,i){var n=this.meshRegistry.get(t)||this.createMesh(t),r=n.uniformKeys.indexOf(e);-1===r?(n.uniformKeys.push(e),n.uniformValues.push(i)):n.uniformValues[r]=i},n.prototype.bufferData=function(t,e,i,n,r){this.bufferRegistry.allocate(t,e,i,n,r)},n.prototype.draw=function(t){var e=this.compositor.getTime();this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.textureManager.update(e),this.meshRegistryKeys=o(this.meshRegistry.getKeys(),this.meshRegistry.getKeyToValue()),this.setGlobalUniforms(t),this.drawCutouts(),this.drawMeshes()},n.prototype.drawMeshes=function(){for(var t,e,i=this.gl,n=this.meshRegistry.getValues(),r=0;r<n.length;r++)if(e=n[r],e&&(t=this.bufferRegistry.registry[e.geometry],e.visible&&(e.uniformValues[0]<1?(i.depthMask(!1),i.enable(i.BLEND)):(i.depthMask(!0),i.disable(i.BLEND)),t))){for(var s=e.textures.length;s--;)this.textureManager.bindTexture(e.textures[s]);e.options&&this.handleOptions(e.options,e),this.program.setUniforms(e.uniformKeys,e.uniformValues),this.drawBuffers(t,e.drawType,e.geometry),e.options&&this.resetOptions(e.options)}},n.prototype.drawCutouts=function(){var t,e,i=this.cutoutRegistry.getValues(),n=i.length;this.gl.disable(this.gl.CULL_FACE),this.gl.enable(this.gl.BLEND),this.gl.depthMask(!0);for(var r=0;n>r;r++)t=i[r],t&&(e=this.bufferRegistry.registry[t.geometry],t.visible&&(this.program.setUniforms(t.uniformKeys,t.uniformValues),this.drawBuffers(e,t.drawType,t.geometry)));this.gl.enable(this.gl.CULL_FACE)},n.prototype.setGlobalUniforms=function(t){for(var e,i,n=this.lightRegistry.getValues(),r=n.length,s=0;r>s;s++)e=n[s],e&&(i=4*s,this.lightPositions[0+i]=e.position[0],this.lightPositions[1+i]=e.position[1],this.lightPositions[2+i]=e.position[2],this.lightColors[0+i]=e.color[0],this.lightColors[1+i]=e.color[1],this.lightColors[2+i]=e.color[2]);l.values[0]=this.numLights,l.values[1]=this.ambientLightColor,l.values[2]=this.lightPositions,l.values[3]=this.lightColors,this.projectionTransform[0]=1/(.5*this.cachedSize[0]),this.projectionTransform[5]=-1/(.5*this.cachedSize[1]),this.projectionTransform[11]=t.perspectiveTransform[11],l.values[4]=this.projectionTransform,l.values[5]=.001*this.compositor.getTime(),l.values[6]=t.viewTransform,this.program.setUniforms(l.keys,l.values)},n.prototype.drawBuffers=function(t,e,i){var n,r,s,o,a,h,u,c,p=this.gl,l=0;for(h=t.keys.length,c=0;h>c;c++)n=t.keys[c],"indices"!==n?(r=this.program.attributeLocations[n],-1!==r&&(void 0!==r||(r=p.getAttribLocation(this.program.program,n),this.program.attributeLocations[n]=r,-1!==r))&&(this.state.enabledAttributes[n]||(p.enableVertexAttribArray(r),this.state.enabledAttributes[n]=!0,this.state.enabledAttributesKeys.push(n)),a=t.values[c],s=t.spacing[c],o=t.offset[c],l=t.length[c],this.state.boundArrayBuffer!==a&&(p.bindBuffer(a.target,a.buffer),this.state.boundArrayBuffer=a),this.state.lastDrawn!==i&&p.vertexAttribPointer(r,s,p.FLOAT,p.FALSE,0,4*o))):u=c;var d=this.state.enabledAttributesKeys.length;for(c=0;d>c;c++){var f=this.state.enabledAttributesKeys[c];this.state.enabledAttributes[f]&&-1===t.keys.indexOf(f)&&(p.disableVertexAttribArray(this.program.attributeLocations[f]),this.state.enabledAttributes[f]=!1)}l&&(void 0!==u?(a=t.values[u],o=t.offset[u],s=t.spacing[u],l=t.length[u],this.state.boundElementBuffer!==a&&(p.bindBuffer(a.target,a.buffer),this.state.boundElementBuffer=a),p.drawElements(p[e],l,p.UNSIGNED_SHORT,2*o)):p.drawArrays(p[e],0,l)),this.state.lastDrawn=i},n.prototype.updateSize=function(t){if(t){var e=window.devicePixelRatio||1,i=~~(t[0]*e),n=~~(t[1]*e);this.canvas.width=i,this.canvas.height=n,this.gl.viewport(0,0,i,n),this.cachedSize[0]=t[0],this.cachedSize[1]=t[1],this.cachedSize[2]=t[0]>t[1]?t[0]:t[1],this.resolutionValues[0]=this.cachedSize}return this.program.setUniforms(this.resolutionName,this.resolutionValues),this},n.prototype.handleOptions=function(t,e){var i=this.gl;if(t)switch(t.blending&&i.enable(i.BLEND),t.side){case"double":this.gl.cullFace(this.gl.FRONT),this.drawBuffers(this.bufferRegistry.registry[e.geometry],e.drawType,e.geometry),this.gl.cullFace(this.gl.BACK);break;case"back":i.cullFace(i.FRONT)}},n.prototype.resetOptions=function(t){var e=this.gl;t&&(t.blending&&e.disable(e.BLEND),"back"===t.side&&e.cullFace(e.BACK))},e.exports=n},{"../utilities/Registry":79,"../utilities/keyValueToArrays":81,"./BufferRegistry":84,"./Program":86,"./TextureManager":88,"./compileMaterial":90,"./radixSort":92}],90:[function(t,e,i){"use strict";function n(t,e){var i="",n={},h={},c={},p=[],l=[];return t.traverse(function(t,d){if(t.chunk){var f=u[r(t)],m=o(t),g=s(t.chunk.glsl,t.inputs,l.length+e);i+=f+m+" = "+g+"\n ",t.uniforms&&a(n,t.uniforms),t.varyings&&a(h,t.varyings),t.attributes&&a(c,t.attributes),t.chunk.defines&&p.push(t.chunk.defines),t.texture&&l.push(t.texture)}}),{_id:t._id,glsl:i+"return "+o(t)+";",defines:p.join("\n"),uniforms:n,varyings:h,attributes:c,textures:l}}function r(t){if("number"==typeof t)return 1;if(Array.isArray(t))return t.length;var e=t.chunk.output;if("number"==typeof e)return e;var i=t.inputs.map(function(t){return r(t)}).join(",");return e[i]}function s(t,e,i){return t.replace(/%\d/g,function(t){return o(e[t[1]-1])}).replace(/\$TEXTURE/,"u_textures["+i+"]")}function o(t){return Array.isArray(t)?h(t):"object"==typeof t?"fa_"+t._id:t.toFixed(6)}function a(t,e){for(var i in e)t[i]=e[i]}function h(t){var e=t.length;return"vec"+e+"("+t.join(",")+")"}var u={1:"float ",2:"vec2 ",3:"vec3 ",4:"vec4 "};e.exports=n},{}],91:[function(t,e,i){"use strict";function n(){var t=document.createElement("canvas").getContext("2d");t.canvas.width=t.canvas.height=128;for(var e=0;e<t.canvas.height;e+=16)for(var i=0;i<t.canvas.width;i+=16)t.fillStyle=16&(i^e)?"#FFF":"#DDD",t.fillRect(i,e,16,16);return t.canvas}e.exports=n},{}],92:[function(t,e,i){"use strict";function n(t,e,i){var n=t[i],r=e[n];return(r.depth?r.depth:e[n].uniformValues[1][14])+y}function r(t,e,i,n){var r=t[i];return e[r].depth=a(n)-y,r}function s(t,e,i){e[t[i]].depth=null}function o(t){return v[0]=t,b[0]}function a(t){return b[0]=t,v[0]}function h(t,e){var i,a,h,d,y,_,v,b,T,w,E,I=0,C=[];for(m=32/u+.999999999999999|0,i=0,d=c*m;d>i;i++)l[i]=0;for(i=0,d=t.length;d>i;i++){for(y=o(n(t,e,i)),y^=y>>31|2147483648,a=0,h=0;g>a;a+=c,h+=u)l[a+(y>>>h&p)]++;l[a+(y>>>h&f)]++}for(a=0;g>=a;a+=c)for(b=a,T=0;a+c>b;b++)w=l[b]+T,l[b]=T-1,T=w;if(--m){for(i=0,d=t.length;d>i;i++)y=o(n(t,e,i)),C[++l[y&p]]=r(t,e,i,y^=y>>31|2147483648);for(v=C,C=t,t=v;++I<m;){for(i=0,d=t.length,_=I*c,E=I*u;d>i;i++)y=o(n(t,e,i)),C[++l[_+(y>>>E&p)]]=t[i];v=C,C=t,t=v}}for(i=0,d=t.length,_=I*c,E=I*u;d>i;i++)y=o(n(t,e,i)),C[++l[_+(y>>>E&f)]]=r(t,e,i,y^(~y>>31|2147483648)),s(t,e,i);return C}var u=11,c=1<<u,p=c-1,l=new Array(c*Math.ceil(64/u)),d=1<<31%u,f=(d<<1)-1,m=32/u+.999999999999999|0,g=c*(m-1),y=Math.pow(20,6),_=new ArrayBuffer(4),v=new Float32Array(_,0,1),b=new Int32Array(_,0,1);e.exports=h},{}],93:[function(t,e,i){"use strict";var n={vertex:'#define GLSLIFY 1\n/**\r\n * The MIT License (MIT)\r\n * \r\n * Copyright (c) 2015 Famous Industries Inc.\r\n * \r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the "Software"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n * \r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n * \r\n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n/**\r\n * The MIT License (MIT)\r\n * \r\n * Copyright (c) 2015 Famous Industries Inc.\r\n * \r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the "Software"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n * \r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n * \r\n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n/**\r\n * Calculates transpose inverse matrix from transform\r\n * \r\n * @method random\r\n * @private\r\n *\r\n *\r\n */\r\n\r\n\r\nmat3 getNormalMatrix_1_0(in mat4 t) {\r\n   mat3 matNorm;\r\n   mat4 a = t;\r\n\r\n   float a00 = a[0][0], a01 = a[0][1], a02 = a[0][2], a03 = a[0][3],\r\n   a10 = a[1][0], a11 = a[1][1], a12 = a[1][2], a13 = a[1][3],\r\n   a20 = a[2][0], a21 = a[2][1], a22 = a[2][2], a23 = a[2][3],\r\n   a30 = a[3][0], a31 = a[3][1], a32 = a[3][2], a33 = a[3][3],\r\n   b00 = a00 * a11 - a01 * a10,\r\n   b01 = a00 * a12 - a02 * a10,\r\n   b02 = a00 * a13 - a03 * a10,\r\n   b03 = a01 * a12 - a02 * a11,\r\n   b04 = a01 * a13 - a03 * a11,\r\n   b05 = a02 * a13 - a03 * a12,\r\n   b06 = a20 * a31 - a21 * a30,\r\n   b07 = a20 * a32 - a22 * a30,\r\n   b08 = a20 * a33 - a23 * a30,\r\n   b09 = a21 * a32 - a22 * a31,\r\n   b10 = a21 * a33 - a23 * a31,\r\n   b11 = a22 * a33 - a23 * a32,\r\n\r\n   det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n   det = 1.0 / det;\r\n\r\n   matNorm[0][0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\r\n   matNorm[0][1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\r\n   matNorm[0][2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\r\n\r\n   matNorm[1][0] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\r\n   matNorm[1][1] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\r\n   matNorm[1][2] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\r\n\r\n   matNorm[2][0] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\r\n   matNorm[2][1] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\r\n   matNorm[2][2] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\r\n\r\n   return matNorm;\r\n}\r\n\r\n\n\n/**\r\n * The MIT License (MIT)\r\n * \r\n * Copyright (c) 2015 Famous Industries Inc.\r\n * \r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the "Software"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n * \r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n * \r\n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n/**\r\n * Calculates a matrix that creates the identity when multiplied by m\r\n * \r\n * @method inverse\r\n * @private\r\n *\r\n *\r\n */\r\n\r\n\r\nfloat inverse_2_1(float m) {\r\n    return 1.0 / m;\r\n}\r\n\r\nmat2 inverse_2_1(mat2 m) {\r\n    return mat2(m[1][1],-m[0][1],\r\n               -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\r\n}\r\n\r\nmat3 inverse_2_1(mat3 m) {\r\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\r\n    float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\r\n    float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\r\n\r\n    float b01 =  a22 * a11 - a12 * a21;\r\n    float b11 = -a22 * a10 + a12 * a20;\r\n    float b21 =  a21 * a10 - a11 * a20;\r\n\r\n    float det = a00 * b01 + a01 * b11 + a02 * b21;\r\n\r\n    return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\r\n                b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\r\n                b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\r\n}\r\n\r\nmat4 inverse_2_1(mat4 m) {\r\n    float\r\n        a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\r\n        a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\r\n        a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\r\n        a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\r\n\r\n        b00 = a00 * a11 - a01 * a10,\r\n        b01 = a00 * a12 - a02 * a10,\r\n        b02 = a00 * a13 - a03 * a10,\r\n        b03 = a01 * a12 - a02 * a11,\r\n        b04 = a01 * a13 - a03 * a11,\r\n        b05 = a02 * a13 - a03 * a12,\r\n        b06 = a20 * a31 - a21 * a30,\r\n        b07 = a20 * a32 - a22 * a30,\r\n        b08 = a20 * a33 - a23 * a30,\r\n        b09 = a21 * a32 - a22 * a31,\r\n        b10 = a21 * a33 - a23 * a31,\r\n        b11 = a22 * a33 - a23 * a32,\r\n\r\n        det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n    return mat4(\r\n        a11 * b11 - a12 * b10 + a13 * b09,\r\n        a02 * b10 - a01 * b11 - a03 * b09,\r\n        a31 * b05 - a32 * b04 + a33 * b03,\r\n        a22 * b04 - a21 * b05 - a23 * b03,\r\n        a12 * b08 - a10 * b11 - a13 * b07,\r\n        a00 * b11 - a02 * b08 + a03 * b07,\r\n        a32 * b02 - a30 * b05 - a33 * b01,\r\n        a20 * b05 - a22 * b02 + a23 * b01,\r\n        a10 * b10 - a11 * b08 + a13 * b06,\r\n        a01 * b08 - a00 * b10 - a03 * b06,\r\n        a30 * b04 - a31 * b02 + a33 * b00,\r\n        a21 * b02 - a20 * b04 - a23 * b00,\r\n        a11 * b07 - a10 * b09 - a12 * b06,\r\n        a00 * b09 - a01 * b07 + a02 * b06,\r\n        a31 * b01 - a30 * b03 - a32 * b00,\r\n        a20 * b03 - a21 * b01 + a22 * b00) / det;\r\n}\r\n\r\n\n\n/**\r\n * The MIT License (MIT)\r\n * \r\n * Copyright (c) 2015 Famous Industries Inc.\r\n * \r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the "Software"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n * \r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n * \r\n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n/**\r\n * Reflects a matrix over its main diagonal.\r\n * \r\n * @method transpose\r\n * @private\r\n *\r\n *\r\n */\r\n\r\n\r\nfloat transpose_3_2(float m) {\r\n    return m;\r\n}\r\n\r\nmat2 transpose_3_2(mat2 m) {\r\n    return mat2(m[0][0], m[1][0],\r\n                m[0][1], m[1][1]);\r\n}\r\n\r\nmat3 transpose_3_2(mat3 m) {\r\n    return mat3(m[0][0], m[1][0], m[2][0],\r\n                m[0][1], m[1][1], m[2][1],\r\n                m[0][2], m[1][2], m[2][2]);\r\n}\r\n\r\nmat4 transpose_3_2(mat4 m) {\r\n    return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\r\n                m[0][1], m[1][1], m[2][1], m[3][1],\r\n                m[0][2], m[1][2], m[2][2], m[3][2],\r\n                m[0][3], m[1][3], m[2][3], m[3][3]);\r\n}\r\n\r\n\n\n\r\n/**\r\n * Converts vertex from modelspace to screenspace using transform\r\n * information from context.\r\n *\r\n * @method applyTransform\r\n * @private\r\n *\r\n *\r\n */\r\n\r\nvec4 applyTransform(vec4 pos) {\r\n    //TODO: move this multiplication to application code. \r\n\r\n    /**\r\n     * Currently multiplied in the vertex shader to avoid consuming the complexity of holding an additional\r\n     * transform as state on the mesh object in WebGLRenderer. Multiplies the object\'s transformation from object space\r\n     * to world space with its transformation from world space to eye space.\r\n     */\r\n    mat4 MVMatrix = u_view * u_transform;\r\n\r\n    //TODO: move the origin, sizeScale and y axis inversion to application code in order to amortize redundant per-vertex calculations.\r\n\r\n    /**\r\n     * The transform uniform should be changed to the result of the transformation chain:\r\n     *\r\n     * view * modelTransform * invertYAxis * sizeScale * origin\r\n     *\r\n     * which could be simplified to:\r\n     *\r\n     * view * modelTransform * convertToDOMSpace\r\n     *\r\n     * where convertToDOMSpace represents the transform matrix:\r\n     *\r\n     *                           size.x 0       0       size.x \r\n     *                           0      -size.y 0       size.y\r\n     *                           0      0       1       0\r\n     *                           0      0       0       1\r\n     *\r\n     */\r\n\r\n    /**\r\n     * Assuming a unit volume, moves the object space origin [0, 0, 0] to the "top left" [1, -1, 0], the DOM space origin.\r\n     * Later in the transformation chain, the projection transform negates the rigidbody translation.\r\n     * Equivalent to (but much faster than) multiplying a translation matrix "origin"\r\n     *\r\n     *                           1 0 0 1 \r\n     *                           0 1 0 -1\r\n     *                           0 0 1 0\r\n     *                           0 0 0 1\r\n     *\r\n     * in the transform chain: projection * view * modelTransform * invertYAxis * sizeScale * origin * positionVector.\r\n     */\r\n    pos.x += 1.0;\r\n    pos.y -= 1.0;\r\n\r\n    /**\r\n     * Assuming a unit volume, scales an object to the amount of pixels in the size uniform vector\'s specified dimensions.\r\n     * Later in the transformation chain, the projection transform transforms the point into clip space by scaling\r\n     * by the inverse of the canvas\' resolution.\r\n     * Equivalent to (but much faster than) multiplying a scale matrix "sizeScale"\r\n     *\r\n     *                           size.x 0      0      0 \r\n     *                           0      size.y 0      0\r\n     *                           0      0      size.z 0\r\n     *                           0      0      0      1\r\n     *\r\n     * in the transform chain: projection * view * modelTransform * invertYAxis * sizeScale * origin * positionVector.\r\n     */\r\n    pos.xyz *= u_size * 0.5;\r\n\r\n    /**\r\n     * Inverts the object space\'s y axis in order to match DOM space conventions. \r\n     * Later in the transformation chain, the projection transform reinverts the y axis to convert to clip space.\r\n     * Equivalent to (but much faster than) multiplying a scale matrix "invertYAxis"\r\n     *\r\n     *                           1 0 0 0 \r\n     *                           0 -1 0 0\r\n     *                           0 0 1 0\r\n     *                           0 0 0 1\r\n     *\r\n     * in the transform chain: projection * view * modelTransform * invertYAxis * sizeScale * origin * positionVector.\r\n     */\r\n    pos.y *= -1.0;\r\n\r\n    /**\r\n     * Exporting the vertex\'s position as a varying, in DOM space, to be used for lighting calculations. This has to be in DOM space\r\n     * since light position and direction is derived from the scene graph, calculated in DOM space.\r\n     */\r\n\r\n    v_position = (MVMatrix * pos).xyz;\r\n\r\n    /**\r\n    * Exporting the eye vector (a vector from the center of the screen) as a varying, to be used for lighting calculations.\r\n    * In clip space deriving the eye vector is a matter of simply taking the inverse of the position, as the position is a vector\r\n    * from the center of the screen. However, since our points are represented in DOM space,\r\n    * the position is a vector from the top left corner of the screen, so some additional math is needed (specifically, subtracting\r\n    * the position from the center of the screen, i.e. half the resolution of the canvas).\r\n    */\r\n\r\n    v_eyeVector = (u_resolution * 0.5) - v_position;\r\n\r\n    /**\r\n     * Transforming the position (currently represented in dom space) into view space (with our dom space view transform)\r\n     * and then projecting the point into raster both by applying a perspective transformation and converting to clip space\r\n     * (the perspective matrix is a combination of both transformations, therefore it\'s probably more apt to refer to it as a\r\n     * projection transform).\r\n     */\r\n\r\n    pos = u_perspective * MVMatrix * pos;\r\n\r\n    return pos;\r\n}\r\n\r\n/**\r\n * Placeholder for positionOffset chunks to be templated in.\r\n * Used for mesh deformation.\r\n *\r\n * @method calculateOffset\r\n * @private\r\n *\r\n *\r\n */\r\n#vert_definitions\r\nvec3 calculateOffset(vec3 ID) {\r\n    #vert_applications\r\n    return vec3(0.0);\r\n}\r\n\r\n/**\r\n * Writes the position of the vertex onto the screen.\r\n * Passes texture coordinate and normal attributes as varyings\r\n * and passes the position attribute through position pipeline.\r\n *\r\n * @method main\r\n * @private\r\n *\r\n *\r\n */\r\nvoid main() {\r\n    v_textureCoordinate = a_texCoord;\r\n    vec3 invertedNormals = a_normals + (u_normals.x < 0.0 ? calculateOffset(u_normals) * 2.0 - 1.0 : vec3(0.0));\r\n    invertedNormals.y *= -1.0;\r\n    v_normal = transpose_3_2(mat3(inverse_2_1(u_transform))) * invertedNormals;\r\n    vec3 offsetPos = a_pos + calculateOffset(u_positionOffset);\r\n    gl_Position = applyTransform(vec4(offsetPos, 1.0));\r\n}\r\n',
fragment:'#define GLSLIFY 1\n/**\r\n * The MIT License (MIT)\r\n * \r\n * Copyright (c) 2015 Famous Industries Inc.\r\n * \r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the "Software"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n * \r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n * \r\n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n/**\r\n * The MIT License (MIT)\r\n * \r\n * Copyright (c) 2015 Famous Industries Inc.\r\n * \r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the "Software"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n * \r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n * \r\n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n/**\r\n * Placeholder for fragmentShader  chunks to be templated in.\r\n * Used for normal mapping, gloss mapping and colors.\r\n * \r\n * @method applyMaterial\r\n * @private\r\n *\r\n *\r\n */\r\n\r\n#float_definitions\r\nfloat applyMaterial_2_0(float ID) {\r\n    #float_applications\r\n    return 1.;\r\n}\r\n\r\n#vec3_definitions\r\nvec3 applyMaterial_2_0(vec3 ID) {\r\n    #vec3_applications\r\n    return vec3(0);\r\n}\r\n\r\n#vec4_definitions\r\nvec4 applyMaterial_2_0(vec4 ID) {\r\n    #vec4_applications\r\n\r\n    return vec4(0);\r\n}\r\n\r\n\n\n/**\r\n * The MIT License (MIT)\r\n * \r\n * Copyright (c) 2015 Famous Industries Inc.\r\n * \r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the "Software"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n * \r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n * \r\n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n */\r\n\r\n/**\r\n * Calculates the intensity of light on a surface.\r\n *\r\n * @method applyLight\r\n * @private\r\n *\r\n */\r\nvec4 applyLight_1_1(in vec4 baseColor, in vec3 normal, in vec4 glossiness, int numLights, vec3 ambientColor, vec3 eyeVector, mat4 lightPosition, mat4 lightColor, vec3 v_position) {\r\n    vec3 diffuse = vec3(0.0);\r\n    bool hasGlossiness = glossiness.a > 0.0;\r\n    bool hasSpecularColor = length(glossiness.rgb) > 0.0;\r\n\r\n    for(int i = 0; i < 4; i++) {\r\n        if (i >= numLights) break;\r\n        vec3 lightDirection = normalize(lightPosition[i].xyz - v_position);\r\n        float lambertian = max(dot(lightDirection, normal), 0.0);\r\n\r\n        if (lambertian > 0.0) {\r\n            diffuse += lightColor[i].rgb * baseColor.rgb * lambertian;\r\n            if (hasGlossiness) {\r\n                vec3 halfVector = normalize(lightDirection + eyeVector);\r\n                float specularWeight = pow(max(dot(halfVector, normal), 0.0), glossiness.a);\r\n                vec3 specularColor = hasSpecularColor ? glossiness.rgb : lightColor[i].rgb;\r\n                diffuse += specularColor * specularWeight * lambertian;\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    return vec4(ambientColor + diffuse, baseColor.a);\r\n}\r\n\r\n\n\n\r\n\r\n/**\r\n * Writes the color of the pixel onto the screen\r\n *\r\n * @method main\r\n * @private\r\n *\r\n *\r\n */\r\nvoid main() {\r\n    vec4 material = u_baseColor.r >= 0.0 ? u_baseColor : applyMaterial_2_0(u_baseColor);\r\n\r\n    /**\r\n     * Apply lights only if flat shading is false\r\n     * and at least one light is added to the scene\r\n     */\r\n    bool lightsEnabled = (u_flatShading == 0.0) && (u_numLights > 0.0 || length(u_ambientLight) > 0.0);\r\n\r\n    vec3 normal = normalize(v_normal);\r\n    vec4 glossiness = u_glossiness.x < 0.0 ? applyMaterial_2_0(u_glossiness) : u_glossiness;\r\n\r\n    vec4 color = lightsEnabled ?\r\n    applyLight_1_1(material, normalize(v_normal), glossiness,\r\n               int(u_numLights),\r\n               u_ambientLight * u_baseColor.rgb,\r\n               normalize(v_eyeVector),\r\n               u_lightPosition,\r\n               u_lightColor,   \r\n               v_position)\r\n    : material;\r\n\r\n    gl_FragColor = color;\r\n    gl_FragColor.a *= u_opacity;   \r\n}\r\n'};e.exports=n},{}],94:[function(t,e,i){"use strict";function n(t){s.call(this),this.el=new r(this,{classes:["ion-ios-play-outline","arrow"]}),this.el.setProperty("color","white"),this.direction=t.direction,this.el.setProperty("fontSize","40px"),this.el.setProperty("lineHeight","40px"),this.el.setProperty("cursor","pointer"),this.el.setProperty("textHighlight","none"),this.el.setProperty("zIndex","2"),1!==this.direction&&(this.setOrigin(.5,.5),this.setRotation(0,0,Math.PI)),this.addUIEvent("click")}var r=t("famous/dom-renderables/DOMElement"),s=t("famous/core/Node");n.prototype=Object.create(s.prototype),n.prototype.constructor=n,e.exports=n},{"famous/core/Node":12,"famous/dom-renderables/DOMElement":20}],95:[function(t,e,i){"use strict";function n(t,e){this.context=h.createScene(t),this.root=this.context.addChild(),new d(this.root).setDepth(1e3),this.pageData=e.pageData,this.arrows={back:this.root.addChild(new c({direction:-1})),next:this.root.addChild(new c({direction:1}))},this.pager=new p(this.root.addChild(),{pageData:this.pageData});var i=this.root.addChild(),n=new y(i).set(100,-50);this.dots=new l(i,{pageData:this.pageData}),r.call(this),this.currentIndex=0,s.call(this),o.call(this),a.call(this),this.changeDescription(this.currentIndex),this.small=!1,this.big=!1,this.root.onSizeChange=function(t,e,i){750>t&&!this.small&&(n.set(-200,-50,0,{duration:2e3,curve:"inOutElastic"}),this.small=!0,this.big=!1),t>750&&!this.big&&(n.set(100,-50,0,{duration:2e3,curve:"inOutElastic"}),this.big=!0,this.small=!1)}}function r(){this.arrows.back.setSizeMode(1,1),this.arrows.back.setAbsoluteSize(40,40),this.arrows.back.setPosition(40,0,-5),this.arrows.back.setAlign(0,.25,0),this.arrows.back.setMountPoint(0,.5,0),this.arrows.next.setSizeMode(1,1),this.arrows.next.setAbsoluteSize(40,40),this.arrows.next.setPosition(-40,0,-5),this.arrows.next.setAlign(1,.25,0),this.arrows.next.setMountPoint(1,.5,0),this.dots.node.setSizeMode(1,1),this.dots.node.setAbsoluteSize(null,20),this.dots.node.setAlign(.01,.9,0),this.dots.node.setMountPoint(0,1,0),this.pager.node.setAlign(.5,.25,0),this.pager.node.setMountPoint(.5,.5,0),this.pager.node.setPosition(0,0,-5)}function s(){this.root.addComponent({onReceive:function(t,e){var i="click"===t&&e.node.constructor===c;if(i&&this.modalIsClosed){var n=e.node.direction||1,r=e.node.amount;r=r||1;var s=this.currentIndex,o=s+n*r,a=0,h=this.pageData.length-1,u=o>h?h:a>o?a:o;this.currentIndex!==u&&(this.currentIndex=u,this.dots.pageChange(s,this.currentIndex),this.pager.pageChange(s,this.currentIndex),this.changeDescription(this.currentIndex))}if("click"===t&&!i&&this.modalIsClosed){var s=this.currentIndex;this.currentIndex=e.node.amount,this.dots.pageChange(s,this.currentIndex),this.pager.pageChange(s,this.currentIndex),this.changeDescription(this.currentIndex)}}.bind(this)})}function o(){this.root.setPosition(0,0,-5);var t=this.root.addChild().setPosition(0,0,3),e=t.addChild().setPosition(0,0,0).setSizeMode(0,0,0).setProportionalSize(2,2,0),i=new f(e).set(.65);new u(e,{properties:{backgroundColor:"black"}});var n=t.addChild(),r=new g(n),s=n.addChild().setSizeMode(1,1,0).setMountPoint(.5,.5).setAbsoluteSize(500,280,100).setProportionalSize(.8,0).setOrigin(.5,.5).setPosition(0,0,5).setAlign(.5,.5);new u(s,{content:"<div class='panel-content'><h1>Famous TBYB</h1><p>As part of the Famous hiring criteria, I was asked to complete several projects during a two-week, in-house sprint. I built this landing page to showcase these TBYB projects.</p><p>After closing this modal, use the arrow buttons to navigate through the projects and click on the icons to visit the live, deployed project.</p></div>",classes:["modal-panel"],properties:{backgroundColor:"rgba(100,175,200,0.65)",borderRadius:"15px"}});var o=new m(n);s.addComponent({onReceive:function(a){"click"===a&&(n.setPosition(0,0,1e3),i.set(0,{duration:1e3,curve:"easeOut"},function(){this.modalIsClosed=!0}.bind(this)),r.set(2,3,0,{duration:1e3,curve:"easeIn"}),o.set(0,0,Math.PI/3,{duration:1e3,curve:"easeInOut"},function(){t.removeChild(e),t.removeChild(s),this.root.removeChild(t),this.root.setPosition(0,0,0)}.bind(this)))}.bind(this)});var a=s.addChild().setSizeMode(1,1,1).setAbsoluteSize(30,30).setMountPoint(1,0,0).setAlign(.99,.01,1).setPosition(0,0,6);a.close=!0,a.addUIEvent("click"),new u(a,{classes:["ion-close-circled"],properties:{color:"black",fontSize:"28px",backgroundColor:"white",borderRadius:"50%",textAlign:"center",cursor:"pointer"}})}function a(){var t=this.root.addChild().setSizeMode(0,0,0).setAlign(1,1).setMountPoint(1,1).setProportionalSize(.75,.5),e=t.addChild().setSizeMode(0,2,0);this.details=new u(e,{classes:["detail-pane"]})}var h=t("famous/core/FamousEngine"),u=t("famous/dom-renderables/DOMElement"),c=t("./Arrow.js"),p=t("./Pager.js"),l=t("./Dots.js"),d=t("famous/components/Camera"),f=t("famous/components/Opacity"),m=t("famous/components/Rotation"),g=t("famous/components/Align"),y=t("famous/components/Position"),_=t("../data/pageData");n.prototype.changeDescription=function(t){var e="<h2 class='detail-title'>"+_[t].title+"</h2>",i="<div class='detail-body'>"+_[t].description+"</div>";this.details.setContent(e+i)},e.exports=n},{"../data/pageData":99,"./Arrow.js":94,"./Dots.js":96,"./Pager.js":97,"famous/components/Align":1,"famous/components/Camera":2,"famous/components/Opacity":3,"famous/components/Position":4,"famous/components/Rotation":5,"famous/core/FamousEngine":11,"famous/dom-renderables/DOMElement":20}],96:[function(t,e,i){"use strict";function n(t,e){this.node=t,this.dots=[],this.node.setAlign(.5,.5),this.node.setMountPoint(.5,.5),this.dotWidth=e.dotWidth||20,this.spacing=e.spacing||5,this.numPages=e.pageData.length;for(var i=0;i<this.numPages;i++){var n=t.addChild();n.setSizeMode(1,1),n.setMountPoint(.5,.5),n.setAbsoluteSize(10*this.dotWidth,this.dotWidth),this.dots.push(new r(n,i))}this.dots[0].select();var s={onSizeChange:function(t,e,i){this.layoutDots([t,e,i])}.bind(this)};this.node.addComponent(s)}function r(t,e){this.node=t,this.node.amount=e,this.el=new s(t),this.el.setProperty("textAlign","center"),this.el.setProperty("cursor","Pointer"),this.el.setProperty("color","white"),this.el.setContent(o[e].title),this.node.addUIEvent("click")}var s=t("famous/dom-renderables/DOMElement"),o=t("../data/pageData");n.prototype.layoutDots=function(t){t&&(this.size=t);var e=this.dotWidth*this.numPages+this.spacing*(this.numPages-1);(this.size[0]-e)/2,this.padding=10;for(var i=0;i<this.numPages;i++)this.dots[i].node.setPosition(0,10*i+i*this.padding,0)},n.prototype.pageChange=function(t,e){this.dots[t].deselect(),this.dots[e].select()},r.prototype.select=function(){this.el.setProperty("backgroundColor","gray")},r.prototype.deselect=function(){this.el.setProperty("backgroundColor","transparent")},e.exports=n},{"../data/pageData":99,"famous/dom-renderables/DOMElement":20}],97:[function(t,e,i){"use strict";function n(t,e){this.node=t,this.currentIndex=0,this.pageWidth=0;var i={onSizeChange:function(t,e,i){this.defineWidth(t)}.bind(this)};this.node.addComponent(i),this.simulation=new o,a.requestUpdate(this),this.pages=r.call(this,t,e.pageData)}function r(t,e){for(var i=[],n=0;n<e.length;n++){var r=t.addChild();r.setSizeMode(1,1,1),r.setAbsoluteSize(150,150,0),r.setAlign(.5,.5),r.setMountPoint(.5,.5),r.setOrigin(.5,.5);var o=new s(r,{properties:{cursor:"pointer"},tagName:"a",attributes:{href:m[n].url,target:"_blank"}});o.setProperty("backgroundImage","url("+e[n]+")"),o.setProperty("background-repeat","no-repeat"),o.setProperty("background-size","cover");var a=new c({mass:100,size:[100,100,100]}),h=0===n?new f(0,0,0):new f(1,0,0),u=new p(null,a,{period:.6,dampingRatio:.5,anchor:h}),g=0===n?new d:(new d).fromEuler(0,-Math.PI/2,0),y=new l(null,a,{period:1,dampingRatio:.2,anchor:g});this.simulation.add(a,u,y),i.push({node:r,el:o,box:a,spring:u,quaternion:g,rotationalSpring:y,anchor:h})}return i}var s=t("famous/dom-renderables/DOMElement"),o=t("famous/physics/PhysicsEngine"),a=t("famous/core/FamousEngine"),h=t("famous/physics"),u=t("famous/math"),c=h.Box,p=h.Spring,l=h.RotationalSpring,d=(h.RotationalDrag,u.Quaternion),f=u.Vec3,m=t("../data/pageData");n.prototype.defineWidth=function(t){this.pageWidth=t;for(var e=t>300?150:.5*t,i=0,n=this.pages.length;n>i;i++)this.pages[i].node.setAbsoluteSize(e,e)},n.prototype.onUpdate=function(t){this.simulation.update(t);for(var e,i,n,r,s=0,o=this.pages.length;o>s;s++)e=this.pages[s],i=this.simulation.getTransform(e.box),n=i.position,r=i.rotation,e.node.setPosition(n[0]*this.pageWidth,0,0),e.node.setRotation(r[0],r[1],r[2],r[3]);a.requestUpdateOnNextTick(this)},n.prototype.pageChange=function(t,e){e>t?(this.pages[t].anchor.set(-1,0,0),this.pages[t].quaternion.fromEuler(0,Math.PI/2,0),this.pages[e].anchor.set(0,0,0),this.pages[e].quaternion.set(1,0,0,0)):(this.pages[t].anchor.set(1,0,0),this.pages[t].quaternion.fromEuler(0,-Math.PI/2,0),this.pages[e].anchor.set(0,0,0),this.pages[e].quaternion.set(1,0,0,0)),this.currentIndex=e},e.exports=n},{"../data/pageData":99,"famous/core/FamousEngine":11,"famous/dom-renderables/DOMElement":20,"famous/math":39,"famous/physics":67,"famous/physics/PhysicsEngine":41}],98:[function(t,e,i){e.exports=["./images/binary.png","./images/BinSearch.png","./images/bubsort.png","./images/copy.png"]},{}],99:[function(t,e,i){e.exports=[{title:"Binary Famous",description:'<p>As part of the "TBYB" (i.e. Try Before You Buy) hiring process for Famous you are asked to complete a project relating to your position. Since I was opting for the Famous University position, I was givien an assignment to create visualizations that could help teach complex subects in a creative way.</p><p>This is the first of three projects I created during my two week sprint. Here I use glowing cards to represent the digits in a byte. You can press play to start the animation or add a number into the input field. This is built using an old, deprecated version of the Engine</p>',url:"http://morgantheplant.com/binary/"},{title:"Binary Search Famous",description:"<p>This is the second of three projects I created during my two week sprint. Using the now deprecated version of the Engine, I built this to teach the classic Binary Search algorithm. I wanted to make it feel like a game and tried to include some Candy Crush style animations. Note how I reused components from the other projects here. Keeping my code modular and loosly coupled helped me recycle components and finish within the two week deadline.</p>",url:"http://morgantheplant.com/binsearch/"},{title:"Bubble Sort Famous",description:"<p>This is the third of three projects I created during my two-week TBYB sprint. This is my favorite of the three projects.  This project uses the bubble sort algorithm to sort the notes in ascending order. Each note's size is based on its hertz and the colors change each time a note is compared against the next.</p><p>The input field at the bottom lets you enter your own notes to be sorted or choose from some predefined tunes. I ran out of time before writing any code to clean up the strings from the input so there may be errors there.</p>",url:"http://morgantheplant.com/bubsort/"},{title:"Mixed Mode Angular",description:"<p>Before being accepted for a TBYB, I was given a writing assignment to teach a lesson on a now deprecated version of the Engine. This project had a 3 day turnaround.</p><p>I wrote the copy and threw together this simple Angular SPA to appear like the old Famous University website. The original version included Famous code in the text editor, but I have removed it since this version of the Engine was never released. </p>",url:"http://morgantheplant.com/mixedmode"}]},{}],100:[function(t,e,i){"use strict";var n=t("famous/core/FamousEngine");n.init();var r=t("./carousel/Carousel"),s=t("./data/imageData");new r("body",{pageData:s})},{"./carousel/Carousel":95,"./data/imageData":98,"famous/core/FamousEngine":11}]},{},[100]);
